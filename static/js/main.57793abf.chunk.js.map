{"version":3,"sources":["components/theme/createBreakpoints.js","components/mapView/constants.ts","components/theme/createTheme.ts","components/hud/modal/mixedMediaModal.styles.ts","utils/sizeCss.ts","components/hud/modal/mixedMediaModal.tsx","components/hud/layout.tsx","utils/scaleBreakdown.ts","components/hud/topPanel/topPanel.styles.ts","components/hud/button/button.styles.ts","components/hud/button/holdable.tsx","components/hud/button/button.tsx","data/areas.ts","utils.ts","components/hud/fitText/fitText.tsx","components/hud/topPanel/topPanel.tsx","data/characters.ts","components/mapView/loadResources/loaders.ts","components/mapView/loadResources/context.tsx","components/mapView/loadResources/index.tsx","components/locale/strings.ts","components/mapView/applicationLoading.tsx","debug/index.ts","components/stage/PixieStage.tsx","components/mapView/pixiUtils/rawDisplayObj.tsx","components/mapView/pixiUtils/rafTicker.ts","components/mapView/area/areaSpriteFill.tsx","components/mapView/area/areaOverlay.tsx","components/mapView/tokens/siegeToken.tsx","components/mapView/area/areaView.tsx","components/mapView/viewport.tsx","components/mapView/mapBackground.tsx","components/mapView/mapView.tsx","components/hud/bottomPanel/bottomPanel.tsx","components/hud/bottomPanel/bottomPanel.styles.ts","components/hud/uiScreen.tsx","components/appStates/appState.tsx","core/persistenceService.ts","components/hud/modal/selectCharacter/timings.ts","components/hud/modal/selectCharacter/sliderIndicator.tsx","components/hud/modal/modalTitleRow.tsx","images/hand.svg","components/hud/modal/selectCharacter/selectCharacterModalContent.tsx","components/hud/modal/crowsAnimation.tsx","components/hud/modal/selectCharacter/disapperingCard.tsx","components/hud/modal/selectCharacter/characterOverlay.tsx","components/hud/modal/selectCharacter/factorCalculator.ts","components/hud/modal/selectCharacter/quarantineCard.tsx","components/hud/modal/selectCharacter/characterCard.tsx","components/hud/modal/selectCharacter/controller.tsx","components/appStates/selectCharacterState.tsx","components/appStates/confirmEndOfTurnState.tsx","components/hud/modal/selectPlayerEffect/playerEffectModalContent.tsx","components/hud/modal/selectPlayerEffect/playerEffectModalController.tsx","components/hud/modal/modalController.tsx","components/appStates/selectBonusMovementLocationState.tsx","model/actions.ts","core/gameActionReducer.tsx","core/gameEngine.ts","components/appStates/healersTurnState.tsx","components/appStates/plagueTurnState.tsx","components/appStates/selectStartingAreaState.tsx","core/gameActionsUrlSerializer.ts","components/hud/modal/modalOverlay.tsx","components/hud/modal/killedCharactersModalController.tsx","components/appStates/menu/menuState.tsx","components/appStates/replayState.tsx","components/appStates/restoreAppState.tsx","components/appStates/stateRouter.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["keys","createBreakpoints","breakpoints","values","xs","sm","md","lg","xl","unit","step","other","up","key","value","between","start","end","endIndex","indexOf","length","down","upperbound","only","width","AREA","fillTime","particlesCount","fadingStart","particlesTtlSpread","fadingStartOn","this","fadingDelta","AREA_OVERLAY","fadeTime","COLORS","activeTint","passedTint","charTints","SIZES","UI","topPanelHeightFactor","buttonPanelHeightFactor","panelPaddingPx","buttonScalePc","undoPaddingFactor","topTransitionHeightPx","bottomTransitionHeightPx","transitionElementWidthPx","worldWidth","worldHeight","TOKENS","fromScale","toScale","time","deltaScale","deltaAlpha","createThemeFromScreenSize","size","top","height","bottom","middle","createTheme","viewport","pageSizes","styles","createStyles","wrapper","position","left","cardRow","display","justifyContent","padding","card","calcCss","part","side","MixedMediaModal","props","controller","children","renderModal","renderPixiBackdrop","modalProps","sizes","relativeSizes","undoShift","h","pixiTop","w","maxWidth","calculateSizes","update","forceUpdate","setProps","renderBackdrop","Component","withStyles","Layout","theme","getTheme","style","ThemeProvider","breakScaleBkg","scaledBackground","factor","backgroundSize","button","filter","tooltip","fontSize","boxShadow","defaultDelay","defaultLongPressDelay","isMobile","test","navigator","userAgent","Holdable","containerRef","React","createRef","timerId","clickDelay","longPressDelay","holdStartTime","holding","clearTimeout","touchStart","ev","Date","now","holdStart","mouseDown","mouseUp","holdEnd","touchEnd","onLongPressStart","setTimeout","onDown","holdTime","onClick","isWithin","onLongPressEnd","x","rect","current","getBoundingClientRect","y","changedTouches","clientX","clientY","prevProps","prevState","snapshot","onMouseDown","undefined","onMouseUp","onTouchStartCapture","onTouchEnd","ref","Button","divRef","ReactTooltip","hide","show","isActive","unpressableInnactive","isVisible","deb","iconHref","data-tip","data-for","id","className","classes","alt","src","WebkitTouchCallout","event","eventOff","effect","place","direction","delayHide","delayShow","tooltipHint","hitAreas","areasBBoxes","tokenPositions","steppe","areaKeys","Object","require","fastMemoize","points","minX","NaN","minY","maxX","maxY","isNaN","getRandomInt","min","max","Math","ceil","floor","random","getRandomBool","delay","ms","Promise","r","presentWrap","presentation","present","fn","p","presentVal","val","areaToLocation","areaKey","parseInt","slice","locationToAreaKeys","location","locationToAreaKey","index","toString","padStart","FitText","debouncedResize","recalculate","a","async","initialSizes","getBodySizeSnapshot","maxWidthPx","calcLimit","maxHeightPx","maxHeight","currentSize","lines","setSize","lineHeight","dims","getDims","document","body","clientWidth","clientHeight","element","scrollWidth","scrollHeight","limit","type","_","window","addEventListener","removeEventListener","TopPanel","main","secondary","msgAccented","isAccented","mainRow","title","onMenuClick","classNames","secondaryRow","accented","stylizedTransition","color","backgroundColor","zIndex","paddingTop","paddingLeft","paddingRight","flexDirection","textAlign","verticalAlign","whiteSpace","backgroundImage","backgroundRepeat","pointerEvents","characters","name","closeFor","gender","healerCharacters","isHealer","allCharacters","concat","loadMapTiles","quality","rootPath","indexPath","fetch","rsp","json","scale","tiles","map","tile","tex","PIXI","from","mipmap","loadAreas","loadAreaOverlayTiles","overlay","bbox","mask","hitArea","tokenPosition","areaTiles","areas","area","loadCrowsTextures","loader","then","data","baseTex","sprites","loadCharacterCards","obj","onComplete","add","character","alphaMode","PREMULTIPLIED_ALPHA","load","timerKeys","total","timed","console","isPromise","promiseOrResult","timeEnd","ResourcesContext","createContext","withResources","WrappedComponent","resources","useContext","cachedResources","LoadResources","state","q","app","group","all","catch","e","groupEnd","mapTiles","crows","characterCards","whiteHand","redHand","siegeToken","cloudTex","cardMaskTex","missionCards","hand","log","loadResources","setState","onLoaded","render","qualityPreset","withPixiApp","str","template","turnNo","cannotEndSiegeOnSameTurn","cannotEndSiege","cannotStartSiegeCauseMovements","cannotStartSiegeCauseContamination","cannotStartSiegeCauseSiege","siegeEndSuccessfully","siegeCancelledCauseMovement","startOfTurn","movementToLocation","startingLocation","selectCharacter","siegeStarted","siegeStartedKilled","siegeEndedKilled","multipleCharacterKilled","characterWoKilled","characterMaKilled","cannotContaminateTwice","cannotContaminateCauseSiege","confirmTurnEnd","turnEnd","phase","additionalMove","startOfGame","selectAreaToStartFrom","healersTurn","selectHealersEffects","canceledEffect","activatedEffect","cancelSiegeWarning","doubleMovement","finishTurn","contaminate","contaminateOfLocation","startSiege","finishSiege","cancelAction","cancelSpecificAction","close","apply","disable","missions","stamms","effectm12","effectsPlusMovement","selectLocation","restoringGameState","startNew","restoreLastGame","saveGameReplay","returnToGame","loading","trans","i18n","init","lng","interpolation","format","startsWith","JSON","parse","substring","Array","some","v","ua","translation","format18n","args","t","strings","getStrings","ApplicationLoading","marginBottom","isDebug","localStorage","getItem","gui","dat","inDebug","action","domElement","parentElement","setInterval","setItem","PixieStage","renderLoader","options","transparent","onUnmount","onResourcesLoaded","Provider","RawDisplayObj","PixiComponent","create","assign","RafTicker","onTick","startTime","lastTick","elapsedTotal","rafHandle","isStopped","tick","timestamp","elapsed","requestAnimationFrame","cancelAnimationFrame","debug_obj","fromEntries","folder","addFolder","forEach","k","listen","AreaSpriteFill","container","emitter","ticker","fadingMod","maxAlpha","minAlpha","skipDelay","getLifetime","baseLifetime","ttlMod","transitToFill","fill","prevFill","lt","minLifetime","maxLifetime","emit","goToDisabled","goToPassed","goToActive","tint","alpha","rafTick","ts","updateRect","particleCount","stop","sizeMult","WHITE","addChild","createEmitter","particles","speed","minimumSpeedMultiplier","startRotation","noRotation","lifetime","spawnType","spawnRect","pos","frequency","maxParticles","nextProps","nextState","nextContext","AreaOverlay","targetAlpha","elapsedMs","elapsedMS","visible","containerName","c","i","texture","SiegeToken","sprite","animState","s","anchor","deltaA","deltaS","set","remove","AreaView","maskSprite","pixiRef","getSizeMult","renderToken","tokens","centerX","centerY","cornerX","cornerY","screenH","screenW","target","debug_folder","open","attachDebug","changing","querySelector","onChange","moveCenter","center","corner","worldScreenHeight","worldScreenWidth","updateDisplay","ViewportComponent","Viewport","screenHeight","screenWidth","interaction","renderer","plugins","on","drag","pinch","wheel","bounce","sides","decelerate","friction","clampZoom","focus","focusOn","setZoom","applyProps","oldProps","clamp","nX","leftExtr","d","nY","moveCorner","minHeight","useApp","MapBackground","emptySnapshot","fills","focusArea","grayscaleFilter","mapSnapshot","getFocusOn","filters","grayscale","renderMap","renderAreas","find","token","traceArea","world","onAreaClick","point","contains","ColorMatrixFilter","desaturate","focus_obj","areaToFocus","setArea","BottomPanel","buttons","onMapButtons","buttonsWrapper","undoContainer","right","UiScreen","renderOnMapTopButtons","onMapTopButtons","renderTopPanel","mainMsg","msg","renderStage","modalRenderer","middleSize","renderBottomPanel","bottomButtons","onMapBottomButtons","modalController","modal","customComponent","SimpleTransition","promise","BaseAppState","routeProps","wasUpdated","PersistenceService","dbPromise","writeAll","actions","db","tx","transaction","store","objectStore","clear","put","getAll","count","idb","upgrade","createObjectStore","trackingService","timings","cardRealign","destruction","birdsFlyOff","destructionTotal","mod","sliderIndicator","transition","transform","label","fontWeight","background","active","num","healer","titleRow","overflow","text","_extends","arguments","source","prototype","hasOwnProperty","call","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref","svgRef","createElement","ForwardRef","forwardRef","SelectCharacterModalContent","pageSelected","selectedCharacters","getDisplayCharacter","lastChar","onSwipe","page","velocityX","setPage","renderOverlay","mode","kill","hidden","renderSliderIndicatorsRowsContainer","modalSizes","sliderIndicatorRow","renderSliderIndicator","idx","viewBox","pageNo","onSelectedCharacterChanged","renderCardsRow","renderCard","char","draggable","onCardClick","existingIndex","findIndex","splice","newChar","push","displayCharacter","cardSelectionRow","opacity","to","animationName","animationDuration","animationDelay","animationFillMode","CrowsAnimation","reverseSprites","oldStart","isTop","isLeft","done","gotoAndPlay","angle","arriveDelay","destroy","xCount","yCount","rnd","createSprite","animationSpeed","checkCoord","crow","targetLower","coord","DisappearingCard","maskSprt","displacementSprite","baseTexture","wrapMode","REPEAT","DisplacementFilter","positionTl","gsap","disTl","ease","easeIn","masterTl","paused","isMask","play","selectedCharacter","scrFullHeight","scrShift","scrShiftedHeight","scrAvailableSpace","scrRequiredHeight","positionCalculated","texHeight","alignFactors4","cardsCount","cardRatio","screenRatio","availableWidth","availableHeight","cardWidth","cardHeight","scaleFactor","get","horizontalPadding","cardY","middleY","QuarantineCard","effectSprite","greyscale","renderCards","allSelectedCharacters","calculatedFactors","alignFactors1","alignFactors2","alignFactors3","b","alignFactors","vw","vh","arr","factors","currentScale","onPositionCalculated","SelectCharacterModalController","charChanged","modalMode","onCharacterChanged","renderCharacterOverlay","allChars","SelectCharacterState","renderProps","turn","stateText","emptyOk","closeModal","onClose","popState","onCharactersSelected","ConfirmEndOfTurnState","onTurnEnd","uiPropsOverride","pages","indicatorImage","items","image","PlayerEffectModalContent","itemSelected","renderContainer","selectedItem","isOngoing","selectedEffects","includes","renderCardPreview","renderItemButtons","href","border","onSelect","minWidth","item","renderItemButton","userSelect","onItemClick","onIndicatorClick","changePage","recognizers","swipe","velocity","Hammer","DIRECTION_HORIZONTAL","PlayerEffectModalController","onItemChanged","activeEffects","NullModalController","SelectBonusMovementLocationState","game","selectedArea","getMsg","locationNo","connections","onUndo","getAvailableAreas","plagueLocation","flatMap","getMapSnapshot","startingAreas","l","inSiege","areaSelected","pushMessage","onAreaConfirmed","pushAction","controlActionTypes","gameActionReducer","last","initialLocation","statusMsg","formatter","getStatusMsg","getActionName","lastSnap","penultimateSnap","nth","moved","error","affected","join","affectedString","killed","GameEngine","persistenceService","lastActionSnapshot","lastAction","getTurnActions","acc","unshift","isPlagueTurn","act","findLast","popped","pop","HealersTurnState","renderBottomButtons","isApply","activateItem","onDone","gameState","pushState","popAction","getCanceledActionStr","onTurnEndConfirmed","PlagueTurnState","getPhaseDescription","turnActions","isInAdditionalMovePhase","getMovements","renderUndo","renderButtons","checkContaminate","onContaminate","checkSiege","onSiege","checkCanMove","wasInSiege","errorMsg","onContaminatedCharacterSelected","onTurnEndConfirm","turnState","currentLocation","getCurrentLocation","onCharactersSieged","onSiegeStarted","getAreaFills","getTokens","ar","setLocation","loc","st","isAvailable","isPassed","isLocationPassed","getFill","con","number","phase2ActionIndex","movements","m","SelectStartingAreaState","onSelected","getFills","actionIds","movement","actionTypes","entries","bits","pad","parseBits","len","substr","pointer","alph","urlSerializer","version","deserializeActionType","typeNo","deserializeAction","affectedCount","affectedIdx","deserializeChar","serializeAction","serializeChar","bitString","repeat","paddedPart","toB64","b64","fromB64","actionType","charIndex","Error","KilledCharactersModalController","disposed","disposeEnd","MenuState","renderMenuModal","onNewGame","onSaveGameReplay","onReturnToGame","clearAll","url","URLSearchParams","search","delete","newurl","protocol","host","pathname","history","replaceState","append","serialize","prompt","RestoreAppState","currentAction","ActionsIterator","gameActions","precedingInSameTurn","takeRightWhile","havePrev","haveNext","moveNext","movePrev","gAction","ReplayState","isPlaying","iterator","timer","getFocusOnLocation","renderSlider","margin","devicePixelRatio","marks","playAction","disableTimer","trackStyle","handleStyle","borderColor","activeDotStyle","togglePlay","resetTimer","timerTick","playNext","getDelay","playPrev","chars","ssChars","seChars","restoreFromUrl","deserialize","pTurn","debugState","inStack","StateRouter","appStates","transientMessage","defaultUiProps","getRouteProps","pushMsg","removeMsg","timeout","appState","constructor","uiProps","oncontextmenu","preventDefault","stopPropagation","App","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","onUpdate","onSuccess","ReactDOM","getElementById","URL","process","origin","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OAC7H,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OACjO,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OACrK,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OAC3N,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,MAC7T,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OACrb,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OACjY,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OACjJ,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OACrP,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,KAAK,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,OAC3M,OAAU,CAAC,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI,KAAK,EAAI,MAAM,CAAC,EAAI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","file":"static/js/main.57793abf.chunk.js","sourcesContent":["// Sorted ASC by size. That's important.\r\n// It can't be configured as it's used statically for propTypes.\r\nexport const keys = ['xs', 'sm', 'md', 'lg', 'xl'];\r\n\r\n// Keep in mind that @media is inclusive by the CSS specification.\r\nexport default function createBreakpoints(breakpoints) {\r\n    const {\r\n        // The breakpoint **start** at this value.\r\n        // For instance with the first breakpoint xs: [xs, sm[.\r\n        values = {\r\n            xs: 0,\r\n            sm: 600,\r\n            md: 960,\r\n            lg: 1280,\r\n            xl: 1920,\r\n        },\r\n        unit = 'px',\r\n        step = 5,\r\n        ...other\r\n    } = breakpoints;\r\n\r\n    function up(key) {\r\n        const value = typeof values[key] === 'number' ? values[key] : key;\r\n        return `@media (min-width:${value}${unit})`;\r\n    }\r\n\r\n    function down(key) {\r\n        const endIndex = keys.indexOf(key) + 1;\r\n        const upperbound = values[keys[endIndex]];\r\n\r\n        if (endIndex === keys.length) {\r\n            // xl down applies to all sizes\r\n            return up('xs');\r\n        }\r\n\r\n        const value =\r\n            typeof upperbound === 'number' && endIndex > 0 ? upperbound : key;\r\n        return `@media (max-width:${value - step / 100}${unit})`;\r\n    }\r\n\r\n    function between(start, end) {\r\n        const endIndex = keys.indexOf(end) + 1;\r\n\r\n        if (endIndex === keys.length) {\r\n            return up(start);\r\n        }\r\n\r\n        return (\r\n            `@media (min-width:${values[start]}${unit}) and ` +\r\n            `(max-width:${values[keys[endIndex]] - step / 100}${unit})`\r\n        );\r\n    }\r\n\r\n    function only(key) {\r\n        return between(key, key);\r\n    }\r\n\r\n    function width(key) {\r\n        return values[key];\r\n    }\r\n\r\n    return {\r\n        keys,\r\n        values,\r\n        up,\r\n        down,\r\n        between,\r\n        only,\r\n        width,\r\n        ...other,\r\n    };\r\n}\r\n","export const AREA = new class {\r\n    fillTime = 1000;\r\n    particlesCount = 60;\r\n    fadingStart = 0.8;\r\n    particlesTtlSpread =  0.1;\r\n\r\n    fadingStartOn = this.fillTime * this.fadingStart;\r\n    fadingDelta = 1 / this.fadingStartOn;\r\n}();\r\n\r\nexport const AREA_OVERLAY = new class {\r\n    fadeTime = 200;\r\n    fadingDelta = 1 / this.fadeTime;\r\n}();\r\n\r\nexport const COLORS = {\r\n    activeTint: 0x811000,\r\n    passedTint: 0x4A2319,\r\n\r\n    charTints: ['#021d3f', '#D62F01', '#400000', '#ffffff']\r\n};\r\n\r\nexport const FONTS = {\r\n    main: 'Neucha',\r\n    mainSize: 66,\r\n    secondarySize: 30\r\n};\r\n\r\nexport const SIZES = {\r\n    UI: {\r\n        topPanelHeightFactor: 0.17,\r\n        buttonPanelHeightFactor: 0.14,\r\n        panelPaddingPx: 20,\r\n\r\n        buttonScalePc: 7,\r\n        undoPaddingFactor: 0.04,\r\n\r\n        topTransitionHeightPx: 166,\r\n        bottomTransitionHeightPx: 205,\r\n        transitionElementWidthPx: 2000,\r\n    },\r\n\r\n    worldWidth: 9070,\r\n    worldHeight: 6200,\r\n};\r\n\r\nexport const TOKENS = new class {\r\n    fromScale = 7;\r\n    toScale = 2;\r\n    time = 250;\r\n\r\n    deltaScale = (this.fromScale - this.toScale) / this.time;\r\n    deltaAlpha = 1 / this.time;\r\n}();\r\n","import createBreakpoints from './createBreakpoints';\r\nimport { Size } from 'react-virtualized';\r\nimport { SIZES } from '../mapView/constants';\r\n\r\nexport interface PageSizes {\r\n    top: number,\r\n    bottom: number;\r\n    middle: number;\r\n\r\n    viewport: Size\r\n}\r\n\r\nexport const createThemeFromScreenSize = (size: Size) => {\r\n    const top = ~~(SIZES.UI.buttonPanelHeightFactor * size.height) + SIZES.UI.panelPaddingPx * 2;\r\n    const bottom = ~~(SIZES.UI.buttonPanelHeightFactor * size.height);\r\n    const middle = size.height - top - bottom;\r\n\r\n    const theme = createTheme({\r\n        top, bottom, middle, viewport: size\r\n    });\r\n    return theme;\r\n}\r\n\r\nexport const createTheme = (pageSizes: PageSizes) => {\r\n    return {\r\n        breakpoints: createBreakpoints({\r\n            values: {\r\n                xs: 0,\r\n                sm: 576,\r\n                md: 768,\r\n                lg: 992,\r\n                xl: 1200,\r\n            },\r\n        }),\r\n        pageSizes\r\n    }\r\n};\r\n\r\nexport type Theme = ReturnType<typeof createTheme>;\r\n","import { createStyles } from '@material-ui/styles';\r\n\r\nexport const styles = createStyles({\r\n    wrapper: {\r\n        // background: '#000000',\r\n        position: 'absolute',\r\n        left: 200,\r\n        top: 100,\r\n        width: 600,\r\n        height: 1000,\r\n    },\r\n    cardRow: {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        padding: '2vw'\r\n    },\r\n    card: {\r\n        width: '15vw',\r\n        height: '24vw'\r\n    }\r\n});\r\n","import { Size } from 'react-virtualized';\r\nimport { CSSProperties } from 'react';\r\n\r\nexport const sizeCss = (size: Size, padding: number = 0): CSSProperties => {\r\n    const paddedHeight = size.height - padding * 2;\r\n    const width = size.width - padding * 2;\r\n\r\n    return { height: paddedHeight, maxHeight: paddedHeight, width }\r\n};\r\n\r\nexport const calcCss = (size: Size, part: number, side: 'vmin' | 'vmax' | 'width' | 'height' | 'vh' | 'vw') => {\r\n    side = side === 'vh' ? 'height' : side;\r\n    side = side === 'vw' ? 'width' : side;\r\n    const sideValue = side === 'width' || side === 'height'\r\n        ? size[side]\r\n        : side === 'vmin'\r\n            ? size.height < size.width ? size.height : size.width\r\n            : size.height < size.width ? size.width : size.height;\r\n\r\n    return sideValue * (part / 100);\r\n};\r\n","import React, { Component } from 'react';\r\nimport { withStyles, WithStyles } from '@material-ui/styles';\r\nimport { styles } from './mixedMediaModal.styles';\r\nimport { PageSizes } from '../../theme/createTheme';\r\nimport { SIZES } from '../../mapView/constants';\r\nimport { calcCss } from '../../../utils/sizeCss';\r\nimport { ModalController, ModalProps, RelativeSizes } from './modalController';\r\n\r\nexport interface ModalRenderer {\r\n    renderPixiBackdrop: () => React.ReactNode;\r\n    renderModal: () => React.ReactNode;\r\n}\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    controller?: ModalController | null;\r\n    pageSizes: PageSizes;\r\n    children: (modalState: ModalRenderer) => React.ReactNode;\r\n}\r\n\r\nfunction calculateSizes(pageSizes: PageSizes, relativeSizes: RelativeSizes) {\r\n    const { viewport } = pageSizes;\r\n    const undoShift = calcCss(viewport, SIZES.UI.buttonScalePc, 'height')\r\n        + ~~(pageSizes.viewport.height * SIZES.UI.undoPaddingFactor);\r\n    const height = calcCss(viewport, relativeSizes.h, 'vh');\r\n\r\n    const pixiTop = pageSizes.middle - undoShift - height;\r\n    let width = calcCss(viewport, relativeSizes.w, 'vw');\r\n    let maxWidth = ~~(height * 1.7);\r\n    if (width > maxWidth) {\r\n        width = maxWidth;\r\n    }\r\n    return {\r\n        height,\r\n        width,\r\n        left: ~~((viewport.width - width) / 2),\r\n        pixiTop,\r\n        bottom: pageSizes.bottom + undoShift\r\n    }\r\n}\r\n\r\nexport type ModalSizes = ReturnType<typeof calculateSizes>;\r\n\r\nclass MixedMediaModal extends Component<Props> {\r\n\r\n    render() {\r\n        if (!this.props.controller) {\r\n            return this.props.children({\r\n                renderModal: () => null,\r\n                renderPixiBackdrop: () => null\r\n            });\r\n        }\r\n        const sizes = calculateSizes(this.props.pageSizes, this.props.controller.relativeSizes);\r\n        const modalProps: ModalProps = {\r\n            sizes,\r\n            pageSizes: this.props.pageSizes,\r\n            update: () => this.forceUpdate()\r\n        };\r\n        this.props.controller.setProps(modalProps);\r\n        return this.props.children({\r\n            renderModal: () => this.props.controller?.renderModal(modalProps),\r\n            renderPixiBackdrop: () => this.props.controller?.renderBackdrop(modalProps),\r\n        })\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(\r\n    MixedMediaModal\r\n);\r\n","import React, { Component } from 'react';\r\nimport { createThemeFromScreenSize, Theme } from '../theme/createTheme';\r\nimport { AutoSizer, Size } from 'react-virtualized';\r\nimport { ThemeProvider } from '@material-ui/styles';\r\n\r\ninterface Props {\r\n    children: (theme: Theme) => React.ReactNode;\r\n}\r\n\r\nclass Layout extends Component<Props> {\r\n\r\n    private theme?: Theme;\r\n\r\n    private getTheme = (size: Size) => {\r\n        if (!this.theme) {\r\n            return this.theme = createThemeFromScreenSize(size);\r\n        }\r\n        if (this.theme.pageSizes.viewport.height === size.height && this.theme.pageSizes.viewport.width === size.width) {\r\n            return this.theme;\r\n        }\r\n        return this.theme = createThemeFromScreenSize(size);\r\n    };\r\n\r\n    render() {\r\n        return <div style={ { width: '100vw', height: '100vh' } }><AutoSizer>\r\n            { (size) => {\r\n                const theme = this.getTheme(size);\r\n                return <ThemeProvider theme={ theme }>\r\n                    { this.props.children(theme) }\r\n                </ThemeProvider>\r\n            } }\r\n        </AutoSizer>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default Layout;\r\n","import { Theme } from '../components/theme/createTheme';\r\nimport { SIZES } from '../components/mapView/constants';\r\n\r\nexport function breakScaleBkg(theme: Theme, height: number) {\r\n    return {\r\n        ...scaledBackground(1, height),\r\n        [theme.breakpoints.down('sm')]: {\r\n            ...scaledBackground(1, height)\r\n        },\r\n        [theme.breakpoints.down('md')]: {\r\n            ...scaledBackground(1, height)\r\n        },\r\n        [theme.breakpoints.down('xl')]: {\r\n            ...scaledBackground(3, height)\r\n        }\r\n    }\r\n}\r\n\r\nexport function scaledBackground(factor: number, height: number) {\r\n    return {\r\n        height: ~~(SIZES.UI.bottomTransitionHeightPx / factor),\r\n        backgroundSize: `${ ~~(SIZES.UI.transitionElementWidthPx / factor) }px ${ ~~(height / factor) }px`,\r\n    }\r\n}\r\n","import { createStyles } from '@material-ui/styles';\r\nimport { COLORS, SIZES } from '../../mapView/constants';\r\nimport { Theme } from '../../theme/createTheme';\r\nimport { breakScaleBkg } from '../../../utils/scaleBreakdown';\r\n\r\nexport const styles = (theme: Theme) => {\r\n    return createStyles({\r\n        wrapper: {\r\n            color: '#' + COLORS.activeTint.toString(16),\r\n            backgroundColor: '#000000',\r\n            height: theme.pageSizes.top,\r\n            width: theme.pageSizes.viewport.width,\r\n            position: 'absolute',\r\n            zIndex: 100,\r\n        },\r\n        padding: {\r\n            paddingTop: '1vh',\r\n            paddingLeft: '2vw',\r\n            paddingRight: '2vw',\r\n            // padding: SIZES.UI.panelPaddingPx\r\n        },\r\n        mainRow: {\r\n            display: 'flex',\r\n            flexDirection: 'row',\r\n            fontSize: '7vh',\r\n            paddingLeft: '2vw',\r\n            justifyContent: 'space-between'\r\n        },\r\n        secondaryRow: {\r\n            fontSize: '3vh',\r\n            textAlign: 'center',\r\n            verticalAlign: 'middle',\r\n            height: '6vh',\r\n            width: '100vw',\r\n            display: 'table-cell',\r\n            '&.accented': {\r\n                color: '#e7ea81'\r\n            }\r\n        },\r\n        title: {\r\n            whiteSpace: 'nowrap',\r\n            fontSize: '40px',\r\n        },\r\n        stylizedTransition: {\r\n            position: 'absolute',\r\n            zIndex: 100,\r\n            backgroundImage: 'url(ui/crows_legs.png)',\r\n            ...breakScaleBkg(theme, SIZES.UI.bottomTransitionHeightPx),\r\n            backgroundRepeat: 'repeat-x',\r\n            width: '100%',\r\n            pointerEvents: 'none',\r\n            top: ~~theme.pageSizes.top - 1\r\n        }\r\n    });\r\n};\r\n","import { createStyles } from '@material-ui/styles';\r\n\r\nexport const styles = createStyles({\r\n    button: {\r\n        '& :hover': {\r\n            filter: 'brightness(150%)'\r\n        },\r\n        width: '7vh',\r\n        height: '7vh'\r\n    },\r\n    tooltip: {\r\n        fontSize: '6vw',\r\n        boxShadow: '10px 10px 30px 0px rgba(0,0,0,0.75)'\r\n    }\r\n});\r\n","import React from 'react';\r\n\r\ninterface Props {\r\n    children: React.ReactNode;\r\n    onLongPressEnd?: () => void;\r\n    onLongPressStart?: () => void;\r\n    onClick?: () => void;\r\n    onDown?: () => void;\r\n\r\n    clickDelay?: number;\r\n    longPressDelay?: number;\r\n    deb?: string;\r\n}\r\n\r\nconst defaultDelay = 200;\r\nconst defaultLongPressDelay = 800;\r\n\r\nexport const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\r\n\r\nclass Holdable extends React.Component<Props> {\r\n\r\n    containerRef = React.createRef<HTMLDivElement>();\r\n\r\n    private timerId: any = 0;\r\n    private clickDelay: number = 0;\r\n    private longPressDelay: number = 0;\r\n\r\n    private holdStartTime = 0;\r\n    private holding = false;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.setProps(props);\r\n    }\r\n\r\n    setProps = (props: Props) => {\r\n        this.clickDelay = props.clickDelay || defaultDelay;\r\n        this.longPressDelay = props.longPressDelay || defaultLongPressDelay;\r\n        if (this.timerId) {\r\n            clearTimeout(this.timerId);\r\n        }\r\n        this.holding = false;\r\n        this.holdStartTime = 0;\r\n    };\r\n\r\n    componentDidUpdate(prevProps: Readonly<Props>, prevState: Readonly<{}>, snapshot?: any): void {\r\n        if (this.props !== prevProps) {\r\n            this.setProps(this.props);\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        if (this.timerId) {\r\n            clearTimeout(this.timerId);\r\n        }\r\n        this.holdEnd();\r\n    }\r\n\r\n    render() {\r\n        return <div onMouseDown={ isMobile ? undefined : this.mouseDown }\r\n                    onMouseUp={ isMobile ? undefined : this.mouseUp } onTouchStartCapture={ this.touchStart }\r\n                    onTouchEnd={ this.touchEnd } ref={this.containerRef}>\r\n            { this.props.children }\r\n        </div>\r\n    }\r\n\r\n    touchStart = (ev: React.SyntheticEvent) => {\r\n        this.holdStartTime = Date.now();\r\n        this.holdStart();\r\n    };\r\n\r\n    mouseDown = (ev: React.SyntheticEvent) => {\r\n        this.holdStart();\r\n    };\r\n\r\n    mouseUp = (ev: React.MouseEvent) => {\r\n        this.holdEnd(ev);\r\n    };\r\n\r\n    touchEnd = (ev: React.TouchEvent) => {\r\n        this.holdEnd(ev);\r\n    };\r\n\r\n    holdStart = () => {\r\n        if (this.timerId) {\r\n            clearTimeout(this.timerId);\r\n            this.timerId = 0;\r\n        }\r\n        this.holdStartTime = Date.now();\r\n        this.holding = true;\r\n        if (this.props.onLongPressStart) {\r\n            this.timerId = setTimeout(() => {\r\n                this.props.onLongPressStart!();\r\n            }, this.longPressDelay);\r\n        }\r\n        if (this.props.onDown) {\r\n            this.props.onDown()\r\n        }\r\n    };\r\n\r\n    holdEnd = (ev?: React.MouseEvent | React.TouchEvent) => {\r\n        const holdTime = Date.now() - this.holdStartTime;\r\n        if (this.timerId) {\r\n            clearTimeout(this.timerId);\r\n            this.timerId = 0;\r\n        }\r\n        try {\r\n            if (holdTime < this.longPressDelay) {\r\n                if (ev && this.props.onClick && this.holding && this.isWithin(ev))\r\n                    this.props.onClick();\r\n            } else if (holdTime >= this.longPressDelay && this.props.onLongPressEnd) {\r\n                this.props.onLongPressEnd();\r\n            }\r\n        } finally {\r\n            this.holding = false;\r\n        }\r\n    };\r\n\r\n    isWithin = (ev: React.MouseEvent | React.TouchEvent) => {\r\n        let rect = this.containerRef.current!.getBoundingClientRect();\r\n        let x, y = 0;\r\n        if ('touches' in ev) {\r\n            x = ev.changedTouches[0].clientX;\r\n            y = ev.changedTouches[0].clientY;\r\n        } else {\r\n            x = ev.clientX;\r\n            y = ev.clientY;\r\n        }\r\n        return (rect.x <= x && x <= rect.x + rect.width)\r\n            && (rect.y <= y && y <= rect.y + rect.height);\r\n    }\r\n}\r\n\r\nexport default Holdable;\r\n","import React from 'react';\r\nimport { withStyles, WithStyles } from '@material-ui/styles';\r\nimport { styles } from './button.styles';\r\nimport ReactTooltip from 'react-tooltip';\r\nimport Holdable, { isMobile } from './holdable';\r\n\r\nexport type TooltipDirection = 'top' | 'right' | 'bottom' | 'left';\r\n\r\nexport interface Tooltip {\r\n    tooltipHint: React.ReactNode;\r\n    id: string;\r\n    direction?: TooltipDirection;\r\n}\r\n\r\nexport interface ButtonProps {\r\n    iconHref: string;\r\n    isVisible?: boolean;\r\n    isActive?: boolean;\r\n    unpressableInnactive?: boolean;\r\n    onClick?: () => void;\r\n    styles?: React.CSSProperties;\r\n\r\n    tooltip?: Tooltip;\r\n}\r\n\r\ninterface Props extends WithStyles<typeof styles>, ButtonProps {\r\n}\r\n\r\nclass Button extends React.Component<Props> {\r\n\r\n    divRef = React.createRef<HTMLDivElement>();\r\n\r\n    private onClick = () => {\r\n        ReactTooltip.hide(this.divRef.current!);\r\n        if (this.props.tooltip && !this.props.onClick) {\r\n            ReactTooltip.show(this.divRef.current!);\r\n            setTimeout(() => ReactTooltip.hide(this.divRef.current!), 0);\r\n        }\r\n        if (this.props.onClick && (this.props.isActive || !this.props.unpressableInnactive)) {\r\n            this.props.onClick()\r\n        }\r\n    };\r\n\r\n    render() {\r\n        const isVisible = this.props.isVisible === undefined ? true : this.props.isVisible;\r\n        const isActive = this.props.isActive === undefined ? true : this.props.isActive;\r\n        return (\r\n            <>\r\n                <Holdable onClick={ this.onClick }\r\n                          deb={ this.props.iconHref }\r\n                          onLongPressStart={ () => ReactTooltip.show(this.divRef.current!) }\r\n                          onLongPressEnd={ () => ReactTooltip.hide(this.divRef.current!) }>\r\n                    <div data-tip=\"\" data-for={ this.props.tooltip?.id }\r\n                         ref={ this.divRef }\r\n                         style={\r\n                             {...{\r\n                                 display: isVisible ? 'block' : 'none',\r\n                                 filter: isActive ? '' : 'grayscale(1)'\r\n                             }, ...this.props.styles } }\r\n                         className={ this.props.classes.button }>\r\n                        <img alt={ this.props.iconHref } src={ this.props.iconHref }\r\n                             style={ { WebkitTouchCallout: 'none' } } height={ '100%' }/>\r\n                    </div>\r\n                </Holdable>\r\n                { this.props.tooltip ?\r\n                    <ReactTooltip key={ this.props.tooltip.id } event={ isMobile ? 'bogus-event' : 'mouseover' } eventOff={ isMobile ? 'bogus-event' : 'mouseout' }\r\n                                  id={ this.props.tooltip.id }\r\n                                  effect={ 'solid' } place={ this.props.tooltip?.direction || 'left' }\r\n                                  delayHide={ 1000 }\r\n                                  delayShow={ isMobile ? 0 : 1000 }\r\n                                  className={ this.props.classes.tooltip }>\r\n                        { this.props.tooltip.tooltipHint }\r\n                    </ReactTooltip> : null }\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(Button);\r\n","import { Polygon } from '../model';\r\n\r\nexport const hitAreas = {\r\n \"area01\": [{\"x\":752,\"y\":3572},{\"x\":564,\"y\":3428},{\"x\":284,\"y\":3072},{\"x\":208,\"y\":2908},{\"x\":152,\"y\":2680},{\"x\":428,\"y\":2500},{\"x\":656,\"y\":2276},{\"x\":1084,\"y\":1868},{\"x\":1400,\"y\":1564},{\"x\":1784,\"y\":1192},{\"x\":2060,\"y\":1004},{\"x\":2296,\"y\":896},{\"x\":2468,\"y\":820},{\"x\":2740,\"y\":728},{\"x\":2744,\"y\":840},{\"x\":2580,\"y\":1240},{\"x\":2468,\"y\":1612},{\"x\":2432,\"y\":1932},{\"x\":2432,\"y\":2336},{\"x\":2476,\"y\":2704},{\"x\":2112,\"y\":2748},{\"x\":1820,\"y\":2824},{\"x\":1460,\"y\":3024},{\"x\":944,\"y\":3388}],\r\n \"area02\": [{\"x\":2272,\"y\":4712},{\"x\":1952,\"y\":4696},{\"x\":1588,\"y\":4552},{\"x\":1312,\"y\":4248},{\"x\":852,\"y\":3704},{\"x\":756,\"y\":3560},{\"x\":1088,\"y\":3280},{\"x\":1360,\"y\":3096},{\"x\":1576,\"y\":2944},{\"x\":1888,\"y\":2808},{\"x\":2144,\"y\":2752},{\"x\":2464,\"y\":2720},{\"x\":2516,\"y\":2900},{\"x\":2528,\"y\":3256},{\"x\":2432,\"y\":3608},{\"x\":2276,\"y\":4184},{\"x\":2260,\"y\":4708}],\r\n \"area03\": [{\"x\":2796,\"y\":5760},{\"x\":2648,\"y\":5492},{\"x\":2520,\"y\":5072},{\"x\":2448,\"y\":4712},{\"x\":2456,\"y\":4208},{\"x\":2540,\"y\":3784},{\"x\":3292,\"y\":3744},{\"x\":3704,\"y\":3800},{\"x\":3624,\"y\":4532},{\"x\":3756,\"y\":5200}],\r\n \"area04\": [{\"x\":3772,\"y\":5224},{\"x\":3676,\"y\":4908},{\"x\":3640,\"y\":4572},{\"x\":3712,\"y\":3796},{\"x\":4932,\"y\":3856},{\"x\":4928,\"y\":5352}],\r\n \"area05\": [{\"x\":4932,\"y\":5364},{\"x\":4940,\"y\":3848},{\"x\":5960,\"y\":3960},{\"x\":6252,\"y\":4740},{\"x\":6268,\"y\":5636},{\"x\":5360,\"y\":5544}],\r\n \"area06\": [{\"x\":6468,\"y\":4908},{\"x\":6328,\"y\":4280},{\"x\":6132,\"y\":3880},{\"x\":6696,\"y\":3440},{\"x\":7096,\"y\":3324},{\"x\":7528,\"y\":3456},{\"x\":7812,\"y\":3780},{\"x\":8052,\"y\":4216},{\"x\":7888,\"y\":4392},{\"x\":7308,\"y\":4728},{\"x\":6636,\"y\":4900}],\r\n \"area07\": [{\"x\":7392,\"y\":3376},{\"x\":7292,\"y\":2728},{\"x\":7316,\"y\":2112},{\"x\":7416,\"y\":1756},{\"x\":7896,\"y\":1596},{\"x\":8268,\"y\":1984},{\"x\":8544,\"y\":2532},{\"x\":8224,\"y\":3432}],\r\n \"area08\": [{\"x\":6536,\"y\":1728},{\"x\":6432,\"y\":1156},{\"x\":6236,\"y\":944},{\"x\":5388,\"y\":780},{\"x\":5732,\"y\":388},{\"x\":6356,\"y\":276},{\"x\":7088,\"y\":360},{\"x\":7808,\"y\":844},{\"x\":7440,\"y\":1128},{\"x\":7356,\"y\":1488},{\"x\":7016,\"y\":1704}],\r\n \"area09\": [{\"x\":5244,\"y\":1884},{\"x\":4968,\"y\":1836},{\"x\":4608,\"y\":1708},{\"x\":4260,\"y\":1640},{\"x\":3768,\"y\":1640},{\"x\":3824,\"y\":1440},{\"x\":3916,\"y\":1008},{\"x\":3936,\"y\":784},{\"x\":3868,\"y\":612},{\"x\":3920,\"y\":560},{\"x\":4132,\"y\":416},{\"x\":4296,\"y\":360},{\"x\":4684,\"y\":324},{\"x\":5052,\"y\":344},{\"x\":5328,\"y\":424},{\"x\":5212,\"y\":992}],\r\n \"area10\": [{\"x\":3676,\"y\":2276},{\"x\":3208,\"y\":2300},{\"x\":2944,\"y\":2252},{\"x\":2768,\"y\":2152},{\"x\":2608,\"y\":2020},{\"x\":2560,\"y\":1940},{\"x\":2604,\"y\":1592},{\"x\":2700,\"y\":1336},{\"x\":2768,\"y\":1180},{\"x\":2864,\"y\":1060},{\"x\":3044,\"y\":868},{\"x\":3324,\"y\":772},{\"x\":3516,\"y\":692},{\"x\":3660,\"y\":644},{\"x\":3840,\"y\":596},{\"x\":3884,\"y\":644},{\"x\":3912,\"y\":752},{\"x\":3924,\"y\":896},{\"x\":3908,\"y\":1020},{\"x\":3824,\"y\":1472},{\"x\":3776,\"y\":1620},{\"x\":3744,\"y\":1796}],\r\n \"area11\": [{\"x\":2544,\"y\":3756},{\"x\":2768,\"y\":3724},{\"x\":3044,\"y\":3724},{\"x\":3344,\"y\":3756},{\"x\":3636,\"y\":3788},{\"x\":3972,\"y\":3792},{\"x\":4332,\"y\":3800},{\"x\":4508,\"y\":3364},{\"x\":4096,\"y\":3252},{\"x\":3832,\"y\":3052},{\"x\":3704,\"y\":2736},{\"x\":3680,\"y\":2312},{\"x\":3680,\"y\":2268},{\"x\":3312,\"y\":2300},{\"x\":3008,\"y\":2264},{\"x\":2736,\"y\":2124},{\"x\":2560,\"y\":1968},{\"x\":2672,\"y\":2832},{\"x\":2712,\"y\":3100}],\r\n \"area12\": [{\"x\":4332,\"y\":3800},{\"x\":4576,\"y\":3064},{\"x\":4720,\"y\":2516},{\"x\":4980,\"y\":2320},{\"x\":5368,\"y\":2300},{\"x\":5556,\"y\":2644},{\"x\":5972,\"y\":3956}],\r\n \"area13\": [{\"x\":6116,\"y\":3864},{\"x\":5860,\"y\":3156},{\"x\":5772,\"y\":2764},{\"x\":6240,\"y\":2472},{\"x\":6408,\"y\":2220},{\"x\":6548,\"y\":1744},{\"x\":6864,\"y\":1728},{\"x\":7392,\"y\":1468},{\"x\":7436,\"y\":1744},{\"x\":7320,\"y\":1980},{\"x\":7344,\"y\":3348},{\"x\":6788,\"y\":3384}],\r\n \"area14\": [{\"x\":5784,\"y\":2764},{\"x\":5560,\"y\":2368},{\"x\":5436,\"y\":2004},{\"x\":5328,\"y\":1360},{\"x\":5392,\"y\":784},{\"x\":6240,\"y\":952},{\"x\":6372,\"y\":1048},{\"x\":6536,\"y\":1724},{\"x\":6396,\"y\":2224},{\"x\":6140,\"y\":2568}],\r\n \"area15\": [{\"x\":4508,\"y\":3352},{\"x\":4128,\"y\":3272},{\"x\":3804,\"y\":2996},{\"x\":3700,\"y\":2644},{\"x\":3692,\"y\":2252},{\"x\":3744,\"y\":1828},{\"x\":3772,\"y\":1640},{\"x\":3920,\"y\":1636},{\"x\":4256,\"y\":1640},{\"x\":4512,\"y\":1692},{\"x\":4808,\"y\":1772},{\"x\":5016,\"y\":1856},{\"x\":5148,\"y\":1888},{\"x\":5240,\"y\":1892},{\"x\":5372,\"y\":2312},{\"x\":5172,\"y\":2284},{\"x\":4908,\"y\":2336},{\"x\":4780,\"y\":2436},{\"x\":4704,\"y\":2544},{\"x\":4632,\"y\":2776}],\r\n \"steppe01\": [{\"x\":156,\"y\":2664},{\"x\":280,\"y\":3048},{\"x\":584,\"y\":3444},{\"x\":740,\"y\":3564},{\"x\":1136,\"y\":4048},{\"x\":1604,\"y\":4556},{\"x\":1812,\"y\":4648},{\"x\":2096,\"y\":4724},{\"x\":2268,\"y\":4716},{\"x\":2672,\"y\":5836},{\"x\":712,\"y\":5556},{\"x\":8,\"y\":4992}],\r\n \"steppe02\": [{\"x\":2792,\"y\":5764},{\"x\":3296,\"y\":5500},{\"x\":3632,\"y\":5284},{\"x\":3944,\"y\":5164},{\"x\":4328,\"y\":5152},{\"x\":4760,\"y\":5292},{\"x\":5112,\"y\":5464},{\"x\":5576,\"y\":5596},{\"x\":5936,\"y\":5648},{\"x\":6276,\"y\":5644},{\"x\":6368,\"y\":6196},{\"x\":3076,\"y\":6200}],\r\n \"steppe03\": [{\"x\":6596,\"y\":6192},{\"x\":6512,\"y\":5812},{\"x\":6456,\"y\":5464},{\"x\":6456,\"y\":4920},{\"x\":7444,\"y\":4656},{\"x\":8052,\"y\":4224},{\"x\":8056,\"y\":4224},{\"x\":7856,\"y\":3848},{\"x\":8260,\"y\":3384},{\"x\":8444,\"y\":2796},{\"x\":8532,\"y\":2336},{\"x\":8120,\"y\":1776},{\"x\":8624,\"y\":1660},{\"x\":9048,\"y\":1160},{\"x\":9056,\"y\":4640},{\"x\":8972,\"y\":6188}],\r\n};\r\n\r\nexport const areasBBoxes = {\"area01\":{\"x\":162,\"y\":741,\"width\":2587,\"height\":2830},\"area02\":{\"x\":765,\"y\":2710,\"width\":1793,\"height\":2003},\"area10\":{\"x\":2563,\"y\":599,\"width\":1355,\"height\":1699},\"area11\":{\"x\":2549,\"y\":1989,\"width\":1955,\"height\":1804},\"area15\":{\"x\":3684,\"y\":1633,\"width\":1678,\"height\":1726},\"area09\":{\"x\":3785,\"y\":310,\"width\":1556,\"height\":1587},\"area03\":{\"x\":2420,\"y\":3724,\"width\":1338,\"height\":2036},\"area04\":{\"x\":3645,\"y\":3785,\"width\":1323,\"height\":1568},\"area12\":{\"x\":4359,\"y\":2282,\"width\":1606,\"height\":1695},\"area05\":{\"x\":4939,\"y\":3854,\"width\":1345,\"height\":1796},\"area14\":{\"x\":5337,\"y\":790,\"width\":1199,\"height\":1965},\"area08\":{\"x\":5393,\"y\":256,\"width\":2418,\"height\":1472},\"area13\":{\"x\":5789,\"y\":1472,\"width\":1638,\"height\":2392},\"area07\":{\"x\":7298,\"y\":1581,\"width\":1247,\"height\":2251},\"area06\":{\"x\":6119,\"y\":3325,\"width\":1933,\"height\":1588},\"steppe01\":{\"x\":-1,\"y\":2669,\"width\":2883,\"height\":3533},\"steppe02\":{\"x\":2803,\"y\":5153,\"width\":3566,\"height\":1046},\"steppe03\":{\"x\":6458,\"y\":1081,\"width\":2611,\"height\":5120}};\r\nexport const tokenPositions = {\"area01\":{\"x\":1568,\"y\":1359},\"area02\":{\"x\":1095,\"y\":940},\"area03\":{\"x\":650,\"y\":797},\"area04\":{\"x\":697,\"y\":747},\"area05\":{\"x\":620,\"y\":868},\"area06\":{\"x\":793,\"y\":930},\"area07\":{\"x\":470,\"y\":1300},\"area08\":{\"x\":1508,\"y\":1032},\"area09\":{\"x\":884,\"y\":806},\"area10\":{\"x\":621,\"y\":1247},\"area11\":{\"x\":660,\"y\":1128},\"area12\":{\"x\":713,\"y\":961},\"area13\":{\"x\":932,\"y\":1324},\"area14\":{\"x\":603,\"y\":945},\"area15\":{\"x\":550,\"y\":860},\"steppe01\":{\"x\":901,\"y\":2439},\"steppe02\":{\"x\":1514,\"y\":600},\"steppe03\":{\"x\":2049,\"y\":3504}};\r\n\r\nexport const steppe = ['steppe01', 'steppe02', 'steppe03'] as AreaKey[];\r\nexport type AreaKey = keyof typeof hitAreas;\r\nexport const areaKeys = Object.keys(hitAreas) as AreaKey[];\r\nexport const areas: { [key: string]: Polygon } = hitAreas as any;\r\n\r\n","import { AreaFill, AreaFills, Point, Rectangle } from './model';\r\nimport { AreaKey, steppe } from './data/areas';\r\nimport connections from './data/connections.json';\r\n\r\nconst fastMemoize = require('fast-memoize');\r\n\r\nfunction memoize<T extends (...args: any[]) => any>(fn: T): T {\r\n    return fastMemoize(fn) as any;\r\n}\r\n\r\nexport const getRectangle = memoize((points: Point[]): Rectangle => {\r\n    let minX = NaN, minY = NaN, maxX = NaN, maxY = NaN;\r\n\r\n    for (let { x, y } of points) {\r\n        if (isNaN(minX) || x < minX) {\r\n            minX = x;\r\n        }\r\n        if (isNaN(maxX) || x > maxX) {\r\n            maxX = x;\r\n        }\r\n        if (isNaN(minY) || y < minY) {\r\n            minY = y;\r\n        }\r\n        if (isNaN(maxY) || y > maxY) {\r\n            maxY = y;\r\n        }\r\n    }\r\n\r\n    return {\r\n        x: minX,\r\n        y: minY,\r\n        width: maxX - minX,\r\n        height: maxY - minY\r\n    };\r\n});\r\n\r\nexport const zero = (): Point => ({ x: 0, y: 0 });\r\n\r\nexport function getRandomInt(min: number, max: number) {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nexport function getRandomBool() {\r\n    return Math.random() > 0.5;\r\n}\r\n\r\nexport const delay = (ms: number) => new Promise(r => setTimeout(r, ms));\r\n\r\nexport type RefPresentation = 'raw' | 'url' | 'idSelector';\r\n\r\nconst presentWrap = (value: string, presentation: RefPresentation) => {\r\n    switch (presentation) {\r\n        case 'idSelector': return '#' + value;\r\n        case 'url': return 'url(#' + value + ')';\r\n        default: return value;\r\n    }\r\n};\r\n\r\nfunction present<Arg = string>(fn: (key: Arg) => string) {\r\n    return (key: Arg, p: RefPresentation = 'raw') => presentWrap(fn(key), p)\r\n}\r\nfunction presentVal(val: string) {\r\n    return (p: RefPresentation = 'raw') => presentWrap(val, p)\r\n}\r\n\r\nexport const refs = {\r\n    fillId: present<AreaFill>(key => `fill-${key}`),\r\n    maskId: present(key => `mask_${key}`),\r\n    rootSvg: presentVal('rootSvg'),\r\n    areaPolygon: present<AreaKey>(key => key),\r\n    borderId: present<AreaKey>(key => `borders_${key}`),\r\n    vectorBordersId: presentVal(`vector_borders`),\r\n\r\n    //paths\r\n    maskPath: present<AreaKey>(key => `areas/mask/${key}.png`)\r\n};\r\n\r\nexport const getConnectedAreas = (areaKey: AreaKey) => {\r\n    const areaNumber = areaToLocation(areaKey);\r\n    return numberToConnectedAreas(areaNumber);\r\n};\r\n\r\nexport const areaToLocation = (areaKey: AreaKey) => {\r\n    if (steppe.indexOf(areaKey) >= 0) return 0;\r\n    return parseInt(areaKey.slice(-2));\r\n};\r\n\r\nexport const numberToConnectedAreas = (index: number) => {\r\n    const entry = connections.find(con => con.number === index);\r\n    if (!entry) return [];\r\n    return entry.connections.map(i => locationToAreaKeys(i)).flat();\r\n};\r\n\r\nexport const locationToAreaKeys = (location: number): AreaKey[] => {\r\n    if (location === 0) {\r\n        return steppe as AreaKey[];\r\n    }\r\n    return [locationToAreaKey(location)];\r\n};\r\n\r\nexport const pointsEq = (point1: Point, point2: Point) => point1.x === point2.x && point1.y === point2.y;\r\n\r\nexport const locationToAreaKey = (index: number): AreaKey => {\r\n    if (index === 0) {\r\n        return steppe[0];\r\n    }\r\n    return `area${index.toString().padStart(2, '0')}` as AreaKey;\r\n};\r\nexport type Depromisify<T> = T extends Promise<infer D> ? D : T;\r\n","import React, { Component } from 'react';\r\nimport * as _ from 'lodash';\r\nimport { delay } from '../../../utils';\r\n\r\ntype LimitType = 'vw' | 'vh' | 'px';\r\n\r\ninterface Limit {\r\n    type: LimitType;\r\n    value: number;\r\n}\r\n\r\ninterface Props {\r\n    children: string;\r\n    lines: number;\r\n    maxHeight: Limit;\r\n    maxWidth: Limit;\r\n}\r\n\r\nclass FitText extends Component<Props> {\r\n\r\n    private ref = React.createRef<HTMLDivElement>();\r\n    private debouncedResize: () => void;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.debouncedResize = _.debounce(this.recalculate, 200);\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        window.addEventListener('resize', this.debouncedResize);\r\n        this.recalculate();\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        window.removeEventListener('resize', this.debouncedResize);\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<Props>, prevState: Readonly<{}>, snapshot?: any): void {\r\n        if (this.props.children !== prevProps.children) {\r\n            this.recalculate();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return <div ref={this.ref}>\r\n            { this.props.children }\r\n        </div>\r\n    }\r\n\r\n    recalculate = async () => {\r\n        if (!this.ref.current) {\r\n            return;\r\n        }\r\n        const initialSizes = this.getBodySizeSnapshot();\r\n        const maxWidthPx = this.calcLimit(this.props.maxWidth);\r\n        const maxHeightPx = this.calcLimit(this.props.maxHeight);\r\n\r\n        let currentSize = (maxHeightPx / this.props.lines) - 1;\r\n        this.setSize(currentSize);\r\n        this.ref.current.style.lineHeight = ~~(this.calcLimit(this.props.maxHeight) / this.props.lines) + 'px';\r\n        await delay(0);\r\n        let dims = this.getDims();\r\n        while (dims.width > maxWidthPx || dims.height > maxHeightPx) {\r\n            this.setSize(--currentSize);\r\n            await delay(0);\r\n            if (initialSizes !== this.getBodySizeSnapshot()) {\r\n                await this.recalculate();\r\n                return;\r\n            }\r\n            dims = this.getDims();\r\n        }\r\n    };\r\n\r\n    getBodySizeSnapshot = () => `${document.body.clientWidth}, ${document.body.clientHeight}`;\r\n\r\n    setSize = (size: number) => {\r\n        if (!this.ref.current) {\r\n            return;\r\n        }\r\n        const element = this.ref.current;\r\n\r\n        element.style.fontSize = size + 'px';\r\n    };\r\n\r\n    getDims = () => {\r\n        if (!this.ref.current) {\r\n            return { width: 0, height: 0 };\r\n        }\r\n        const element = this.ref.current;\r\n        return {\r\n            width: element.scrollWidth,\r\n            height: element.scrollHeight\r\n        }\r\n    };\r\n\r\n    calcLimit = (limit: Limit) => {\r\n        switch (limit.type) {\r\n            case 'px': return limit.value;\r\n            case 'vh': return document.body.clientHeight * limit.value * 0.01;\r\n            case 'vw': return document.body.clientWidth * limit.value * 0.01;\r\n        }\r\n        return limit.value;\r\n    };\r\n}\r\n\r\nexport default FitText;\r\n","import React, { Component } from 'react';\r\nimport { WithStyles, withStyles } from '@material-ui/styles';\r\nimport { styles } from './topPanel.styles';\r\nimport Button from '../button/button';\r\nimport classNames from 'classnames';\r\nimport FitText from '../fitText/fitText';\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    main?: string | null;\r\n    secondary?: string | null;\r\n    msgAccented?: boolean;\r\n    onMenuClick?: () => void;\r\n}\r\n\r\nclass TopPanel extends Component<Props> {\r\n    render() {\r\n\r\n        const { classes, main, secondary, msgAccented } = this.props;\r\n\r\n        const isAccented = msgAccented === undefined ? false : msgAccented;\r\n\r\n        return <div className={ classes.wrapper }>\r\n            <div className={ classes.padding }>\r\n                <div className={ classes.mainRow }>\r\n                    <div className={ classes.title }>\r\n                        <FitText lines={1} maxWidth={{ value: 65, type: 'vw' }} maxHeight={{ value: 7, type: 'vh' }}>\r\n                            { main || '' }\r\n                        </FitText>\r\n                    </div>\r\n                    <Button iconHref={'icons/menu_button.png'} onClick={this.props.onMenuClick} />\r\n                </div>\r\n                <div className={ classNames(classes.secondaryRow, { accented: isAccented }) }>\r\n                    <FitText lines={2} maxWidth={{ value: 100, type: 'vw' }} maxHeight={{ value: 7, type: 'vh' }}>\r\n                        { secondary || '' }\r\n                    </FitText>\r\n                </div>\r\n            </div>\r\n            <div className={ classes.stylizedTransition }/>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(TopPanel);\r\n","export type Character = {\r\n    name: string;\r\n    id: string;\r\n    closeFor: number;\r\n    gender: number;\r\n    isHealer?: boolean;\r\n};\r\n\r\nexport const characters: Character[] = [\r\n    // bak\r\n    { name: 'Андрей Стаматин', id: 'andrei', closeFor: 0, gender: 1 },\r\n    { name: 'Мария Каина', id: 'maria', closeFor: 0, gender: 0 },\r\n    { name: 'Младший Влад', id: 'vlad', closeFor: 0, gender: 1 },\r\n\r\n    // burah\r\n    { name: 'Александр Сабуров', id: 'alexandr', closeFor: 1, gender: 1 },\r\n    { name: 'Оспина', id: 'ospina', closeFor: 1, gender: 0 },\r\n    { name: 'Рубин', id: 'rubin', closeFor: 1, gender: 1 },\r\n\r\n    // samo\r\n    { name: 'Капелла', id: 'kapella', closeFor: 2, gender: 0 },\r\n    { name: 'Ноткин', id: 'notkin', closeFor: 2, gender: 1 },\r\n    { name: 'Спичка', id: 'spichka', closeFor: 2, gender: 1 },\r\n];\r\n\r\nexport const healerCharacters: Character[] = [\r\n    { name: 'Бакалавр', id: 'bakalavr', closeFor: 0, gender: 1, isHealer: true },\r\n    { name: 'Самозванка', id: 'samozvanka', closeFor: 1, gender: 0, isHealer: true },\r\n    { name: 'Гаруспик', id: 'garuspik', closeFor: 2, gender: 1, isHealer: true },\r\n];\r\n\r\nexport const allCharacters = characters.concat(healerCharacters);\r\n","import { AreaTileset, BBox, Point, QualityPreset, TilesetData } from '../../../model';\r\nimport { splitImgToTiles } from '../pixiUtils/canvasTiling';\r\nimport * as PIXI from 'pixi.js';\r\nimport { AreaKey, areaKeys, areasBBoxes, hitAreas, tokenPositions } from '../../../data/areas';\r\nimport { delay, Depromisify } from '../../../utils';\r\nimport { characters, healerCharacters } from '../../../data/characters';\r\n\r\nexport interface TextureTile {\r\n    x: number,\r\n    y: number,\r\n    tex: PIXI.Texture,\r\n}\r\n\r\nexport type Resources = Depromisify<ReturnType<typeof loadResources>>;\r\n\r\nexport type AreaData = {\r\n    key: AreaKey,\r\n    bbox: BBox,\r\n    overlay: {\r\n        scale: number,\r\n        tiles: TextureTile[]\r\n    },\r\n    mask: {\r\n        scale: number,\r\n        tex: PIXI.Texture\r\n    }\r\n    hitArea: PIXI.Polygon,\r\n    tokenPosition: Point\r\n}\r\n\r\n\r\nexport async function loadResources(app: PIXI.Application, quality: QualityPreset) {\r\n    console.group(`loading ${quality} preset...`);\r\n\r\n    const [mapTiles, areas, crows, characterCards] = await timed('total', () => Promise.all([\r\n        timed('map', () => loadMapTiles('low')),\r\n        timed('areas', () => loadAreas(quality)),\r\n        // splitImgToTiles('/borders.svg'),\r\n        loadCrowsTextures(app.loader),\r\n        loadCharacterCards(app.loader),\r\n    ])).catch(e => {\r\n        console.groupEnd();\r\n        throw e;\r\n    });\r\n\r\n    const data = {\r\n        mapTiles,\r\n        areas,\r\n        crows,\r\n        characterCards,\r\n        whiteHand: PIXI.Texture.from('icons/hand_white.svg'),\r\n        redHand: PIXI.Texture.from('icons/hand_red.svg'),\r\n        siegeToken: PIXI.Texture.from('icons/siege.png'),\r\n        cloudTex: PIXI.Texture.from('cards/cloud_tex.png'),\r\n        cardMaskTex: PIXI.Texture.from('cards/card_mask.png'),\r\n        missionCards: [PIXI.Texture.from(`cards/missions/12.jpg`)],\r\n        sizes: {\r\n            hand: 340,\r\n            siegeToken: 437\r\n        }\r\n    };\r\n\r\n    console.log('loaded data:', data);\r\n    console.groupEnd();\r\n    return data;\r\n}\r\n\r\n\r\nexport async function loadMapTiles(quality: QualityPreset) {\r\n    const rootPath = `map/tiles-${quality}`;\r\n    const indexPath = `${rootPath}/index.json`;\r\n\r\n    try {\r\n        const rsp = await fetch(indexPath);\r\n        const { scale, tiles }: TilesetData = await rsp.json();\r\n\r\n        return {\r\n            scale,\r\n            tiles: tiles.map(tile => ({\r\n                x: tile.x * scale,\r\n                y: tile.y * scale,\r\n                tex: PIXI.Texture.from(`${ rootPath }/${ tile.name }`, {\r\n                    mipmap: true\r\n                })\r\n            }))\r\n        };\r\n    } catch (e) {\r\n        return {\r\n            scale: 1,\r\n            tiles: []\r\n        }\r\n    }\r\n}\r\n\r\nexport async function loadAreas(quality: QualityPreset) {\r\n    const overlay = await loadAreaOverlayTiles(quality);\r\n    return areaKeys.map(key => {\r\n        const bbox = areasBBoxes[key];\r\n\r\n        const data: AreaData = {\r\n            key,\r\n            bbox,\r\n            overlay: {\r\n                scale: overlay.scale,\r\n                tiles: overlay.tiles[key]\r\n            },\r\n            mask: {\r\n                scale: 4,\r\n                tex: PIXI.Texture.from(`areas/mask/${key}.png`)\r\n            },\r\n            hitArea: new PIXI.Polygon(hitAreas[key].map(({x,y}) => new PIXI.Point(x, y))),\r\n            tokenPosition: tokenPositions[key]\r\n        };\r\n        return data;\r\n    })\r\n}\r\n\r\nexport async function loadAreaOverlayTiles(quality: QualityPreset) {\r\n    const rootPath = `areas/overlay/${quality}/`;\r\n    const indexPath = `${rootPath}/index.json`;\r\n    const areaTiles: { [key in AreaKey]: TextureTile[] } = {} as any;\r\n\r\n    try {\r\n        const rsp = await fetch(indexPath);\r\n        const { scale, areas }: AreaTileset = await rsp.json();\r\n\r\n        for (let area of areas) {\r\n            areaTiles[area.key] = area.tiles.map(tile => ({\r\n                tex: PIXI.Texture.from(`${rootPath}${area.key}/${tile.name}`, {\r\n                    mipmap: true\r\n                }),\r\n                x: tile.x * scale,\r\n                y: tile.y * scale\r\n            }))\r\n        }\r\n\r\n        return {\r\n            scale,\r\n            tiles: areaTiles\r\n        };\r\n    } catch (e) {\r\n        return {\r\n            scale: 1,\r\n            tiles: {} as typeof areaTiles\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport async function loadCrowsTextures(loader: PIXI.Loader) {\r\n    const data: { width: number, height: number, sprites: Point[] } = await fetch('ui/crowSprites/data.json')\r\n        .then(rsp => rsp.json());\r\n\r\n    const baseTex = PIXI.BaseTexture.from('ui/crowSprites/sheet.png');\r\n    const sprites = data.sprites.map(({x, y}) =>\r\n        new PIXI.Texture(baseTex, new PIXI.Rectangle(x, y, data.width, data.height))\r\n    );\r\n\r\n    return sprites;\r\n}\r\n\r\nexport async function loadCharacterCards(loader: PIXI.Loader) {\r\n    let obj: { [key: string]: PIXI.BaseTexture } = {} as any;\r\n    let onComplete = new Promise(r => loader.onComplete.add(r));\r\n    for (let character of [...characters, ...healerCharacters]) {\r\n        loader.add(`cards/${character.id}.jpg`);\r\n        obj[character.id] = new PIXI.BaseTexture(`cards/${character.id}.jpg`, {\r\n            alphaMode: PIXI.ALPHA_MODES.PREMULTIPLIED_ALPHA\r\n        });\r\n    }\r\n    loader.load();\r\n    await onComplete;\r\n    return obj;\r\n}\r\n\r\nconst timerKeys = {\r\n    total: '[Textures] total',\r\n    areas: '[Textures] > areas',\r\n    map: '[Textures] > map',\r\n    overlay: '[Textures] areas overlay'\r\n};\r\nfunction timed<T>(key: keyof typeof timerKeys, fn: () => T): T {\r\n    console.time(timerKeys[key]);\r\n    let isPromise = false;\r\n    try {\r\n        const promiseOrResult = fn() as any;\r\n        if (promiseOrResult && promiseOrResult['then']) {\r\n            isPromise = true;\r\n            return promiseOrResult.then((r: any) => {\r\n                console.timeEnd(timerKeys[key]);\r\n                return r;\r\n            })\r\n        }\r\n        return promiseOrResult;\r\n    } finally {\r\n        if (!isPromise) {\r\n            console.timeEnd(timerKeys[key]);\r\n        }\r\n    }\r\n}\r\n","import { Resources } from './loaders';\r\nimport React, { createContext, useContext } from 'react';\r\n\r\nexport const ResourcesContext = createContext<Resources | null>(null);\r\n\r\nexport interface WithResources {\r\n    resources: Resources;\r\n}\r\n\r\nexport function withResources<TProps extends WithResources>(WrappedComponent: React.ComponentType<TProps>) {\r\n    return (props: Omit<TProps, keyof WithResources>) => {\r\n        const resources = useContext(ResourcesContext);\r\n        if (!resources) return null;\r\n        return <WrappedComponent { ...props as any } resources={ resources }/>\r\n    };\r\n}\r\n","import React, { ReactNode } from 'react';\r\nimport { QualityPreset } from '../../../model';\r\nimport { loadResources, Resources } from './loaders';\r\nimport { withPixiApp } from '@inlet/react-pixi';\r\n\r\nexport * from './loaders';\r\nexport * from './context';\r\n\r\ninterface State {\r\n    resources: Resources | null\r\n}\r\n\r\ninterface Props {\r\n    children: (resources: Resources | null) => ReactNode;\r\n    onLoaded: (resources: Resources) => void;\r\n    qualityPreset: QualityPreset;\r\n    app: PIXI.Application;\r\n}\r\n\r\nlet cachedResources: Resources | null = null;\r\n\r\nclass LoadResources extends React.Component<Props, State> {\r\n\r\n    state: State = {\r\n        resources: cachedResources\r\n    };\r\n\r\n    componentDidMount(): void {\r\n        if (!this.state.resources) {\r\n            this.load(this.props.qualityPreset);\r\n        } else {\r\n            this.props.onLoaded(this.state.resources);\r\n        }\r\n        (window as any)['setQ'] = this.load;\r\n    }\r\n\r\n    load = (q: QualityPreset) => {\r\n        loadResources(this.props.app, q)\r\n            .then(resources => {\r\n                cachedResources = resources;\r\n                this.setState({ resources });\r\n                this.props.onLoaded(resources)\r\n            });\r\n    };\r\n\r\n    render = () => {\r\n        return this.props.children(this.state.resources);\r\n    }\r\n}\r\n\r\nexport default withPixiApp(LoadResources);\r\n","import i18n from 'i18next';\r\n\r\nfunction str<T extends string>(template: string, keys: T[]): [string, T[]] {\r\n    return [template, keys];\r\n}\r\n\r\nvar s = str('smt', ['key1', 'key2']);\r\n\r\n\r\nexport const main = {\r\n    turnNo: str('Хід {{turn}}', ['turn']),\r\n    cannotEndSiegeOnSameTurn: ['Неможоливо закінчити облогу на тому ж ході, на якому вона почата!'],\r\n    cannotEndSiege: ['Неможливо закінчити Облогу'],\r\n    cannotStartSiegeCauseMovements: ['Неможоливо почати облогу на ході з переміщенням'],\r\n    cannotStartSiegeCauseContamination: ['Неможоливо почати облогу на ході з зараженням'],\r\n    cannotStartSiegeCauseSiege: ['Неможоливо почати нову облогу на ході з закінченням попередньої'],\r\n    siegeEndSuccessfully: ['Облогу закінчено'],\r\n    siegeCancelledCauseMovement: ['Облогу скасовано через переміщення'],\r\n    startOfTurn: ['Початок ходу'],\r\n    movementToLocation: ['Рух до {{locationNo, if-not:0}}«{{location}}»', ['locationNo', 'location']],\r\n    startingLocation: ['Початок в {{locationNo, if-not:0}}«{{location}}»', ['locationNo', 'location']],\r\n    selectCharacter: ['Оберіть Наближених, які були уражені'],\r\n    siegeStarted: ['Початок облоги'],\r\n    siegeStartedKilled: ['Початок облоги: {{killed}}', ['killed']],\r\n    siegeEndedKilled: ['Завершення облоги: {{killed}}', ['killed']],\r\n    multipleCharacterKilled: ['{{characters}} уражені', ['characters']],\r\n    characterWoKilled: ['{{char}} уражена', ['char']],\r\n    characterMaKilled: ['{{char}} уражений', ['char']],\r\n    cannotContaminateTwice: ['Неможливо почати зараження кілька разів за хід'],\r\n    cannotContaminateCauseSiege: ['Неможливо почати зараження на ході з облогою'],\r\n    confirmTurnEnd: ['Закінчити хід?'],\r\n    turnEnd: ['Закінчення ходу'],\r\n    phase: ['Фаза {{phase}}', ['phase']],\r\n    additionalMove: ['Додатк. крок'],\r\n    startOfGame: ['Початок гри'],\r\n    selectAreaToStartFrom: ['Оберіть початкову локацію Чуми'],\r\n    healersTurn: ['Хід лікарів'],\r\n    selectHealersEffects: ['Оберіть ефекти'],\r\n    canceledEffect: ['«{{effect}}» скасовано', ['effect']],\r\n    activatedEffect: ['«{{effect}}» активовано', ['effect']],\r\n    cancelSiegeWarning: ['Ця дія скасує Облогу'],\r\n    doubleMovement: ['Подвійне переміщення'],\r\n    finishTurn: ['Закінчити хід'],\r\n    contaminate: ['Зараження'],\r\n    contaminateOfLocation: ['Зараження {{locationNo, if-not:0}}«{{location}}»', ['locationNo', 'location']],\r\n    startSiege: ['Почати Облогу'],\r\n    finishSiege: ['Закінчити Облогу'],\r\n    cancelAction: ['Відмінити дію'],\r\n    cancelSpecificAction: ['Відмінити «{{action}}»', ['action']],\r\n    close: ['Закрити'],\r\n    apply: ['Застосувати'],\r\n    disable: ['Вимкнути'],\r\n    missions: ['Місії'],\r\n    stamms: ['Штами'],\r\n    effectm12: ['Верхом на крысах'],\r\n    effectsPlusMovement: ['Штамм Перемещение'],\r\n    selectLocation: ['Оберіть локацію'],\r\n    restoringGameState: ['Відновлення стану'],\r\n    startNew: ['Почати нову гру'],\r\n    restoreLastGame: ['Відновити останню гру'],\r\n    saveGameReplay: ['Зберегти запис'],\r\n    returnToGame: ['Повернутись до гри'],\r\n    loading: ['Завантаження...']\r\n} as const;\r\n\r\nlet trans = {} as any;\r\nfor (let key of Object.keys(main)) {\r\n    trans[key] = (main as any)[key][0];\r\n}\r\n\r\ni18n.init({\r\n    lng: 'ua',\r\n    interpolation: {\r\n        format: (value, format, lng) => {\r\n            if (format && format.startsWith('if-not:')) {\r\n                const values = JSON.parse(format.substring(7)) as any[];\r\n                if (value instanceof Array) {\r\n                    if (values.some(v => v.toString() === value.toString())) {\r\n                        return '';\r\n                    }\r\n                    return value + ' ';\r\n                } else if (value.toString() === values.toString()) {\r\n                    return '';\r\n                } else {\r\n                    return value + ' ';\r\n                }\r\n            }\r\n            return value;\r\n        }\r\n    },\r\n    resources: {\r\n        ua: {\r\n            translation: trans\r\n        }\r\n    }\r\n});\r\n\r\nexport type MainStrings = typeof main;\r\nexport type StringKeys = keyof typeof main;\r\n\r\ntype ArglessKeys = {\r\n    [K in StringKeys]: MainStrings[K] extends readonly [string] ? K : never\r\n} extends { [_ in keyof MainStrings]: infer U } ? U : never;\r\n\r\ntype ArgumentedKeys = Exclude<StringKeys, ArglessKeys>;\r\n\r\nexport interface FormatWithArgs<K extends ArgumentedKeys> {\r\n    ( args: { [key in MainStrings[K][1][number]]: any}): string;\r\n}\r\n\r\nexport interface Format<K extends ArglessKeys> {\r\n    (): string;\r\n}\r\n\r\nexport type Strings = {\r\n    [key in StringKeys]: key extends ArglessKeys\r\n        ? Format<key>\r\n        : key extends ArgumentedKeys\r\n            ? FormatWithArgs<key>\r\n            : (...args: any[]) => string;\r\n}\r\n\r\nconst format18n = (key: string) => (args: any) => {\r\n    return i18n.t(key, args);\r\n};\r\n\r\nfunction getStrings(): Strings {\r\n    let obj: any = {};\r\n    for (const key of Object.keys(main)) {\r\n        obj[key] = format18n(key);\r\n    }\r\n    return obj;\r\n}\r\n\r\nexport const strings = getStrings();\r\n","import React from 'react';\r\nimport { strings } from '../locale/strings';\r\n\r\nexport const ApplicationLoading = () => <div\r\n    style={ { width: '100vw', height: '100vh', color: 'white', backgroundColor: 'black', fontSize: '75px', paddingTop: '200px' } }>\r\n    <div style={ { display: 'flex', justifyContent: 'center', marginBottom: '2vh' } }>\r\n        <img src={ 'icons/menu_button.png' } id={ 'loading' }/>\r\n    </div>\r\n    <div>{ strings.loading() }</div>\r\n</div>;\r\n","import * as dat from 'dat.gui';\r\n\r\nexport const isDebug = localStorage.getItem('debug');\r\n\r\nconst gui: dat.GUI = isDebug ? new dat.GUI() : {} as any;\r\nexport const inDebug = <T>(action: (gui: dat.GUI) => T): T => {\r\n    if (isDebug) return action(gui);\r\n    return {} as any;\r\n};\r\n\r\ninDebug(() => {\r\n    gui.domElement.parentElement!.style.zIndex = '9999999999';\r\n    if (localStorage.getItem('debug_show') == 'false') {\r\n        gui.hide();\r\n    }\r\n    setInterval(() => {\r\n        localStorage.setItem('debug_show', (gui.domElement.style.display !== 'none').toString());\r\n    }, 250);\r\n});\r\n","import React from 'react';\r\nimport { QualityPreset } from '../../model';\r\nimport LoadResources, { Resources, ResourcesContext } from '../mapView/loadResources';\r\nimport { ApplicationLoading } from '../mapView/applicationLoading';\r\nimport { Stage } from '@inlet/react-pixi';\r\nimport * as PIXI from 'pixi.js';\r\nimport { WithSize } from './autoSizeContext';\r\nimport { PageSizes } from '../theme/createTheme';\r\nimport { inDebug } from '../../debug';\r\n\r\ninterface Props extends WithSize {\r\n    qualityPreset: QualityPreset;\r\n    pageSizes: PageSizes;\r\n}\r\n\r\ninterface State {\r\n    resources: Resources | null;\r\n}\r\n\r\ninDebug(() => window['PIXI'] = PIXI);\r\n\r\nclass PixieStage extends React.Component<Props, State> {\r\n\r\n    state: State = {\r\n        resources: null\r\n    };\r\n\r\n    render = () => {\r\n        const { qualityPreset, children, size, pageSizes } = this.props;\r\n\r\n        return <div style={ {\r\n            height: size.height,\r\n            width: size.width,\r\n            maxHeight: size.height,\r\n            top: pageSizes.top,\r\n            position: 'absolute',\r\n            backgroundColor: 'black'\r\n        } }>\r\n            { this.renderLoader() }\r\n            <Stage width={ size.width } height={ size.height } options={{ transparent: true }} onUnmount={() => console.log('stage is killed')}>\r\n                <LoadResources onLoaded={ this.onResourcesLoaded } qualityPreset={ qualityPreset }>\r\n                    { (resources) => {\r\n                        if (!resources) return null;\r\n\r\n                        return (<ResourcesContext.Provider value={ resources }>\r\n                            { children }\r\n                        </ResourcesContext.Provider>)\r\n                    } }\r\n                </LoadResources>\r\n            </Stage>\r\n        </div>\r\n    };\r\n\r\n    private renderLoader = () => {\r\n        const { resources } = this.state;\r\n\r\n        if (!resources)\r\n            return <ApplicationLoading />;\r\n\r\n        return null;\r\n    };\r\n\r\n    onResourcesLoaded = (resources: Resources) => this.setState({ resources });\r\n}\r\n\r\nexport default PixieStage;\r\n","import { PixiComponent } from '@inlet/react-pixi';\r\nimport * as PIXI from 'pixi.js';\r\n\r\nexport const RawDisplayObj = PixiComponent<{ obj: PIXI.DisplayObject, assign?: any }, PIXI.DisplayObject>('RawObj', {\r\n    create: (props) => {\r\n        if (props.assign) {\r\n            Object.assign(props.obj, props.assign);\r\n        }\r\n        return props.obj\r\n    }\r\n});\r\n","\r\nexport interface RafTimestamp {\r\n    timestamp: number, elapsedTotal: number, elapsed: number\r\n}\r\n\r\nexport class RafTicker {\r\n\r\n    private startTime: number = 0;\r\n    private lastTick: number = 0;\r\n    private elapsedTotal: number = 0;\r\n    private rafHandle: number = 0;\r\n    private isStopped: boolean = true;\r\n\r\n    constructor(private onTick: (state: RafTimestamp) => boolean) {\r\n    }\r\n\r\n    start() {\r\n        this.isStopped = false;\r\n        this.startTime = Date.now();\r\n        this.elapsedTotal = 0;\r\n        this.lastTick = 0;\r\n        requestAnimationFrame(this.tick)\r\n    }\r\n\r\n    stop() {\r\n        this.isStopped = true;\r\n        if (this.rafHandle) {\r\n            cancelAnimationFrame(this.rafHandle);\r\n        }\r\n    }\r\n\r\n    private tick = (timestamp: number) => {\r\n        if (this.isStopped) return;\r\n        if (this.lastTick === 0) {\r\n            this.lastTick = timestamp;\r\n        }\r\n        const elapsed = timestamp - this.lastTick;\r\n        this.elapsedTotal += elapsed;\r\n        this.lastTick = timestamp;\r\n        if (this.onTick({ elapsed, elapsedTotal: this.elapsedTotal, timestamp })) {\r\n            requestAnimationFrame(this.tick);\r\n        }\r\n    }\r\n}\r\n","import * as particles from 'pixi-particles';\r\nimport * as PIXI from 'pixi.js';\r\nimport { AreaFill, BBox } from '../../../model';\r\nimport React from 'react';\r\nimport { RawDisplayObj } from '../pixiUtils/rawDisplayObj';\r\nimport { withPixiApp } from '@inlet/react-pixi';\r\nimport { RafTicker, RafTimestamp } from '../pixiUtils/rafTicker';\r\nimport { AREA, COLORS } from '../constants';\r\nimport { Resources } from '../loadResources';\r\nimport { inDebug } from '../../../debug';\r\nimport { AreaKey, areaKeys } from '../../../data/areas';\r\n\r\ninterface Props {\r\n    areaKey: AreaKey;\r\n    fill: AreaFill;\r\n    bbox: BBox;\r\n    sizeMult: number;\r\n    app: PIXI.Application;\r\n    resources: Resources;\r\n}\r\n\r\nlet debug_obj = Object.fromEntries(areaKeys.map(key => ([key, 'disabled'])))\r\n\r\ninDebug(gui => {\r\n    const folder = gui.addFolder('Area fills');\r\n    Object.keys(debug_obj).forEach(k => {\r\n        folder.add(debug_obj, k).listen();\r\n    })\r\n});\r\n\r\nclass AreaSpriteFill extends React.Component<Props, any> {\r\n    private container: PIXI.Container;\r\n    private rect: PIXI.Sprite;\r\n    private emitter: particles.Emitter;\r\n\r\n    private ticker: RafTicker;\r\n\r\n    private fadingMod: number = 1;\r\n    private maxAlpha: number = 1;\r\n    private minAlpha: number = 0;\r\n    private skipDelay: boolean = false;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        const { bbox, sizeMult } = props;\r\n\r\n        // create area container\r\n        this.container = new PIXI.Container();\r\n        this.container.x = 0;\r\n        this.container.y = 0;\r\n\r\n        // create filling rect\r\n        this.rect = new PIXI.Sprite(PIXI.Texture.WHITE);\r\n        this.rect.tint = COLORS.activeTint;\r\n        Object.assign(this.rect, { width: props.bbox.width, height: props.bbox.height });\r\n        this.rect.alpha = 0;\r\n        this.container.addChild(this.rect);\r\n\r\n        // create emitter\r\n        this.emitter = this.createEmitter(bbox, sizeMult);\r\n        this.ticker = new RafTicker(this.rafTick);\r\n\r\n        this.transitToFill(props.fill, props.fill);\r\n    }\r\n\r\n    private createEmitter(bbox: BBox, sizeMult: number) {\r\n        return new particles.Emitter(this.container, [this.props.resources.redHand], {\r\n            scale: {\r\n                start: 2,\r\n                end: 2\r\n            },\r\n            speed: {\r\n                start: 1,\r\n                end: 1,\r\n                minimumSpeedMultiplier: 1\r\n            },\r\n            startRotation: {\r\n                min: 0,\r\n                max: 360\r\n            },\r\n            noRotation: false,\r\n            lifetime: this.getLifetime(),\r\n            spawnType: 'rect',\r\n            spawnRect: {\r\n                x: 0,\r\n                y: 0,\r\n                w: bbox.width,\r\n                h: bbox.height\r\n            },\r\n            pos: {\r\n                x: 0,\r\n                y: 0\r\n            },\r\n            frequency: (AREA.fillTime / (AREA.particlesCount * sizeMult)) * 0.001,\r\n            maxParticles: AREA.particlesCount * sizeMult\r\n        });\r\n    }\r\n\r\n    getLifetime = (scale: number = 1) => {\r\n        const baseLifetime = (AREA.fillTime + AREA.fillTime * AREA.fadingStart) * 0.001;\r\n        const ttlMod = AREA.particlesTtlSpread * baseLifetime;\r\n\r\n        return {\r\n            min: baseLifetime * scale,\r\n            max: (baseLifetime + ttlMod) * scale\r\n        };\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<Props>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        if (nextProps === this.props) return false;\r\n\r\n        if (nextProps.fill !== this.props.fill) {\r\n            this.transitToFill(nextProps.fill, this.props.fill);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    transitToFill = (fill: AreaFill, prevFill: AreaFill) => {\r\n        if (fill !== prevFill && prevFill === 'active') {\r\n            let lt = this.getLifetime(0.3);\r\n            this.emitter.minLifetime = lt.min;\r\n            this.emitter.maxLifetime = lt.max;\r\n\r\n            this.emitter.emit = true;\r\n            this.emitter.update(AREA.fillTime * 0.001);\r\n            this.emitter.emit = false;\r\n        } else {\r\n            let lt = this.getLifetime();\r\n            this.emitter.minLifetime = lt.min;\r\n            this.emitter.maxLifetime = lt.max;\r\n        }\r\n\r\n        switch (fill) {\r\n            case 'disabled':\r\n            case 'available':\r\n                this.goToDisabled();\r\n                break;\r\n\r\n            case 'passed':\r\n            case 'passed-available':\r\n                this.goToPassed();\r\n                break;\r\n\r\n            case 'active':\r\n                this.goToActive();\r\n                break;\r\n        }\r\n        inDebug(() => debug_obj[this.props.areaKey] = `${prevFill} > ${fill}`);\r\n        // console.log(debug_obj, this.props.key)\r\n    };\r\n\r\n    goToPassed = () => {\r\n        this.rect.tint = COLORS.passedTint;\r\n        this.skipDelay = true;\r\n        if (this.rect.alpha > 0.65) {\r\n            this.minAlpha = 0.65;\r\n            this.maxAlpha = 1;\r\n            this.fadingMod = -1;\r\n        } else {\r\n            this.maxAlpha = 0.5;\r\n            this.minAlpha = 0;\r\n            this.fadingMod = 1;\r\n        }\r\n        this.ticker.start();\r\n    };\r\n\r\n    goToDisabled = () => {\r\n        this.emitter.emit = false;\r\n        this.skipDelay = true;\r\n        this.fadingMod = -1;\r\n        this.minAlpha = 0;\r\n        this.ticker.start();\r\n    };\r\n\r\n    goToActive = () => {\r\n        this.rect.tint = COLORS.activeTint;\r\n        this.ticker.start();\r\n        this.emitter.emit = true;\r\n        this.skipDelay = false;\r\n        this.fadingMod = 1;\r\n        this.maxAlpha = 1;\r\n    };\r\n\r\n    rafTick = (ts: RafTimestamp) => {\r\n        this.updateRect(ts);\r\n\r\n        this.emitter.update(ts.elapsed * 0.001);\r\n        if (ts.elapsedTotal > AREA.fillTime) {\r\n            this.emitter.emit = false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    updateRect = (ts: RafTimestamp) => {\r\n        if (this.skipDelay || ts.elapsedTotal >= AREA.fillTime * AREA.fadingStart) {\r\n            this.rect.alpha += AREA.fadingDelta * this.fadingMod * ts.elapsed;\r\n            if (this.rect.alpha > this.maxAlpha) {\r\n                this.rect.alpha = this.maxAlpha;\r\n            }\r\n            if (this.rect.alpha < this.minAlpha) {\r\n                this.rect.alpha = this.minAlpha;\r\n            }\r\n            if (this.rect.alpha === this.maxAlpha && this.fadingMod >= 0 && this.emitter.particleCount === 0) {\r\n                this.ticker.stop();\r\n            }\r\n        }\r\n    };\r\n\r\n    render = () => {\r\n        return <RawDisplayObj obj={ this.container }/>\r\n    };\r\n\r\n    componentWillUnmount(): void {\r\n        this.ticker.stop();\r\n    }\r\n}\r\n\r\nexport default withPixiApp(AreaSpriteFill);\r\n","import React from 'react';\r\nimport { AreaData } from '../loadResources';\r\nimport { Container, Sprite } from '@inlet/react-pixi';\r\nimport * as PIXI from 'pixi.js';\r\nimport { AREA_OVERLAY } from '../constants';\r\n\r\ninterface Props {\r\n    area: AreaData;\r\n    app: PIXI.Application;\r\n    visible: boolean;\r\n}\r\n\r\nexport class AreaOverlay extends React.Component<Props> {\r\n\r\n    private container: PIXI.Container | null = null;\r\n    private targetAlpha: number = 0;\r\n\r\n    constructor(props: Readonly<Props>) {\r\n        super(props);\r\n        this.props.app.ticker.add(this.tick);\r\n        this.targetAlpha = props.visible ? 1 : 0;\r\n    }\r\n\r\n    tick = () => {\r\n        const container = this.container;\r\n        if (\r\n            !container || container.alpha === this.targetAlpha\r\n        ) return;\r\n\r\n        const elapsedMs = this.props.app.ticker.elapsedMS;\r\n        if (container.alpha < this.targetAlpha) {\r\n            container.alpha += AREA_OVERLAY.fadingDelta * elapsedMs;\r\n            if (container.alpha > 1)\r\n                container.alpha = 1;\r\n        } else if (container.alpha > this.targetAlpha) {\r\n            container.alpha -= AREA_OVERLAY.fadingDelta * elapsedMs;\r\n            if (container.alpha < 0) {\r\n                container.alpha = 0;\r\n                container.visible = false;\r\n            }\r\n        }\r\n    };\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<Props>, nextState: Readonly<{}>, nextContext: any): boolean {\r\n        this.targetAlpha = nextProps.visible ? 1 : 0;\r\n        if (nextProps.visible && this.container) {\r\n            this.container.visible = true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    render = () => {\r\n        const { area } = this.props;\r\n        const containerName = `area_overlay_${ area.key }`;\r\n        return <Container name={ containerName } ref={c => this.container = c as any }>\r\n            {\r\n                area.overlay.tiles.map(({ tex, x, y }, i) => {\r\n                        const name = `${ containerName }_${ i }`;\r\n                        return <Sprite scale={area.overlay.scale} texture={ tex } x={ x } y={ y } key={ name } name={ name }/>;\r\n                    }\r\n                )\r\n            }\r\n        </Container>\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { AreaData, Resources } from '../loadResources';\r\nimport { Sprite } from '@inlet/react-pixi';\r\nimport * as PIXI from 'pixi.js';\r\nimport { TOKENS } from '../constants';\r\n\r\ninterface Props {\r\n    area: AreaData;\r\n    resources: Resources;\r\n    app: PIXI.Application;\r\n}\r\n\r\nexport class SiegeToken extends React.Component<Props> {\r\n\r\n    sprite: PIXI.Sprite = null as any;\r\n    private animState: number = 0;\r\n\r\n    render = () => {\r\n        const { resources, area } = this.props;\r\n        return <Sprite\r\n            ref={ (s: any) => this.sprite = s }\r\n            texture={ resources.siegeToken }\r\n            alpha={ 0 }\r\n            zIndex={ 10 }\r\n            anchor={ 0.5 }\r\n            x={ area.tokenPosition.x }\r\n            y={ area.tokenPosition.y }\r\n        />\r\n    };\r\n\r\n    componentDidMount(): void {\r\n        this.sprite.alpha = 0;\r\n        this.sprite.scale = new PIXI.Point(TOKENS.fromScale);\r\n        this.animState = 1;\r\n        this.props.app.ticker.add(this.tick);\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        this.animState = -1;\r\n    }\r\n\r\n    tick = () => {\r\n        const elapsed = this.props.app.ticker.elapsedMS;\r\n\r\n        if (!this.sprite) {\r\n            this.props.app.ticker.remove(this.tick);\r\n            return;\r\n        }\r\n\r\n        if (this.animState === 0) {\r\n            return;\r\n        }\r\n        const deltaA = elapsed * TOKENS.deltaAlpha;\r\n        const deltaS = elapsed * TOKENS.deltaScale;\r\n\r\n        if (this.animState === 1) {\r\n            this.sprite.alpha += deltaA;\r\n            const scale = this.sprite.scale.x - deltaS;\r\n\r\n            if (scale <= TOKENS.toScale || this.sprite.alpha >= 1) {\r\n                this.sprite.alpha = 1;\r\n                this.sprite.scale.set(TOKENS.toScale);\r\n                this.animState = 0;\r\n            } else {\r\n                this.sprite.scale.set(scale);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { AreaData, Resources } from '../loadResources';\r\nimport { AreaKey } from '../../../data/areas';\r\nimport { Container, withPixiApp } from '@inlet/react-pixi';\r\nimport * as PIXI from 'pixi.js';\r\nimport { RawDisplayObj } from '../pixiUtils/rawDisplayObj';\r\nimport AreaSpriteFill from './areaSpriteFill';\r\nimport { AreaFill, AreaTokenType } from '../../../model';\r\nimport { AreaOverlay } from './areaOverlay';\r\nimport { SiegeToken } from '../tokens/siegeToken';\r\n\r\ninterface Props {\r\n    resources: Resources;\r\n    area: AreaData;\r\n    fill: AreaFill;\r\n    tokens: AreaTokenType[];\r\n    onClick?: (key: AreaKey) => void;\r\n    app: PIXI.Application;\r\n    pixiRef?: (obj: PIXI.DisplayObject) => void;\r\n}\r\n\r\nclass AreaView extends React.Component<Props> {\r\n\r\n    private maskSprite: PIXI.Sprite;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.maskSprite = PIXI.Sprite.from(props.area.mask.tex);\r\n        this.maskSprite.scale = new PIXI.Point(props.area.mask.scale, props.area.mask.scale);\r\n    }\r\n\r\n    render = () => {\r\n        const { area, fill, resources } = this.props;\r\n        const { bbox, key } = area;\r\n\r\n        return <Container { ...bbox } >\r\n            <AreaOverlay area={ area } visible={ fill === 'disabled' || fill === 'passed' } app={ this.props.app }/>\r\n            <Container mask={ this.maskSprite } name={ 'area_sprite_container_' + area.key }>\r\n                <RawDisplayObj obj={ this.maskSprite } ref={this.props.pixiRef as any}/>\r\n                <AreaSpriteFill fill={ fill }\r\n                                bbox={ bbox }\r\n                                areaKey={ key }\r\n                                resources={ resources }\r\n                                sizeMult={ this.getSizeMult(area.key) }\r\n                />\r\n            </Container>\r\n            { this.renderToken() }\r\n        </Container>\r\n    };\r\n\r\n    private renderToken = () => {\r\n        const { area, resources } = this.props;\r\n        if (this.props.tokens.some(t => t == 'siege')) {\r\n            return <SiegeToken area={area} resources={resources} app={this.props.app} />\r\n        }\r\n    };\r\n\r\n    private getSizeMult(key: AreaKey) {\r\n        switch (key) {\r\n\r\n            case 'area13':\r\n                return 1.7;\r\n\r\n            case 'area01':\r\n            case 'steppe01':\r\n                return 2;\r\n\r\n            case 'steppe03':\r\n                return 3;\r\n\r\n            default:\r\n                return 1;\r\n        }\r\n    }\r\n}\r\n\r\nexport default withPixiApp(AreaView);\r\n","import React from 'react';\r\nimport { PixiComponent, useApp } from '@inlet/react-pixi';\r\nimport { BounceOptions, ClampZoomOptions, ClickEventData, Viewport } from 'pixi-viewport';\r\nimport * as PIXI from 'pixi.js';\r\nimport { SIZES } from './constants';\r\nimport { Point } from '../../model';\r\nimport { inDebug } from '../../debug';\r\n\r\nlet debug_obj = {\r\n    centerX: 0,\r\n    centerY: 0,\r\n\r\n    cornerX: 0,\r\n    cornerY: 0,\r\n\r\n    screenH: 0,\r\n    screenW: 0,\r\n\r\n    target: ''\r\n};\r\n\r\nlet debug_folder = inDebug(gui => {\r\n    const folder = gui.addFolder('viewport');\r\n    folder.open();\r\n    return folder;\r\n});\r\n\r\nfunction attachDebug(viewport: Viewport) {\r\n    inDebug(() => {\r\n        let changing = 0;\r\n\r\n        function onChange(key: string, value: any) {\r\n            switch (key) {\r\n                case 'centerX': viewport.moveCenter(value, viewport.center.y); break;\r\n                case 'centerY': viewport.moveCenter(viewport.center.x, value); break;\r\n            }\r\n        }\r\n\r\n        Object.keys(debug_obj).map(k => {\r\n                const controller = debug_folder.add(debug_obj, k);\r\n                controller.domElement.querySelector('input')!.addEventListener('focus', () => changing++);\r\n                controller.domElement.querySelector('input')!.addEventListener('focusout', () => changing--);\r\n                return controller.onChange(v => onChange(k, v));\r\n            }\r\n        );\r\n\r\n        setInterval(() => {\r\n            (window as any).changing = changing;\r\n            if (changing) return;\r\n            Object.assign(debug_obj, {\r\n                centerX: viewport.center.x,\r\n                centerY: viewport.center.y,\r\n\r\n                cornerX: viewport.corner.x,\r\n                cornerY: viewport.corner.y,\r\n\r\n                screenH: viewport.worldScreenHeight,\r\n                screenW: viewport.worldScreenWidth,\r\n            });\r\n            debug_folder.updateDisplay();\r\n        }, 100);\r\n    });\r\n}\r\n\r\nconst ViewportComponent = PixiComponent<Props & { app: PIXI.Application }, Viewport>(\"Viewport\", {\r\n    create: (props) => {\r\n        const viewport = new Viewport({\r\n            worldWidth: SIZES.worldWidth,\r\n            worldHeight: SIZES.worldHeight,\r\n            screenHeight: props.screenHeight,\r\n            screenWidth: props.screenWidth,\r\n            ticker: props.app.ticker,\r\n            interaction: props.app.renderer.plugins.interaction,\r\n        });\r\n        attachDebug(viewport);\r\n\r\n        viewport.on('clicked', props.onClick);\r\n\r\n        viewport\r\n            .drag({\r\n                factor: 1\r\n            })\r\n            .pinch()\r\n            .wheel()\r\n            .bounce({\r\n                time: 300,\r\n                sides: 'horizontal'\r\n            } as BounceOptions)\r\n            .decelerate({\r\n                friction: 0.8\r\n            });\r\n        clampZoom(viewport, props);\r\n        focus(viewport, props.focusOn);\r\n        viewport.setZoom(0.2);\r\n        inDebug(() => (window as any).viewport = viewport);\r\n\r\n        return viewport;\r\n    },\r\n    applyProps(viewport, oldProps, props): void {\r\n        viewport.screenHeight = props.screenHeight;\r\n        viewport.screenWidth = props.screenWidth;\r\n        viewport.clamp({\r\n            direction: 'y'\r\n        });\r\n        inDebug(() => Object.assign(debug_obj, {\r\n            target: `${ props.focusOn?.x } ${ props.focusOn?.y }`\r\n        }));\r\n        if (props.focusOn !== oldProps.focusOn) {\r\n            focus(viewport, props.focusOn);\r\n        }\r\n        clampZoom(viewport, props);\r\n    }\r\n});\r\n\r\nfunction focus(viewport: Viewport, focusOn?: Point) {\r\n    if (focusOn) {\r\n        let nX = focusOn.x - viewport.worldScreenWidth / 2;\r\n        let leftExtr = viewport.corner.x < 0 ? viewport.corner.x : 0;\r\n        if (nX < leftExtr) {\r\n            nX = leftExtr;\r\n        }\r\n        let d = (nX + viewport.worldScreenWidth) - viewport.worldWidth + leftExtr;\r\n        if (d > 0) {\r\n            nX -= d;\r\n        }\r\n\r\n        let nY = focusOn.y - viewport.worldScreenHeight / 2;\r\n        if (nY < 0) {\r\n            nY = 0;\r\n        }\r\n        viewport.moveCorner(nX, nY);\r\n    }\r\n}\r\n\r\nfunction clampZoom(viewport: Viewport, props: Props) {\r\n\r\n    const options: ClampZoomOptions = props.screenWidth > props.screenHeight\r\n        ? { maxHeight: SIZES.worldHeight, minHeight: SIZES.worldHeight / 5 }\r\n        : { maxHeight: SIZES.worldHeight, minHeight: SIZES.worldHeight / 5 };\r\n        // : { maxWidth: SIZES.worldWidth, minWidth: SIZES.worldWidth / 5 };\r\n\r\n    viewport\r\n        .clampZoom(options);\r\n}\r\n\r\ninterface Props {\r\n    children: any;\r\n    onClick: (data: ClickEventData) => void;\r\n    focusOn?: Point;\r\n    screenWidth: number;\r\n    screenHeight: number;\r\n}\r\n\r\nexport default (props: Props) => <ViewportComponent app={useApp()} {...props} children={props.children} />\r\n\r\n","import React from 'react';\r\nimport { Resources } from './loadResources';\r\nimport { Sprite, ParticleContainer } from '@inlet/react-pixi';\r\n\r\ninterface Props {\r\n    mapTiles: Resources['mapTiles']\r\n}\r\n\r\nexport class MapBackground extends React.Component<Props> {\r\n    render = () => {\r\n        const { mapTiles } = this.props;\r\n        return <ParticleContainer>\r\n            { mapTiles.tiles.map(({ tex, x, y }, i) =>\r\n                <Sprite name={ 'map_tile_' + i } scale={ mapTiles.scale } key={ i } texture={ tex } x={ x } y={ y }/>\r\n            ) }\r\n        </ParticleContainer>\r\n    };\r\n}\r\n","import React from 'react';\r\nimport { Container, Sprite } from '@inlet/react-pixi';\r\nimport { AreaFills, MapSnapshot, Point, QualityPreset } from '../../model';\r\nimport { Resources, WithResources, withResources } from './loadResources';\r\nimport AreaView from './area/areaView';\r\nimport { AreaKey, areaKeys } from '../../data/areas';\r\nimport ViewPort from './viewport';\r\nimport { ClickEventData } from 'pixi-viewport';\r\nimport { MapBackground } from './mapBackground';\r\nimport { WithSize } from '../stage/autoSizeContext';\r\nimport { inDebug } from '../../debug';\r\nimport * as PIXI from 'pixi.js';\r\n\r\ninterface Props extends WithSize, WithResources {\r\n    mapSnapshot?: MapSnapshot | null;\r\n    onAreaClick?: (key: AreaKey) => void\r\n}\r\n\r\nconst emptySnapshot = {\r\n    tokens: [],\r\n    fills: Object.fromEntries(areaKeys.map(key => ([key, 'disabled']))) as AreaFills\r\n} as MapSnapshot;\r\n\r\nlet debug_obj = {\r\n    ...emptySnapshot.fills,\r\n    focusArea: ''\r\n};\r\n\r\nlet debug_folder = inDebug(gui => {\r\n    const folder = gui.addFolder('MapView');\r\n    Object.keys(debug_obj).forEach(k => {\r\n        folder.add(debug_obj, k).listen();\r\n    });\r\n    return folder;\r\n});\r\n\r\nclass MapView extends React.Component<Props> {\r\n\r\n    private grayscaleFilter: PIXI.filters.ColorMatrixFilter;\r\n\r\n    private sprites: any = {};\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.grayscaleFilter = new PIXI.filters.ColorMatrixFilter();\r\n        this.grayscaleFilter.desaturate();\r\n\r\n        inDebug(() => {\r\n            let focus_obj = {\r\n                areaToFocus: 'area01',\r\n                setArea: () => {\r\n                    this.props.mapSnapshot!.focusOn = focus_obj.areaToFocus as any;\r\n                    this.forceUpdate();\r\n                }\r\n            };\r\n            debug_folder.add(focus_obj, 'areaToFocus', areaKeys).onChange(v => {\r\n                focus_obj.areaToFocus = v;\r\n                focus_obj.setArea();\r\n            });\r\n            debug_folder.add(focus_obj, 'setArea');\r\n        });\r\n    }\r\n\r\n    render = () => {\r\n        const { resources, size: { width, height } } = this.props;\r\n\r\n        inDebug(() => Object.assign(debug_obj, this.props.mapSnapshot?.fills, { focusArea: this.props.mapSnapshot?.focusOn }));\r\n\r\n        return <ViewPort onClick={ this.onClick } screenWidth={ width } screenHeight={ height } focusOn={this.getFocusOn()}>\r\n            <Container filters={this.props.mapSnapshot?.grayscale ? [this.grayscaleFilter] : []}>\r\n                { this.renderMap(resources) }\r\n                { this.renderAreas(resources) }\r\n            </Container>\r\n        </ViewPort>\r\n    };\r\n\r\n    getFocusOn = () => {\r\n        if (!this.props.mapSnapshot || !this.props.mapSnapshot.focusOn) {\r\n            return;\r\n        }\r\n        const { focusOn } = this.props.mapSnapshot;\r\n        const bbox =  this.props.resources.areas.find(a => a.key === focusOn)!.bbox;\r\n\r\n        switch (focusOn) {\r\n            case 'steppe01':\r\n                return {\r\n                    x: bbox.x,\r\n                    y: bbox.y + bbox.height\r\n                };\r\n\r\n            case 'steppe02':\r\n                return {\r\n                    x: bbox.x + bbox.width / 2,\r\n                    y: bbox.y + bbox.height\r\n                };\r\n\r\n            case 'steppe03':\r\n                return {\r\n                    x: bbox.x + bbox.width,\r\n                    y: bbox.y + bbox.height\r\n                };\r\n\r\n            default:\r\n                return {\r\n                    x: bbox.x + bbox.width / 2,\r\n                    y: bbox.y + bbox.height / 2\r\n                }\r\n        }\r\n    };\r\n\r\n    renderMap = (resources: Resources) => {\r\n        return <MapBackground mapTiles={ resources.mapTiles }/>\r\n    };\r\n\r\n    renderAreas = (resources: Resources) => {\r\n        const { fills, tokens } = this.props.mapSnapshot || emptySnapshot;\r\n        return resources.areas.map(area =>\r\n            <AreaView resources={ resources }\r\n                      area={ area }\r\n                      pixiRef={(v) => this.sprites[area.key] = v }\r\n                      key={ area.key }\r\n                      fill={ fills[area.key] }\r\n                      tokens={ tokens.filter(t => t.areaKey === area.key).map(t => t.token) }\r\n            />);\r\n    };\r\n\r\n    private onClick = (data: ClickEventData) => {\r\n        const area = this.traceArea(data.world);\r\n        if (!area) {\r\n            return;\r\n        }\r\n        this.props.onAreaClick?.(area);\r\n    };\r\n\r\n    private traceArea = (point: Point) => {\r\n        const { resources } = this.props;\r\n        if (!resources) {\r\n            return null;\r\n        }\r\n        let area = resources.areas.find(a => a.hitArea.contains(point.x, point.y));\r\n        return (area && area.key) || null;\r\n    };\r\n}\r\n\r\nexport default withResources(\r\n    MapView\r\n);\r\n","import React, { Component } from 'react';\r\nimport { withStyles, WithStyles } from '@material-ui/styles';\r\nimport { styles } from './bottomPanel.styles';\r\nimport Button from '../button/button';\r\nimport { PageSizes } from '../../theme/createTheme';\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    buttons?: () => React.ReactNode;\r\n    onMapButtons?: () => React.ReactNode;\r\n    pageSizes: PageSizes;\r\n}\r\n\r\nclass BottomPanel extends Component<Props> {\r\n    render() {\r\n        const { classes, buttons, onMapButtons } = this.props;\r\n        return <div className={ classes.wrapper } style={{\r\n            bottom: 0\r\n        }}>\r\n            <div className={ classes.padding }>\r\n                <div className={ classes.buttonsWrapper }>\r\n                    { buttons ? buttons() : null }\r\n                </div>\r\n            </div>\r\n            <div className={ classes.stylizedTransition } />\r\n            <div className={ classes.undoContainer }>\r\n                { onMapButtons ? onMapButtons() : null }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(BottomPanel);\r\n","import { createStyles } from '@material-ui/styles';\r\nimport { COLORS, SIZES } from '../../mapView/constants';\r\nimport { Theme } from '../../theme/createTheme';\r\nimport { breakScaleBkg } from '../../../utils/scaleBreakdown';\r\n\r\nexport const styles = (theme: Theme) => createStyles({\r\n    wrapper: {\r\n        color: '#' + COLORS.activeTint.toString(16),\r\n        backgroundColor: '#000000',\r\n        height: theme.pageSizes.bottom,\r\n        width: theme.pageSizes.viewport.width,\r\n        position: 'absolute'\r\n    },\r\n    padding: {\r\n        padding: SIZES.UI.panelPaddingPx\r\n    },\r\n    buttonsWrapper: {\r\n        display: 'flex',\r\n        justifyContent: 'space-around',\r\n        paddingLeft: '10vw',\r\n        paddingRight: '10vw'\r\n    },\r\n    stylizedTransition: {\r\n        position: 'absolute',\r\n        backgroundImage: 'url(ui/crows_wings.png)',\r\n        ...breakScaleBkg(theme, SIZES.UI.bottomTransitionHeightPx),\r\n        bottom: ~~theme.pageSizes.bottom - 2,\r\n        width: '100%',\r\n        pointerEvents: 'none'\r\n    },\r\n    undoContainer: {\r\n        position: 'absolute',\r\n        bottom: ~~(theme.pageSizes.bottom + theme.pageSizes.viewport.height * 0.04),\r\n        right: '10vw'\r\n    }\r\n});\r\n","import React, { Component } from 'react';\r\nimport MixedMediaModal, { ModalRenderer } from './modal/mixedMediaModal';\r\nimport Layout from './layout';\r\nimport TopPanel from './topPanel/topPanel';\r\nimport { PageSizes, Theme } from '../theme/createTheme';\r\nimport PixieStage from '../stage/PixieStage';\r\nimport MapView from '../mapView/mapView';\r\nimport BottomPanel from './bottomPanel/bottomPanel';\r\nimport { MapSnapshot } from '../../model';\r\nimport { AreaKey } from '../../data/areas';\r\nimport { ModalController } from './modal/modalController';\r\n\r\nexport interface UiProps {\r\n    msg?: string | null;\r\n\r\n    mainMsg?: string | null;\r\n    msgAccented?: boolean;\r\n\r\n    bottomButtons?: () => React.ReactNode;\r\n    onMapBottomButtons?: () => React.ReactNode;\r\n    onMapTopButtons?: () => React.ReactNode;\r\n    mapSnapshot?: MapSnapshot | null;\r\n\r\n    onAreaClick?: (key: AreaKey) => void;\r\n    modalController?: ModalController | null;\r\n\r\n    onMenuClick?: () => void;\r\n\r\n    customComponent?: (pageSizes: PageSizes) => React.ReactNode | void;\r\n}\r\n\r\nclass UiScreen extends Component<UiProps> {\r\n\r\n    render() {\r\n        return <Layout>\r\n            { (theme) => {\r\n                return <MixedMediaModal controller={this.props.modalController}\r\n                                        pageSizes={ theme.pageSizes }>\r\n                    {\r\n                        (modal) => (<>\r\n                            { this.renderTopPanel() }\r\n                            { this.renderStage(theme, modal) }\r\n                            { modal.renderModal() }\r\n                            { this.renderBottomPanel(theme.pageSizes) }\r\n                            { this.renderOnMapTopButtons(theme.pageSizes) }\r\n                            { this.props.customComponent?.(theme.pageSizes) || undefined }\r\n                        </>)\r\n                    }\r\n                </MixedMediaModal>\r\n            } }\r\n        </Layout>\r\n    }\r\n\r\n    private renderOnMapTopButtons = (pageSizes: PageSizes) => {\r\n        if (!this.props.onMapTopButtons) return null;\r\n\r\n        return <div style={{ position: 'absolute', right: '10vw', zIndex: 200, top: ~~(pageSizes.viewport.height * 0.04 + pageSizes.top) }}>\r\n            { this.props.onMapTopButtons() }\r\n        </div>\r\n    };\r\n\r\n    private renderTopPanel = () => <TopPanel\r\n        main={ this.props.mainMsg }\r\n        onMenuClick={ this.props.onMenuClick }\r\n        msgAccented={ this.props.msgAccented }\r\n        secondary={ this.props.msg }/>;\r\n\r\n    private renderStage = ({ pageSizes }: Theme, modalRenderer: ModalRenderer) => {\r\n        const middleSize = {\r\n            width: pageSizes.viewport.width,\r\n            height: pageSizes.middle\r\n        };\r\n\r\n        return <PixieStage key={'pixiStage'} size={ middleSize } pageSizes={ pageSizes } qualityPreset={ 'med' }>\r\n            <MapView size={ middleSize }\r\n                     mapSnapshot={ this.props.mapSnapshot }\r\n                     onAreaClick={ this.props.onAreaClick }/>\r\n            { modalRenderer.renderPixiBackdrop() }\r\n        </PixieStage>\r\n    };\r\n\r\n    private renderBottomPanel = (pageSizes: PageSizes) => <BottomPanel pageSizes={ pageSizes }\r\n                                                                       buttons={ this.props.bottomButtons }\r\n                                                                       onMapButtons={ this.props.onMapBottomButtons }\r\n    />;\r\n}\r\n\r\nexport default UiScreen;\r\n","import { UiProps } from '../hud/uiScreen';\r\n\r\nexport interface Transition {\r\n    renderProps(): UiProps;\r\n    promise: Promise<Transition>;\r\n}\r\n\r\nexport class SimpleTransition implements Transition {\r\n\r\n    promise: Promise<Transition>;\r\n\r\n    renderProps(): UiProps {\r\n        return this.props;\r\n    }\r\n\r\n    constructor(private props: UiProps, promise: Promise<any>) {\r\n        this.promise = promise.then(() => this);\r\n    }\r\n}\r\n\r\nexport interface RouteProps {\r\n    pushState: (state: AppState, transition?: Transition) => void;\r\n    popState: (transition?: Transition) => void;\r\n    clearAll: (transition?: Transition) => void;\r\n    update: () => void;\r\n\r\n    pushMessage: (msg: string, timeout?: number) => void;\r\n    removeMsg: () => void;\r\n}\r\n\r\nexport interface AppStateMessage {\r\n    data?: any;\r\n    type: string;\r\n    meta?: any;\r\n}\r\n\r\nexport interface AppState {\r\n    renderProps(): UiProps;\r\n    handleMessage?(msg: AppStateMessage): void;\r\n}\r\n\r\nexport abstract class BaseAppState<InternalState extends { [key: string]: any }> implements AppState {\r\n\r\n    protected constructor(\r\n        protected routeProps: RouteProps,\r\n        protected state: InternalState\r\n    ) {\r\n    }\r\n\r\n    abstract renderProps(): UiProps;\r\n\r\n    protected update = () => this.routeProps.update();\r\n\r\n    protected setState(state: Partial<InternalState>) {\r\n        let wasUpdated = false;\r\n        for (let key of Object.keys(state)) {\r\n            const value = state[key]!;\r\n            if (this.state[key] !== value) {\r\n                (this.state[key] as any) = value;\r\n                wasUpdated = true;\r\n            }\r\n        }\r\n        if (wasUpdated) {\r\n            this.routeProps.update();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","import * as idb from 'idb';\r\nimport { ActionSnapshot } from './gameEngine';\r\n\r\ninterface PathologicDb extends idb.DBSchema {\r\n    actions: {\r\n        key: number;\r\n        value: ActionSnapshot;\r\n    },\r\n    lastGames: {\r\n        key: number,\r\n        value: string\r\n    }\r\n}\r\n\r\nexport class PersistenceService {\r\n\r\n    dbPromise: Promise<idb.IDBPDatabase<PathologicDb>>;\r\n\r\n    constructor() {\r\n        this.dbPromise = this.open();\r\n    }\r\n\r\n    open() {\r\n        return idb.openDB<PathologicDb>('pathologic-companion-db', 1, {\r\n            upgrade(db) {\r\n                db.createObjectStore('actions');\r\n            }\r\n        })\r\n    }\r\n\r\n    writeAll = (actions: ActionSnapshot[]) => {\r\n        this.dbPromise.then(async db => {\r\n            const tx = db.transaction('actions', 'readwrite');\r\n            const store = tx.objectStore('actions');\r\n            await store.clear();\r\n            for (let i = 0; i < actions.length; i++){\r\n                let action = actions[i];\r\n                await store.put(action, i)\r\n            }\r\n        });\r\n    };\r\n\r\n    getAll = () => {\r\n        return this.dbPromise.then(async db => {\r\n            const tx = db.transaction('actions', 'readonly');\r\n            const store = tx.objectStore('actions');\r\n            const count = await store.count();\r\n            if (count === 0) {\r\n                return null;\r\n            }\r\n            const value = await store.getAll();\r\n            return value || null;\r\n        });\r\n    }\r\n}\r\n\r\nexport const trackingService = new PersistenceService();\r\n","export const timings = new class {\r\n    cardRealign = 0.6;\r\n    destruction = 1;\r\n    birdsFlyOff = 1.2;\r\n    destructionTotal = this.cardRealign + this.destruction;\r\n\r\n    mod = (val: keyof typeof timings, mod: '+' | '-' = '-') => {\r\n        return `${mod}=${this[val]}`;\r\n    }\r\n}();\r\n","import React from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/styles';\r\nimport classNames from 'classnames';\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    isActive: boolean;\r\n    children: React.ReactNode;\r\n    isHealer: boolean;\r\n    onClick: () => void;\r\n    num?: number;\r\n}\r\n\r\nconst SliderIndicator = (props: Props) => {\r\n    return <div onClick={props.onClick} className={ classNames(props.classes.sliderIndicator, { active: props.isActive }) }>\r\n        { props.children }\r\n        { props.num\r\n            ? <span className={ classNames(props.classes.label, { healer: props.isHealer }) }>{ props.num }</span>\r\n            : null }\r\n    </div>\r\n};\r\n\r\n\r\nconst styles = createStyles({\r\n    sliderIndicator: {\r\n        position: 'relative',\r\n        height: '3.5vh',\r\n        width: '3.5vh',\r\n        maxHeight: '3.5vh',\r\n        maxWidth: '3.5vh',\r\n        transition: '0.3s linear all',\r\n        '&.active': {\r\n            transform: 'scale(1.5)',\r\n            'filter': 'brightness(300%)'\r\n        }\r\n    },\r\n    label: {\r\n        position: 'absolute',\r\n        top: '50%',\r\n        left: '50%',\r\n        transform: 'translate(-50%, -50%)',\r\n        pointerEvents: 'none',\r\n        color: 'white',\r\n        fontWeight: 900,\r\n        fontSize: '2vh',\r\n        '&.healer': {\r\n            color: 'black',\r\n            background: '#ffffff88'\r\n        }\r\n    },\r\n});\r\n\r\nexport default withStyles(styles)(SliderIndicator);\r\n","import React from 'react';\r\nimport { createStyles, withStyles, WithStyles } from '@material-ui/styles';\r\n\r\nexport interface Props extends WithStyles<typeof styles> {\r\n    text?: string | null;\r\n}\r\n\r\nconst ModalTitleRow = (props: Props) => {\r\n    const { classes, text } = props;\r\n    return <div className={ classes.titleRow }>\r\n        { text ? text : '' }\r\n    </div>\r\n};\r\n\r\nconst styles = createStyles({\r\n    titleRow: {\r\n        paddingLeft: '1vw',\r\n        paddingRight: '1vw',\r\n        minHeight: '5vh',\r\n        width: '100%',\r\n        color: '#ffffff',\r\n        fontSize: '3.8vh',\r\n        textAlign: 'center',\r\n        overflow: 'hidden',\r\n        whiteSpace: 'nowrap'\r\n    },\r\n});\r\n\r\nexport default withStyles(styles)(ModalTitleRow);\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgHand = function SvgHand(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    width: 340,\n    height: 340,\n    id: \"svg2\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, React.createElement(\"path\", {\n    d: \"m 206.99469,338.81531 c 0,-0.55 -1.38142,-1 -3.06982,-1 -1.73405,0 -4.88875,-1.2427 -7.25,-2.85593 -2.2991,-1.57076 -5.86768,-3.16616 -7.93018,-3.54532 -2.0625,-0.37916 -3.75,-1.01283 -3.75,-1.40816 0,-1.21628 -8.23559,-4.36224 -10.12568,-3.86797 -0.97975,0.25621 -2.58978,-0.14726 -3.57784,-0.89659 -2.61702,-1.98471 -3.29648,-1.74129 -3.29648,1.18096 0,2.1246 -0.32382,2.45718 -1.75,1.79739 -0.9625,-0.44528 -5.36966,-0.83092 -9.79368,-0.85699 -5.89492,-0.0347 -8.75264,-0.51186 -10.6976,-1.78611 -3.39226,-2.22244 -5.54449,-1.37184 -6.56686,2.59535 -0.55895,2.16894 -1.50095,3.24396 -3.03872,3.46787 -1.98345,0.2888 -2.15254,0.0138 -1.53692,-2.5 0.38045,-1.55347 1.18274,-3.14423 1.78288,-3.53501 1.55228,-1.01078 -2.12263,-3.57324 -6.30918,-4.39929 -2.56653,-0.5064 -3.70696,-0.26683 -4.61024,0.96848 -1.619,2.21411 -2.53058,2.0767 -5.69625,-0.85868 -1.48288,-1.375 -3.16578,-2.5 -3.73979,-2.5 -0.574,0 -1.04364,-0.45 -1.04364,-1 0,-0.55 -0.83115,-1 -1.84699,-1 -1.01584,0 -2.8847,-0.9 -4.15301,-2 -1.84101,-1.5967 -1.97269,-2 -0.65301,-2 1.95797,0 2.15768,-1.3576 0.40301,-2.73967 -2.00815,-1.5817 -6.75,-2.43901 -6.75,-1.22037 0,0.59294 0.45,0.79996 1,0.46004 0.55,-0.33992 1,0.0835 1,0.94099 0,0.85745 -0.2906,1.55901 -0.64578,1.55901 -0.35519,0 -5.08019,-4.478 -10.500004,-9.95114 -9.531526,-9.62527 -9.854216,-10.09815 -9.854216,-14.44098 0,-2.46942 0.45,-4.76796 1,-5.10788 1.842018,-1.13843 1.025739,-4.00644 -1.711294,-6.01265 -6.787366,-4.97506 -8.281932,-7.00645 -9.964315,-13.5433 -2.293432,-8.91106 -1.76182,-9.90659 5.394224,-10.10158 6.824922,-0.18597 7.146851,-0.16392 9.912138,0.67896 1.389283,0.42346 2.607232,0.0757 3.5,-0.99942 0.753086,-0.90689 2.831747,-3.23398 4.619247,-5.1713 1.7875,-1.93732 3.25,-4.15878 3.25,-4.93656 0,-0.77778 0.36368,-1.41415 0.80817,-1.41415 0.4445,0 2.132,-1.82983 3.75,-4.0663 1.61801,-2.23646 3.40888,-4.59896 3.97971,-5.25 0.57084,-0.65103 1.8743,-3.4337 2.89657,-6.1837 1.02227,-2.75 2.48192,-5.675 3.24365,-6.5 5.70365,-6.17735 6.37797,-7.49279 5.76282,-11.24186 -0.55199,-3.36417 -0.3529,-3.84111 1.97256,-4.72524 3.5577,-1.35264 3.25123,-2.5882 -1.36475,-5.50214 -3.0321,-1.91408 -4.11023,-3.34167 -4.63461,-6.13687 -0.92464,-4.92872 0.21557,-17.54699 1.66661,-18.44378 0.64332,-0.3976 1.21822,-2.57403 1.27754,-4.83651 0.0593,-2.26248 0.45299,-4.1136 0.8748,-4.1136 0.42181,0 0.76693,-0.65917 0.76693,-1.46482 0,-1.74638 2.25557,-3.01696 6.93438,-3.9062 1.88891,-0.35901 4.2148,-1.359 5.16864,-2.22222 1.58715,-1.43634 1.92774,-1.376 4.01514,0.7114 l 2.28087,2.28087 0.81261,-3.13598 c 0.44694,-1.72478 1.59466,-3.372 2.55049,-3.66048 0.95583,-0.28848 6.1336,-0.36016 11.50617,-0.15929 7.76525,0.29033 11.6613,-0.10843 19,-1.94465 l 9.2317,-2.30986 3.69136,2.90561 c 2.03025,1.59809 3.97737,2.90562 4.32692,2.90562 0.34956,0 1.94949,1.31392 3.5554,2.91983 1.60591,1.60591 4.26861,3.21609 5.91712,3.57815 1.64851,0.36207 3.39426,1.36768 3.87945,2.23466 0.551,0.98458 1.53238,1.32683 2.61418,0.91171 1.36425,-0.52351 1.60287,-1.40565 1.12379,-4.15448 -1.96846,-11.29466 -1.99907,-10.48987 0.39901,-10.48987 1.73333,0 2.11033,-0.44245 1.70328,-1.999 -0.28751,-1.09946 -0.10766,-2.25555 0.39968,-2.5691 1.35261,-0.83596 -0.084,-2.65594 -1.62858,-2.06322 -0.72385,0.27778 -1.56421,-0.14155 -1.86747,-0.93182 -0.30325,-0.79027 -1.35299,-1.44243 -2.33276,-1.44924 -2.25138,-0.0156 -5.9229,-5.61859 -7.46847,-11.39733 -1.36448,-5.10161 0.16078,-16.0943 2.78984,-20.10677 2.68558,-4.0987 3.73606,-22.538048 1.36739,-24.001968 -1.0102,-0.624342 1.80071,-12.872292 3.05443,-13.308983 1.68284,-0.586165 3.15405,-7.970283 2.01285,-10.102645 -0.57058,-1.06614 -1.03742,-3.291462 -1.03742,-4.945161 0,-1.653698 -0.45,-3.284839 -1,-3.624758 -1.81416,-1.121213 -1.04292,-6.170558 1.69909,-11.124047 1.48451,-2.681774 3.04793,-5.022094 3.47428,-5.200711 0.42635,-0.178616 2.18434,-1.641116 3.90666,-3.25 1.72231,-1.608883 4.15653,-2.925242 5.40936,-2.925242 2.71315,0 9.51061,7.089739 9.51061,9.919547 0,1.052583 0.49508,2.078814 1.10019,2.280515 1.56064,0.520213 1.54774,11.108698 -0.0227,18.637282 -0.94945,4.551627 -1.02631,6.94673 -0.27275,8.5 2.05212,4.229931 2.09506,11.94645 0.10809,19.425443 -1.34487,5.062119 -2.04462,11.656388 -2.30937,21.762828 -0.20892,7.97503 -0.83369,15.05677 -1.38838,15.73722 -0.55469,0.68043 -1.57461,3.14428 -2.2665,5.4752 -0.69189,2.33092 -2.52586,5.48092 -4.0755,7 -2.08101,2.03997 -2.82478,3.74222 -2.84529,6.51196 -0.0153,2.0625 -0.40655,3.75 -0.86949,3.75 -0.46294,0 -1.37004,1.76338 -2.01576,3.91863 -0.94742,3.16218 -0.89188,4.75474 0.2877,8.25 1.2224,3.62216 3.53587,15.38598 3.56222,18.11359 0.004,0.43023 -1.00098,1.15531 -2.23363,1.6113 -1.61951,0.59909 -2.56769,0.38255 -3.41824,-0.78066 -0.64738,-0.88534 -1.50298,-1.2838 -1.90132,-0.88545 -0.39834,0.39834 -0.0976,1.48287 0.66824,2.41006 0.76587,0.92718 1.3925,2.62556 1.3925,3.77416 0,2.13367 0.12494,2.1598 8.17857,1.71003 1.19822,-0.0669 2.78565,-0.72874 3.52763,-1.47072 2.80908,-2.80907 8.64009,-3.9539 13.37971,-2.62689 2.42775,0.67973 4.41409,1.62739 4.41409,2.10591 0,0.47852 1.28026,0.87004 2.84501,0.87004 1.59545,0 3.65748,0.89776 4.69483,2.04402 2.52191,2.78669 5.92786,2.20074 6.06859,-1.04402 0.0596,-1.375 0.17214,-3.94838 0.25,-5.71862 0.10082,-2.29207 0.53906,-3.06608 1.52239,-2.68874 0.85878,0.32955 1.79848,-0.53296 2.48556,-2.28138 1.44675,-3.68162 3.33047,-6.61732 4.88362,-7.61095 0.6875,-0.43983 1.25,-1.42201 1.25,-2.18261 0,-0.76061 0.79504,-1.63526 1.76676,-1.94367 1.28603,-0.40817 1.79615,-1.68185 1.87479,-4.68099 0.0594,-2.26613 0.51493,-4.40662 1.01225,-4.75664 0.49731,-0.35002 1.72504,-4.6864 2.72829,-9.6364 1.00325,-4.95 2.0102,-9.195 2.23767,-9.43333 0.22746,-0.23834 0.94607,0.0992 1.59691,0.75 2.05024,2.05025 2.78332,1.3084 2.78332,-2.81667 0,-2.2 0.45,-4 1,-4 1.35769,0 1.26911,-9.92956 -0.12424,-13.92654 -0.83231,-2.38758 -0.83231,-3.51691 0,-4.34922 0.61833,-0.61833 1.12424,-1.68606 1.12424,-2.37272 0,-1.87071 4.2876,-6.13016 7.33815,-7.28998 1.86797,-0.7102 4.27952,-0.67414 7.92354,0.1185 4.18795,0.91095 6.10717,2.05984 9.57144,5.72969 4.23281,4.484 4.31948,4.71134 3.7437,9.81956 -0.66906,5.93577 -3.23928,12.14532 -5.82683,14.07741 -0.9625,0.71869 -1.75,1.70473 -1.75,2.1912 0,0.48646 -2.25,3.23119 -5,6.09938 -2.75,2.8682 -5,6.04466 -5,7.05881 0,1.01415 -0.40122,1.84391 -0.89159,1.84391 -0.49038,0 -1.148,1.02162 -1.4614,2.27027 -0.69667,2.77577 -6.17128,11.16309 -9.3824,14.37421 -2.44226,2.44227 -5.69067,3.09319 -6.76461,1.35552 -0.33992,-0.55 -1.04148,-1 -1.55902,-1 -1.25948,0 -1.20887,4.7164 0.059,5.5 0.55,0.33992 1,1.40176 1,2.35965 0,2.1878 -2.24836,7.12214 -3.25,7.13255 -0.4125,0.004 -0.75,0.60165 -0.75,1.32746 2e-5,1.36484 -4.40993,5.68034 -5.80464,5.68034 -1.67123,0 -8.19534,7.68794 -8.19534,9.6573 0,1.14014 0.94307,3.2719 2.09571,4.73724 2.24875,2.85884 1.95315,5.60546 -0.60328,5.60546 -1.28437,0 -1.19904,0.39855 0.46861,2.18856 2.0939,2.24753 2.73151,6.26539 1.14945,7.24315 -1.20147,0.74255 -2.25672,7.02275 -2.1454,12.76808 0.0757,3.90626 -0.29358,4.91334 -2.18702,5.96458 -1.25294,0.69561 -2.53521,1.28072 -2.8495,1.30019 -0.31428,0.0195 -1.35893,0.82294 -2.32143,1.78544 -2.14512,2.14512 -3.74778,2.28008 -2.96877,0.25 0.31659,-0.825 0.0775,-1.5 -0.53138,-1.5 -0.60885,0 -1.10699,0.45 -1.10699,1 0,0.55 -0.8376,1 -1.86133,1 -1.43686,0 -1.75435,0.55959 -1.39223,2.4539 0.38077,1.99188 -0.0219,2.57714 -2.13868,3.10841 -2.61438,0.65617 -3.48142,2.7797 -1.60776,3.93769 0.55,0.33992 1,1.71648 1,3.05902 0,1.34255 0.45,2.44098 1,2.44098 0.55,0 1,2.02501 1,4.5 0,2.92518 -0.43745,4.50536 -1.25,4.51531 -0.84605,0.0104 -0.77437,0.31612 0.22182,0.94612 1.24482,0.78724 1.28337,1.63536 0.25,5.49903 -1.70092,6.35954 -1.62349,11.90765 0.15666,11.22455 2.05601,-0.78896 3.05353,11.63069 1.54855,19.28035 -0.65298,3.31906 -1.51939,6.03464 -1.92536,6.03464 -0.40597,0 -1.4957,2.7 -2.42163,6 -0.92594,3.3 -2.11024,6 -2.63178,6 -0.52154,0 -0.94826,0.62356 -0.94826,1.38569 0,0.76214 -0.67223,2.67463 -1.49384,4.25 -0.82161,1.57538 -1.49661,3.87681 -1.5,5.11431 -0.006,2.02072 -0.49645,2.25 -4.8176,2.25 -3.42919,0 -5.42816,0.57457 -6.95819,2 -1.18071,1.10001 -2.51622,2 -2.9678,2 -0.45158,0 -1.46973,0.9 -2.26257,2 -1.48885,2.06567 -5,2.7679 -5,1 z m -63.32804,-20.19 c 1.73749,-1.91992 1.73362,-2.04026 -0.10897,-3.3876 -3.23548,-2.36583 -8.51342,-2.90054 -10.364,-1.04995 -1.50341,1.5034 -1.47538,1.62755 0.36749,1.62755 1.28866,0 2.38736,1.03935 3.10306,2.93547 1.26371,3.34794 3.9018,3.30068 7.00242,-0.12547 z m 5.51137,-1.02666 c -0.71756,-0.71757 -1.18333,-0.77661 -1.18333,-0.15001 0,1.33478 1.18261,2.5174 1.85,1.85 0.28417,-0.28416 -0.0158,-1.04916 -0.66667,-1.69999 z m -0.76512,-1.39033 c 1.60658,-0.6165 2.24632,-3.39301 0.78179,-3.39301 -1.03498,0 -3.2,2.16502 -3.2,3.2 0,0.95968 0.34794,0.98745 2.41821,0.19301 z m 24.39927,-38.2072 c 2.8287,-2.82619 5.04257,-3.9678 9.49237,-4.89488 5.64742,-1.17658 9.57706,-4.04172 9.65688,-7.04093 0.0183,-0.6875 0.37077,-1.25351 0.78327,-1.2578 1.19908,-0.0125 3.25,-5.14086 3.25,-8.12671 0,-2.031 0.99792,-3.4531 3.87366,-5.52022 2.24348,-1.61265 4.66329,-4.58181 5.75,-7.05538 1.03199,-2.34902 2.14813,-4.27521 2.48032,-4.28042 0.33218,-0.005 1.79468,-1.11298 3.25,-2.46172 2.8603,-2.65084 3.62888,-7.83143 1.37201,-9.24806 -0.7007,-0.43983 -2.01625,-1.96878 -2.92344,-3.39767 -0.9072,-1.42889 -3.48389,-4.3962 -5.726,-6.59401 -2.2421,-2.19781 -4.07655,-4.24909 -4.07655,-4.5584 0,-0.85947 4.25275,0.39276 6.47251,1.90584 2.38913,1.62854 3.52749,1.71078 3.52749,0.25484 0,-1.56809 -4.19028,-4.83786 -6.25,-4.87702 -0.9625,-0.0183 -1.79981,-0.59577 -1.86069,-1.28327 -0.26744,-3.02011 0.38169,-6.27973 1.31854,-6.62105 0.58335,-0.21252 0.43817,-0.72969 -0.33983,-1.21052 -1.08486,-0.67048 -0.95667,-1.13983 0.63685,-2.33165 1.09732,-0.82069 3.23263,-1.77422 4.74513,-2.11894 2.89625,-0.66008 3.8119,-2.46784 1.25,-2.46784 -1.81906,0 -1.86045,-0.44997 -0.27495,-2.98876 1.02993,-1.64916 0.91647,-2.18727 -0.71225,-3.37822 -1.64727,-1.20452 -1.73749,-1.65736 -0.60261,-3.02481 2.66682,-3.21331 -3.24084,-1.71438 -7.16019,1.81674 -3.36968,3.03589 -3.75,3.8787 -3.75,8.31013 0,5.42765 -0.66925,6.78431 -2.56896,5.20769 -0.86811,-0.72047 -1.45204,-0.7178 -1.90103,0.009 -1.04315,1.68785 -4.44069,1.20968 -6.76038,-0.95144 -2.58884,-2.4122 -3.76963,-2.54161 -3.76963,-0.41347 0,0.87278 1.35,2.09644 3,2.71925 3.11923,1.17737 4.24298,4.6939 1.5,4.6939 -0.825,0 -1.5,0.5051 -1.5,1.12244 0,0.7392 -0.4268,0.79729 -1.25,0.17013 -0.6875,-0.52378 -4.79798,-0.86486 -9.13441,-0.75797 -6.13858,0.15132 -8.08826,0.55863 -8.80505,1.83946 -0.50635,0.90481 -2.58337,2.34827 -4.61559,3.2077 -3.40957,1.44191 -3.95174,1.4259 -7.01971,-0.20731 -4.10921,-2.18751 -6.34454,-1.09052 -7.3003,3.58263 -0.57139,2.7938 -0.17675,3.80996 2.72853,7.02575 1.86809,2.06776 3.3993,4.60502 3.40269,5.63837 0.003,1.03334 0.6969,3.20341 1.54113,4.82239 1.28405,2.46239 1.32822,3.44275 0.27018,5.99708 -1.41921,3.42626 -1.19964,7.35319 0.52961,9.47195 0.87803,1.07581 0.85488,1.51293 -0.0971,1.83333 -1.7997,0.60573 -1.53961,3.03859 0.65421,6.11952 1.04732,1.47082 2.23478,4.9153 2.6388,7.65438 0.40402,2.73908 1.07777,5.20515 1.49721,5.48015 0.41945,0.275 0.97601,1.85 1.23681,3.5 0.26079,1.65 1.88015,5.3823 3.59857,8.294 1.71842,2.9117 3.20005,5.83671 3.2925,6.5 0.0925,0.66329 0.34635,-0.5104 0.5642,-2.6082 0.28553,-2.74964 1.42573,-4.84292 4.08518,-7.5 z m 26.18252,-83.68581 c 0,-1.375 0.45,-2.5 1,-2.5 0.55,0 1,1.125 1,2.5 0,1.375 -0.45,2.5 -1,2.5 -0.55,0 -1,-1.125 -1,-2.5 z m 5,-2.94098 c 0,-3.68859 1.60946,-5.74048 2.21294,-2.82126 0.51651,2.49851 -0.28256,6.26224 -1.32952,6.26224 -0.48588,0 -0.88342,-1.54844 -0.88342,-3.44098 z m -100,95.44098 c 0,-0.55 -0.45,-1 -1,-1 -0.55,0 -1,0.45 -1,1 0,0.55 0.45,1 1,1 0.55,0 1,-0.45 1,-1 z m 7.98635,-4.75 c -0.033,-4.23065 -1.23169,-6.25 -3.70997,-6.25 -1.86004,0 -2.33673,0.40037 -1.88337,1.58179 0.33385,0.86998 0.60699,1.99498 0.60699,2.5 0,0.50501 0.94814,0.91821 2.10699,0.91821 1.46204,0 1.93079,0.45915 1.53138,1.5 -0.31658,0.825 -0.13972,1.5 0.39301,1.5 0.53274,0 0.96248,-0.78749 0.95497,-1.75 z m 104.01365,-7.19098 c 0,-1.17986 -1.95035,-2.442 -2.66667,-1.72569 -0.71631,0.71632 0.54583,2.66668 1.72569,2.66668 0.51754,0 0.94098,-0.42344 0.94098,-0.94098 z m 22.5,-32.05902 c 0.35052,-0.56716 -0.48962,-1 -1.94098,-1 -1.40746,0 -2.55902,0.45 -2.55902,1 0,0.55 0.87344,1 1.94098,1 1.06754,0 2.2191,-0.45 2.55902,-1 z m -93.8913,-30.42268 c 0.60004,-1.56368 -2.87119,-5.5642 -4.8587,-5.59956 -0.6875,-0.0122 -2.375,-0.90222 -3.75,-1.97776 -1.375,-1.07554 -3.0625,-1.96553 -3.75,-1.97776 -2.14926,-0.0382 -1.36942,2.40425 1.5,4.69805 1.5125,1.20909 3.875,3.10168 5.25,4.20576 2.96819,2.38335 4.85976,2.603 5.6087,0.65128 z m 92.3913,-2.99399 c 0,-0.77916 0.53096,-1.59365 1.17991,-1.80997 1.63552,-0.54517 0.35705,-3.41562 -2.10914,-4.73549 -1.88986,-1.01142 -1.97052,-0.90439 -1.08124,1.43459 0.62067,1.6325 0.61562,2.52754 -0.0143,2.52754 -0.53639,0 -0.97525,-0.47656 -0.97525,-1.05902 0,-0.58246 -0.40752,-0.80715 -0.9056,-0.49932 -1.224,0.75647 1.06492,5.54061 2.6556,5.55054 0.6875,0.004 1.25,-0.6297 1.25,-1.40887 z m -54.73202,-28.33333 c -0.28419,-1.86597 -1.08542,-3.25 -1.88148,-3.25 -1.89862,0 -1.74034,2.15713 0.34705,4.72974 2.11507,2.60669 2.15145,2.57161 1.53443,-1.47974 z m 27.16199,-9.36331 c -1.00883,-1.63232 -2.42997,-0.90961 -2.42997,1.23575 0,1.76626 0.24988,1.91507 1.48899,0.8867 0.81894,-0.67966 1.24239,-1.63477 0.94098,-2.12245 z m 1.57003,-6.44571 c 0,-2.11803 -0.40488,-3.30878 -1,-2.94098 -0.55,0.33992 -1,1.94148 -1,3.55902 0,1.61754 0.45,2.94098 1,2.94098 0.55,0 1,-1.60156 1,-3.55902 z m -2.15282,-47.19176 c 1.5025,-1.20828 1.47093,-1.30206 -0.34718,-1.03101 -1.52415,0.22723 -2.0368,1.12897 -2.15467,3.78998 -0.10264,2.31697 0.0142,2.66385 0.34717,1.031 0.27602,-1.35345 1.24562,-3.05894 2.15468,-3.78997 z m 7.15282,-0.64223 c 0,-0.21616 -0.69837,-0.661 -1.55194,-0.98854 -0.88992,-0.3415 -1.29132,-0.17385 -0.94098,0.393 0.58726,0.95021 2.49292,1.40545 2.49292,0.59554 z m 76.5,-1.60699 c 0.33992,-0.54999 0.16803,-1 -0.38197,-1 -0.55,0 -1.27811,0.45001 -1.61803,1 -0.33992,0.55 -0.16803,1 0.38197,1 0.55,0 1.27811,-0.45 1.61803,-1 z m -116.5,214.55902 c 0,-0.79254 0.45,-1.7191 1,-2.05902 0.55,-0.33992 1,0.30852 1,1.44099 0,1.13245 -0.45,2.05901 -1,2.05901 -0.55,0 -1,-0.64844 -1,-1.44098 z m -18.73097,-0.25201 c 0.97297,-0.25354 2.32297,-0.23687 3,0.0371 0.67703,0.27393 -0.11903,0.48138 -1.76903,0.46099 -1.65,-0.0204 -2.20394,-0.2445 -1.23097,-0.49804 z m -30.00713,-4.99748 c 0.92977,-0.92976 2.02566,-1.3553 2.43533,-0.94563 0.40967,0.40967 0.0829,1.1635 -0.72619,1.67516 -2.43457,1.53967 -3.51652,1.07786 -1.70914,-0.72953 z M 49.524011,223.90769 c -0.333,-1.04919 -1.228395,-2.14666 -1.989765,-2.43883 -1.7239,-0.66152 -0.848578,-4.65355 1.020371,-4.65355 0.729666,0 1.914682,0.79532 2.633369,1.76738 0.718687,0.97206 2.544204,2.55743 4.056704,3.52306 3.833187,2.44721 3.430746,3.70957 -1.182612,3.70957 -2.990872,0 -4.077601,-0.45682 -4.538067,-1.90762 z m -15.043183,-6.11481 c -0.256982,-0.41581 -1.682565,-1.06104 -3.167962,-1.43385 -3.054174,-0.76655 -6.255433,-4.07155 -9.970604,-10.29372 -1.395689,-2.3375 -2.944856,-4.25 -3.442594,-4.25 -0.497738,0 -0.904978,-0.6031 -0.904978,-1.34023 0,-0.73713 -1.341848,-3.77463 -2.981885,-6.75 -3.672064,-6.6619 -3.92171,-11.9673 -0.778944,-16.55387 2.890922,-4.21902 8.454383,-6.77116 12.902833,-5.91893 5.606429,1.07406 12.615308,4.90114 14.356608,7.83918 0.904944,1.52688 2.73796,3.95509 4.07337,5.39602 2.277894,2.45789 2.923163,4.54977 2.615654,8.47961 -0.07109,0.90848 0.532612,2.20108 1.341556,2.87245 0.808945,0.67136 1.470808,1.84056 1.470808,2.59821 0,0.75766 0.45,1.37756 1,1.37756 1.398992,0 1.248085,5.34878 -0.245539,8.70295 -0.685047,1.53838 -2.346924,3.69705 -3.693062,4.79705 -2.884527,2.3571 -11.90152,5.56771 -12.575261,4.47757 z m 85.513862,-63.9967 c 0,-0.53948 -0.65917,-0.98087 -1.46482,-0.98087 -2.22612,0 -3.52254,-3.30303 -2.87137,-7.3157 0.41626,-2.56515 -0.005,-4.7255 -1.46717,-7.53154 -1.12797,-2.16406 -2.82024,-7.80873 -3.7606,-12.54371 -0.94035,-4.73497 -2.00239,-8.60905 -2.36008,-8.60905 -0.35769,0 -0.72267,-0.96 -0.81105,-2.13336 -0.0884,-1.17335 -1.27655,-4.43584 -2.64037,-7.25 -1.36381,-2.81414 -2.79593,-6.91663 -3.18249,-9.116635 -0.38656,-2.2 -1.03377,-4.45 -1.43825,-5 -1.06266,-1.444991 -2.066358,-6.098787 -2.857653,-13.25 -0.563464,-5.092214 -0.424936,-6.25 0.747806,-6.25 0.791657,0 1.115397,-0.323984 0.719417,-0.719964 -0.39598,-0.39598 -1.617769,-0.73348 -2.715087,-0.75 -1.277584,-0.01923 -2.786913,-1.468621 -4.196703,-4.030036 -1.210869,-2.2 -2.53908,-4.15 -2.95158,-4.333333 -0.4125,-0.183334 -0.75,-1.609132 -0.75,-3.168441 0,-2.166734 0.833301,-3.350115 3.534696,-5.019669 2.652153,-1.639121 3.384368,-2.658205 2.932612,-4.08156 -0.334491,-1.053888 -0.12769,-1.896997 0.465304,-1.896997 2.035779,0 1.054776,-2.054297 -1.432612,-3 -4.870402,-1.851724 -1.621758,-9.482412 5.12982,-12.049358 3.10147,-1.179176 9.72633,-0.390579 11.68223,1.390604 0.69983,0.637315 2.15341,1.656986 3.23018,2.265937 1.07677,0.608951 2.12281,1.958951 2.32453,3 0.20172,1.041049 1.32672,3.242817 2.5,4.892817 1.862,2.618547 2.16574,4.589387 2.38886,15.5 0.1865,9.12009 0.83183,14.527946 2.38663,20 1.17206,4.125 2.33719,10.140784 2.58917,13.368408 0.36742,4.706092 0.83551,5.967097 2.36337,6.366637 1.78881,0.46778 2.47976,3.47383 2.12958,9.26496 -0.17249,2.85254 1.94473,11 2.85849,11 1.33839,0 1.12348,8.39365 -0.25008,9.76721 -0.88962,0.88963 -0.83016,1.29683 0.25,1.71223 1.01951,0.39208 1.40626,2.29552 1.37818,6.78279 -0.0464,7.41614 -0.33216,8.49003 -3.00077,11.27758 -2.16221,2.25856 -11.46019,4.23907 -11.46019,2.44105 z m 42.75,-14.06823 c -0.9625,-1.6911 -1.75,-3.63481 -1.75,-4.31936 0,-0.68455 -1.125,-2.30153 -2.5,-3.59328 -1.375,-1.29175 -2.5,-3.13269 -2.5,-4.09098 0,-0.95829 -0.54066,-1.92257 -1.20147,-2.14284 -1.25769,-0.41923 -0.20724,-10.95928 2.06961,-20.76618 1.26289,-5.439545 1.45953,-17.679448 0.29559,-18.398804 -0.45995,-0.284264 -0.91639,-2.634972 -1.01431,-5.223795 -0.0979,-2.588824 -0.57072,-5.195302 -1.05066,-5.792174 -1.46261,-1.818937 -2.43766,-9.632526 -2.31649,-18.56322 0.0875,-6.447234 -0.26369,-8.896482 -1.46605,-10.225078 -1.45845,-1.611567 -1.33812,-1.97405 1.55135,-4.673212 3.74721,-3.500421 3.86799,-4.123712 0.7991,-4.123712 -1.28334,0 -2.58863,-0.255294 -2.90066,-0.567319 -0.56673,-0.566732 2.15398,-9.263521 4.67156,-14.932681 0.73273,-1.65 1.89302,-4.600631 2.57842,-6.556958 0.72543,-2.070588 2.47889,-4.26444 4.19613,-5.25 3.24171,-1.860486 9.31357,-2.269516 10.28788,-0.693042 0.33992,0.55 1.46604,1 2.50248,1 1.03645,0 2.68191,1.35 3.65659,3 0.97468,1.65 2.05325,3 2.39682,3 0.34358,0 1.20108,2.402699 1.90557,5.339331 0.93488,3.89704 0.9892,5.884339 0.20109,7.356937 -1.35326,2.528593 -1.56013,7.606297 -1.14639,28.138008 0.20242,10.04548 -0.052,16.590583 -0.66087,17 -3.19902,2.151124 -5.00348,31.860269 -2.22699,36.665719 1.29634,2.24367 0.83629,15.83799 -0.68799,20.32951 -1.79148,5.27891 -3.72036,7.74684 -7.63829,9.77287 -4.09654,2.1184 -6.12711,1.69228 -8.05202,-1.68974 z m 112.25,-16.91264 c 0,-0.54999 0.45,-1 1,-1 0.55,0 1,0.45001 1,1 0,0.55 -0.45,1 -1,1 -0.55,0 -1,-0.45 -1,-1 z\",\n    style: {\n      fill: \"currentColor\"\n    },\n    id: \"path12\"\n  }));\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgHand, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/hand.1c03d420.svg\";\nexport { ForwardRef as ReactComponent };","import React, { Component } from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/styles';\r\nimport classNames from 'classnames';\r\nimport { COLORS } from '../../../mapView/constants';\r\nimport { Character, characters, healerCharacters } from '../../../../data/characters';\r\nimport { calcCss } from '../../../../utils/sizeCss';\r\nimport { PageSizes } from '../../../theme/createTheme';\r\nimport ReactHammer from 'react-hammerjs';\r\nimport { timings } from './timings';\r\nimport { ModalMode } from './controller';\r\nimport SliderIndicator from './sliderIndicator';\r\nimport ModalTitleRow from '../modalTitleRow';\r\nimport { ReactComponent as Icon } from '../../../../images/hand.svg';\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    mode: ModalMode;\r\n    modalSizes: {\r\n        width: number;\r\n        height: number;\r\n        bottom: number;\r\n        left: number\r\n    },\r\n    pageSizes: PageSizes,\r\n    onSelectedCharacterChanged: (activeCharacter: Character | null, allSelectedChars: Character[]) => void\r\n}\r\n\r\ninterface State {\r\n    pageSelected: number;\r\n    selectedCharacters: Character[];\r\n}\r\n\r\nclass SelectCharacterModalContent extends Component<Props, State> {\r\n\r\n    state: State = {\r\n        pageSelected: 0,\r\n        selectedCharacters: []\r\n    };\r\n\r\n    getDisplayCharacter = () => {\r\n        const { selectedCharacters, pageSelected } = this.state;\r\n        if (!selectedCharacters.length) {\r\n            return null;\r\n        }\r\n        const lastChar = selectedCharacters[selectedCharacters.length - 1];\r\n        if (pageSelected !== lastChar.closeFor) {\r\n            return null;\r\n        }\r\n        return lastChar;\r\n    };\r\n\r\n    render() {\r\n        const { classes, modalSizes } = this.props;\r\n        const { pageSelected } = this.state;\r\n        const isVisible = this.props.mode === 'visible';\r\n\r\n        const displayCharacter = this.getDisplayCharacter();\r\n\r\n        return <div style={ { pointerEvents: isVisible ? 'all' : 'none' } }>\r\n            { this.renderOverlay() }\r\n            <ReactHammer onSwipe={ this.onSwipe }>\r\n                <div\r\n                    className={ classNames(classes.wrapper, {\r\n                        [classes.visible]: isVisible\r\n                    }) }\r\n                    style={ {\r\n                        left: modalSizes.left,\r\n                        bottom: modalSizes.bottom,\r\n                        width: modalSizes.width,\r\n                        height: modalSizes.height\r\n                    } }>\r\n\r\n                    <ModalTitleRow text={ displayCharacter?.name } />\r\n\r\n                    <div className={ classes.cardSelectionRow }>\r\n                        { this.renderCardsRow(pageSelected) }\r\n                    </div>\r\n\r\n                    { this.renderSliderIndicatorsRowsContainer() }\r\n\r\n                </div>\r\n            </ReactHammer>\r\n        </div>\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<Props>, prevState: Readonly<State>, snapshot?: any): void {\r\n        if (this.props.mode !== 'visible' && this.state.selectedCharacters.length) {\r\n            this.setState({ pageSelected: 0, selectedCharacters: []});\r\n        }\r\n    }\r\n\r\n    private onSwipe = (ev: HammerInput) => {\r\n        let page = this.state.pageSelected;\r\n        if (ev.velocityX > 0) {\r\n            page--;\r\n            if (page < 0) page = 3;\r\n        } else if (ev.velocityX < 0) {\r\n            page++;\r\n            if (page > 3) page = 0;\r\n        }\r\n        this.setPage(page);\r\n    };\r\n\r\n    renderOverlay = () => {\r\n        const { classes, pageSizes, mode } = this.props;\r\n\r\n        return <div className={ classNames(classes.overlay, {\r\n            visible: mode === 'visible',\r\n            kill: mode === 'killed-and-hidden',\r\n            hidden: mode === 'hidden'\r\n        }) } style={ {\r\n            top: pageSizes.top,\r\n        } }/>;\r\n    };\r\n\r\n    renderSliderIndicatorsRowsContainer = () => {\r\n        const { classes, modalSizes } = this.props;\r\n        const { pageSelected } = this.state;\r\n        const s = ~~calcCss(this.props.modalSizes, 3.5, 'vh');\r\n        const padding = modalSizes.width / 3;\r\n\r\n        return <div className={ classes.sliderIndicatorRow }\r\n                    style={ { width: modalSizes.width - padding * 2, paddingLeft: padding, paddingRight: padding } }>\r\n            { COLORS.charTints.map((_, i) => this.renderSliderIndicator(i === pageSelected, i)) }\r\n        </div>\r\n    };\r\n\r\n    renderSliderIndicator = (isActive: boolean, idx: number) => {\r\n\r\n        const num = idx == 3\r\n            ? this.state.selectedCharacters.filter(c => c.isHealer).length\r\n            : this.state.selectedCharacters.filter(c => !c.isHealer && c.closeFor === idx).length;\r\n\r\n        return <SliderIndicator key={ idx } isActive={ isActive }\r\n                                isHealer={ idx == 3 }\r\n                                num={ num }\r\n                                onClick={ () => this.setPage(idx) }>\r\n            <Icon color={ COLORS.charTints[idx] }\r\n                  viewBox={ '0 0 340 340' }\r\n                  width={ '100%' }\r\n                  height={ '100%' } />\r\n        </SliderIndicator>\r\n    };\r\n\r\n    setPage = (pageNo: number) => {\r\n        this.setState({\r\n            pageSelected: pageNo\r\n        });\r\n        this.props.onSelectedCharacterChanged(null, this.state.selectedCharacters);\r\n    };\r\n\r\n    renderCardsRow = (page: number) => {\r\n        if (page === 3) {\r\n            return healerCharacters.map(this.renderCard);\r\n        }\r\n        const chars = characters.filter(c => c.closeFor === page);\r\n        return chars.map(this.renderCard);\r\n    };\r\n\r\n    renderCard = (char: Character) => {\r\n        const { classes } = this.props;\r\n        const { selectedCharacters } = this.state;\r\n        return <div key={ char.id }>\r\n            <img draggable={ false } alt={char.name} className={ classNames(classes.card, `c${ char.closeFor }`, {\r\n                active: selectedCharacters.some(c => c.id === char.id),\r\n            }) } onClick={ () => this.onCardClick(char) } src={ `cards/${ char.id }.jpg` }/>\r\n        </div>\r\n    };\r\n\r\n    onCardClick = (char: Character) => {\r\n        let selectedCharacters = this.state.selectedCharacters;\r\n        const existingIndex = selectedCharacters.findIndex(c => c.id === char.id);\r\n        if (existingIndex >= 0) {\r\n            selectedCharacters.splice(existingIndex, 1);\r\n            const newChar = selectedCharacters[selectedCharacters.length - 1] || null;\r\n            this.props.onSelectedCharacterChanged(newChar, this.state.selectedCharacters);\r\n        } else {\r\n            selectedCharacters.push(char);\r\n            this.props.onSelectedCharacterChanged(char, this.state.selectedCharacters);\r\n        }\r\n        this.setState({ selectedCharacters });\r\n    }\r\n}\r\n\r\nconst styles = createStyles({\r\n    '@keyframes appear': {\r\n        from: { opacity: 0 },\r\n        to: { opacity: 1 }\r\n    },\r\n    '@keyframes disappear': {\r\n        from: { opacity: 1 },\r\n        to: { opacity: 0 }\r\n    },\r\n    '@keyframes disappearP': {\r\n        from: { opacity: 0.3 },\r\n        to: { opacity: 0 }\r\n    },\r\n    wrapper: {\r\n        position: 'absolute',\r\n        background: 'black',\r\n        opacity: 0,\r\n        transition: '0.3s linear all',\r\n        pointerEvents: 'none'\r\n    },\r\n    visible: {\r\n        animationName: '$appear',\r\n        animationDuration: '0.3s',\r\n        animationDelay: '0.7s',\r\n        animationFillMode: 'forwards',\r\n        opacity: 0,\r\n        pointerEvents: 'all'\r\n    },\r\n\r\n    cardSelectionRow: {\r\n        display: 'flex',\r\n        justifyContent: 'space-around'\r\n    },\r\n    card: {\r\n        height: '20vh',\r\n        transition: '0.3s linear all',\r\n        '&.active': {\r\n            transform: 'scale(1.1) translateY(1vh)',\r\n            '&.c0': {\r\n                boxShadow: `0px 0px 30px 10px ${ COLORS.charTints[0] }`,\r\n            },\r\n            '&.c1': {\r\n                boxShadow: `0px 0px 30px 10px ${ COLORS.charTints[1] }`,\r\n            },\r\n            '&.c2': {\r\n                boxShadow: `0px 0px 30px 10px ${ COLORS.charTints[2] }`,\r\n            },\r\n            '&.c3': {\r\n                boxShadow: `0px 0px 30px 10px ${ COLORS.charTints[3] }`,\r\n            }\r\n        },\r\n    },\r\n\r\n    sliderIndicatorRow: {\r\n        position: 'absolute',\r\n        bottom: '1vh',\r\n        display: 'flex',\r\n        justifyContent: 'space-around',\r\n        height: '3.5vh',\r\n        // paddingLeft: '24vh',\r\n        // paddingRight: '24vh',\r\n    },\r\n\r\n    overlay: {\r\n        position: 'absolute',\r\n        width: '100%',\r\n        height: '100%',\r\n        opacity: 0,\r\n        animationFillMode: 'forwards',\r\n        transition: '0.2s linear all',\r\n        background: 'linear-gradient(90deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 50%, rgba(0,0,0,1) 100%)',\r\n        '&.visible': {\r\n            animationName: '$appear',\r\n            animationDelay: '0.7s',\r\n            animationDuration: '0.3s',\r\n        },\r\n        '&.kill': {\r\n            opacity: 0.3,\r\n            animationName: '$disappearP',\r\n            animationDelay: `${ timings.destructionTotal - 0.3 }s`,\r\n            animationDuration: '0.3s',\r\n        },\r\n        '&.hidden': {\r\n            opacity: 1,\r\n            animationName: '$disappear',\r\n            animationDuration: '0.3s',\r\n        }\r\n    }\r\n});\r\n\r\nexport default withStyles(styles)(SelectCharacterModalContent);\r\n","import React, { Component } from 'react';\r\nimport { Point, Rectangle } from '../../../model';\r\nimport { WithResources, withResources } from '../../mapView/loadResources';\r\nimport { Container, withPixiApp } from '@inlet/react-pixi';\r\nimport * as PIXI from 'pixi.js';\r\nimport { getRandomBool, getRandomInt } from '../../../utils';\r\nimport { Theme } from '../../theme/createTheme';\r\n\r\ninterface Props extends WithResources {\r\n    rect: Rectangle;\r\n    pageSizes: Theme['pageSizes'];\r\n    app: PIXI.Application;\r\n    isVisible: boolean;\r\n}\r\n\r\ninterface CrowSprite {\r\n    start: Point;\r\n    speed: Point,\r\n    target: Point,\r\n    sprite: PIXI.AnimatedSprite;\r\n    isLeft: boolean;\r\n    isTop: boolean;\r\n    done: {\r\n        x: boolean,\r\n        y: boolean\r\n    }\r\n}\r\n\r\nclass CrowsAnimation extends Component<Props> {\r\n\r\n    private crows: CrowSprite[] = [];\r\n    private container: PIXI.Container = null as any;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        props.app.ticker.add(this.tick);\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        if (this.props.isVisible) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        this.props.app.ticker.remove(this.tick);\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<Props>, nextState: Readonly<{}>, nextContext: any): boolean {\r\n        if (!nextProps.isVisible && this.props.isVisible) {\r\n            this.reverseSprites();\r\n        }\r\n        if (nextProps.isVisible && !this.props.isVisible) {\r\n            this.start();\r\n        }\r\n        if (nextProps.isVisible && nextProps.rect.x !== this.props.rect.x) {\r\n            this.start();\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private reverseSprites = () => {\r\n        this.crows.forEach(c => {\r\n            const oldStart = c.start;\r\n            c.start = c.target;\r\n            c.target = oldStart;\r\n            c.isTop = !c.isTop;\r\n            c.isLeft = !c.isLeft;\r\n            c.done = {\r\n                x: false,\r\n                y: false\r\n            };\r\n            c.sprite.gotoAndPlay(getRandomInt(0, 10));\r\n            c.sprite.scale.set(-c.sprite.scale.x);\r\n            c.sprite.angle = c.sprite.angle - 180;\r\n            const arriveDelay = getRandomInt(50, 150);\r\n            c.speed = {\r\n                x: ((c.target.x - c.start.x) / arriveDelay),\r\n                y: ((c.target.y - c.start.y) / arriveDelay)\r\n            };\r\n        });\r\n    };\r\n\r\n    start = () => {\r\n        const { rect } = this.props;\r\n        if (this.crows.length) {\r\n            // TODO: realign\r\n            this.crows.forEach(c => c.sprite.destroy());\r\n            this.crows = [];\r\n        }\r\n\r\n        const density = 25;\r\n        const xCount = rect.width / density;\r\n        const yCount = rect.height / density;\r\n        const rnd = () => getRandomInt(-25, 25);\r\n\r\n        for (let x = 0; x < xCount; x++) {\r\n            for (let y = 0; y < yCount; y++) {\r\n                const sprite = this.createSprite({\r\n                    x: rect.x + density * x + rnd(),\r\n                    y: rect.y + density * y + rnd(),\r\n                });\r\n                this.crows.push(sprite);\r\n            }\r\n        }\r\n    };\r\n\r\n    private createSprite = (target: Point): CrowSprite => {\r\n\r\n        const { viewport } = this.props.pageSizes;\r\n\r\n        const isLeft = getRandomBool();\r\n        const isTop = getRandomBool();\r\n        const scale = getRandomInt(5, 10) / 10;\r\n\r\n        let start = {\r\n            x: isLeft ? getRandomInt(-300, 0) : getRandomInt(viewport.width, viewport.width + 300),\r\n            y: isTop ? getRandomInt(-300, 0) : getRandomInt(viewport.height, viewport.height + 300),\r\n        };\r\n        var arriveDelay = getRandomInt(80, 120);\r\n        const sprite = new PIXI.AnimatedSprite(this.props.resources.crows);\r\n        sprite.x = start.x;\r\n        sprite.y = start.y;\r\n        sprite.anchor.set(0.5);\r\n        sprite.scale.set(scale, scale);\r\n        sprite.animationSpeed = getRandomInt(5, 10) / 10;\r\n        sprite.angle = getRandomInt(0, 30);\r\n        sprite.gotoAndPlay(getRandomInt(0, 10));\r\n        if (!isLeft) {\r\n            sprite.scale = new PIXI.Point(-scale, scale);\r\n        }\r\n\r\n        const speed = {\r\n            x: ((target.x - start.x) / arriveDelay),\r\n            y: ((target.y - start.y) / arriveDelay)\r\n        };\r\n\r\n        this.container.addChild(sprite);\r\n        return {\r\n            start,\r\n            sprite,\r\n            speed,\r\n            target,\r\n            isLeft,\r\n            isTop,\r\n            done: {\r\n                x: false,\r\n                y: false\r\n            }\r\n        }\r\n    };\r\n\r\n    private checkCoord = (crow: CrowSprite, targetLower: boolean, coord: 'x' | 'y') => {\r\n        if (targetLower) {\r\n            if (crow.sprite[coord] > crow.target[coord]) {\r\n                crow.sprite[coord] = crow.target[coord];\r\n                crow.done[coord] = true;\r\n            }\r\n        } else if (crow.sprite[coord] < crow.target[coord]) {\r\n            crow.sprite[coord] = crow.target[coord];\r\n            crow.done[coord] = true;\r\n        }\r\n    };\r\n\r\n    tick = () => {\r\n        const elapsed = this.props.app.ticker.elapsedMS;\r\n\r\n        this.crows.forEach(crow => {\r\n            if (crow.done.x && crow.done.y) return;\r\n            crow.sprite.x += elapsed * (crow.speed.x / 10);\r\n            crow.sprite.y += elapsed * (crow.speed.y / 10);\r\n\r\n            this.checkCoord(crow, crow.isLeft, 'x');\r\n            this.checkCoord(crow, crow.isTop, 'y');\r\n\r\n            if (crow.done.x && crow.done.y) {\r\n                crow.sprite.stop();\r\n            }\r\n        });\r\n    };\r\n\r\n    render() {\r\n        return <Container ref={(c: any) => this.container = c} />;\r\n    }\r\n}\r\n\r\nexport default withResources(withPixiApp(\r\n    CrowsAnimation));\r\n","import { PixiComponent, withPixiApp } from '@inlet/react-pixi';\r\nimport { Resources, withResources } from '../../../mapView/loadResources';\r\nimport { Rectangle } from '../../../../model';\r\nimport * as gsap from 'gsap';\r\nimport { timings } from './timings';\r\nimport * as PIXI from 'pixi.js';\r\n\r\ninterface Props {\r\n    app: PIXI.Application,\r\n    scale: number;\r\n    target: { x: number, y: number, scale: number };\r\n    tex: PIXI.Texture,\r\n    resources: Resources,\r\n    position: Rectangle;\r\n}\r\n\r\nexport const DisappearingCard = withPixiApp(withResources(PixiComponent<Props, any>('DisappearingCard', {\r\n    create(props) {\r\n        const { scale, resources, target, position } = props;\r\n\r\n        const maskSprt = PIXI.Sprite.from(resources.cardMaskTex);\r\n        // align mask paddings\r\n        maskSprt.x = -60;\r\n        maskSprt.y = -98;\r\n\r\n        const sprite = PIXI.Sprite.from(props.tex);\r\n\r\n        const displacementSprite = PIXI.Sprite.from(props.resources.cloudTex);\r\n        displacementSprite.scale.set(scale, scale);\r\n        displacementSprite.texture.baseTexture.wrapMode = PIXI.WRAP_MODES.REPEAT;\r\n        const filter = new PIXI.filters.DisplacementFilter(displacementSprite, 0);\r\n        filter.padding = 500;\r\n\r\n        const targetAnchorX = 0.1;\r\n        const targetAnchorY = 0.4;\r\n\r\n        const container = new PIXI.Container();\r\n\r\n        container.position.set(position.x,  position.y);\r\n        container.scale.set(scale, scale);\r\n\r\n        const positionTl = new gsap.TimelineLite()\r\n            .to(container.position, timings.cardRealign,{ x: target.x, y: target.y })\r\n            .to(container.scale, timings.cardRealign, { x: target.scale, y: target.scale }, timings.mod('cardRealign'))\r\n        ;\r\n\r\n        const disTl = new gsap.TimelineLite()\r\n            .to(displacementSprite.anchor, timings.destruction, { x: targetAnchorX * target.scale, y: targetAnchorY * target.scale })\r\n            .to(filter.scale, timings.destruction, { x: -3000, y: -3000, ease: gsap.Expo.easeIn }, timings.mod('destruction'))\r\n            .to(container, timings.destruction, { alpha: 0, ease: gsap.Power4.easeIn }, timings.mod('destruction'))\r\n        ;\r\n\r\n        const masterTl = new gsap.TimelineLite({ paused: true })\r\n            .add(positionTl)\r\n            .add(disTl)\r\n        ;\r\n\r\n        sprite.filters = [filter];\r\n\r\n        container.addChild(sprite);\r\n        container.addChild(maskSprt);\r\n\r\n        maskSprt.isMask = true;\r\n        container.mask = maskSprt;\r\n\r\n        masterTl.play();\r\n        return container;\r\n    }\r\n})));\r\n","import { Resources, withResources } from '../../../mapView/loadResources';\r\nimport { PageSizes } from '../../../theme/createTheme';\r\nimport { Character } from '../../../../data/characters';\r\nimport React, { Component } from 'react';\r\nimport * as PIXI from 'pixi.js';\r\nimport { Sprite, Container } from '@inlet/react-pixi';\r\nimport { ModalSizes } from '../mixedMediaModal';\r\nimport { Rectangle } from '../../../../model';\r\n\r\ninterface Props {\r\n    resources: Resources,\r\n    sizes: ModalSizes,\r\n    pageSizes: PageSizes,\r\n    selectedCharacter: Character | null,\r\n    positionCalculated: (rect: Rectangle) => void;\r\n}\r\n\r\nclass CharacterOverlay extends Component<Props> {\r\n\r\n    render() {\r\n        const { sizes, pageSizes, resources } = this.props;\r\n        if (!resources || !this.props.selectedCharacter) return null;\r\n\r\n        const baseTex = resources?.characterCards[this.props.selectedCharacter?.id];\r\n\r\n        const scrFullHeight = (sizes.width / baseTex.width) * baseTex.height;\r\n        const scrShift = scrFullHeight * 0.1;\r\n        const scrShiftedHeight = scrFullHeight - scrShift;\r\n        const scrAvailableSpace = pageSizes.middle - sizes.pixiTop;\r\n        const scrRequiredHeight = scrAvailableSpace > scrShiftedHeight\r\n            ? scrFullHeight\r\n            : scrAvailableSpace;\r\n\r\n        this.props.positionCalculated({\r\n            x: sizes.left,\r\n            y: -scrShift,\r\n            width: sizes.width,\r\n            height: scrRequiredHeight\r\n        });\r\n\r\n        const texHeight = (scrRequiredHeight / scrFullHeight) * baseTex.height;\r\n\r\n        return <Container>\r\n            <Sprite\r\n                texture={ new PIXI.Texture(baseTex, new PIXI.Rectangle(0, 0, baseTex.width, texHeight)) }\r\n                width={ sizes.width }\r\n                height={ scrRequiredHeight }\r\n                x={ sizes.left }\r\n                y={ -scrShift }\r\n            />\r\n        </Container>\r\n    }\r\n\r\n}\r\n\r\nexport default withResources(CharacterOverlay);\r\n","export type Factor = { width: number, height: number, x: number, y: number };\r\n\r\n// TODO: yep, this should be refactored, but seriously, screw this\r\nexport function alignFactors(cardsCount: number, viewport: { width: number, height: number }, cardRatio: number): Factor[] {\r\n    switch (cardsCount) {\r\n        case 1:\r\n            return alignFactors1(cardsCount, viewport, cardRatio);\r\n        case 2:\r\n            return alignFactors2(cardsCount, viewport, cardRatio);\r\n        case 3:\r\n            return alignFactors3(cardsCount, viewport, cardRatio);\r\n        case 4:\r\n            return alignFactors4(cardsCount, viewport, cardRatio);\r\n    }\r\n    const b = alignFactors4(cardsCount, viewport, cardRatio);\r\n    let left = cardsCount - 4;\r\n    for (let i = 0; left > 0; i++, left--) {\r\n        b.push(b[i]);\r\n    }\r\n    return b;\r\n}\r\n\r\nfunction alignFactors1(cardsCount: number, viewport: { width: number, height: number }, cardRatio: number) {\r\n    const screenRatio = viewport.width / viewport.height;\r\n\r\n    const marginX = 0;\r\n    const marginY = 0.05;\r\n\r\n    const availableWidth = 1 - (marginX * 2);\r\n    const availableHeight = 1 - (marginY * 2);\r\n\r\n    function get() {\r\n        const cardHeight = availableHeight * screenRatio;\r\n        const cardWidth = availableHeight * cardRatio;\r\n\r\n        if (cardHeight > availableHeight) {\r\n            const scaleFactor = availableHeight / cardHeight;\r\n            return {\r\n                cardHeight: cardHeight * scaleFactor,\r\n                cardWidth: cardWidth * scaleFactor\r\n            }\r\n        }\r\n\r\n        return {\r\n            cardHeight, cardWidth\r\n        }\r\n    }\r\n\r\n    const { cardWidth, cardHeight } = get();\r\n\r\n    const cardX = (availableWidth - cardWidth) / 2 + marginX;\r\n    const cardY = (availableHeight - cardHeight) / 2 + marginY;\r\n\r\n    return [{\r\n        x: cardX,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }]\r\n}\r\n\r\nfunction alignFactors2(cardsCount: number, viewport: { width: number, height: number }, cardRatio: number) {\r\n    const marginX = 0.01;\r\n    const marginY = 0.01;\r\n\r\n    const screenRatio = viewport.width / viewport.height;\r\n\r\n    const availableWidth = 1 - (marginX * 2);\r\n    const availableHeight = 1 - (marginY * 2);\r\n\r\n    function get() {\r\n        const cardWidth = availableWidth / 2.5;\r\n        const cardHeight = cardWidth / cardRatio * screenRatio;\r\n\r\n        if (cardHeight > availableHeight) {\r\n            const scaleFactor = availableHeight / cardHeight;\r\n            return {\r\n                cardHeight: cardHeight * scaleFactor, cardWidth: cardWidth * scaleFactor\r\n            }\r\n        }\r\n\r\n        return {\r\n            cardHeight, cardWidth\r\n        }\r\n    }\r\n\r\n    const { cardWidth, cardHeight } = get();\r\n\r\n    const horizontalPadding = (availableWidth - cardWidth * 2) / 3;\r\n\r\n    const centerX = (availableWidth - cardWidth) / 2;\r\n    const centerY = (availableHeight - cardHeight) / 2;\r\n    const cardY = centerY + marginY;\r\n\r\n    return [{\r\n        x: marginX + horizontalPadding,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }, {\r\n        x: marginX + cardWidth + horizontalPadding * 2,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }]\r\n}\r\n\r\nfunction alignFactors3(cardsCount: number, viewport: { width: number, height: number }, cardRatio: number) {\r\n    const marginX = 0.01;\r\n    const marginY = 0.01;\r\n\r\n    const screenRatio = viewport.width / viewport.height;\r\n\r\n    const availableWidth = 1 - (marginX * 2);\r\n    const availableHeight = (1 - (marginY * 2));\r\n\r\n    function get() {\r\n        const cardWidth = availableWidth / 2.5;\r\n        const cardHeight = cardWidth / cardRatio * screenRatio;\r\n        const vertPad = (availableHeight - cardHeight * 2);\r\n\r\n        if ((cardHeight * 2) > availableHeight) {\r\n            const scaleFactor = (availableHeight / (cardHeight * 2.2));\r\n            return {\r\n                cardHeight: cardHeight * scaleFactor,\r\n                cardWidth: cardWidth * scaleFactor\r\n            }\r\n        }\r\n\r\n        return {\r\n            cardHeight, cardWidth\r\n        }\r\n    }\r\n\r\n    const { cardWidth, cardHeight } = get();\r\n\r\n    const horizontalPadding = (availableWidth - cardWidth * 2) / 3;\r\n    const vertPad = (availableHeight - cardHeight * 2) / 3;\r\n\r\n    const centerX = (availableWidth - cardWidth) / 2;\r\n    const centerY = (availableHeight / 2 - cardHeight) / 2;\r\n    const cardY = centerY + marginY;\r\n\r\n    const middleX = centerX + marginX;\r\n    const middleY = cardY + cardHeight + vertPad;\r\n\r\n    return [{\r\n        x: marginX + horizontalPadding,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }, {\r\n        x: marginX + cardWidth + horizontalPadding * 2,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }, {\r\n        x: middleX,\r\n        y: middleY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }]\r\n}\r\n\r\nfunction alignFactors4(cardsCount: number, viewport: { width: number, height: number }, cardRatio: number) {\r\n    const marginX = 0.01;\r\n    const marginY = 0.01;\r\n\r\n    const screenRatio = viewport.width / viewport.height;\r\n\r\n    const availableWidth = 1 - (marginX * 2);\r\n    const availableHeight = (1 - (marginY * 2));\r\n\r\n    function get() {\r\n        const cardWidth = availableWidth / 2.5;\r\n        const cardHeight = cardWidth / cardRatio * screenRatio;\r\n\r\n        if ((cardHeight * 2) > availableHeight) {\r\n            const scaleFactor = (availableHeight / (cardHeight * 2.2));\r\n            return {\r\n                cardHeight: cardHeight * scaleFactor,\r\n                cardWidth: cardWidth * scaleFactor\r\n            }\r\n        }\r\n\r\n        return {\r\n            cardHeight, cardWidth\r\n        }\r\n    }\r\n\r\n    const { cardWidth, cardHeight } = get();\r\n\r\n    const horizontalPadding = (availableWidth - cardWidth * 2) / 3;\r\n    const vertPad = (availableHeight - cardHeight * 2) / 3;\r\n\r\n    const centerY = (availableHeight / 2 - cardHeight) / 2;\r\n    const cardY = centerY + marginY;\r\n\r\n    const middleY = cardY + cardHeight + vertPad;\r\n\r\n    return [{\r\n        x: marginX + horizontalPadding,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }, {\r\n        x: marginX + cardWidth + horizontalPadding * 2,\r\n        y: cardY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }, {\r\n        x: marginX + horizontalPadding,\r\n        y: middleY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }, {\r\n        x: marginX + cardWidth + horizontalPadding * 2,\r\n        y: middleY,\r\n        width: cardWidth,\r\n        height: cardHeight\r\n    }]\r\n}\r\n","import { PixiComponent } from '@inlet/react-pixi';\r\nimport { Rectangle } from '../../../../model';\r\nimport * as gsap from 'gsap';\r\nimport { timings } from './timings';\r\nimport * as PIXI from 'pixi.js';\r\n\r\ninterface Props {\r\n    scale: number;\r\n    target: { x: number, y: number, scale: number };\r\n    tex: PIXI.Texture,\r\n    position: Rectangle;\r\n}\r\n\r\nexport const QuarantineCard = PixiComponent<Props, any>('QuarantineCard', {\r\n    create(props) {\r\n        const { scale, target, position } = props;\r\n\r\n        const sprite = PIXI.Sprite.from(props.tex);\r\n        const effectSprite = PIXI.Sprite.from(props.tex);\r\n        effectSprite.alpha = 0;\r\n\r\n        const filter = new PIXI.filters.ColorMatrixFilter();\r\n        filter.greyscale(1.3, false);\r\n        effectSprite.filters = [filter];\r\n\r\n        const container = new PIXI.Container();\r\n        container.position.set(position.x,  position.y);\r\n        container.scale.set(scale, scale);\r\n\r\n        const positionTl = new gsap.TimelineLite()\r\n            .to(container.position, timings.cardRealign,{ x: target.x, y: target.y })\r\n            .to(container.scale, timings.cardRealign, { x: target.scale, y: target.scale }, timings.mod('cardRealign'))\r\n        ;\r\n\r\n        const disTl = new gsap.TimelineLite()\r\n            .to(effectSprite, timings.destruction, { alpha: 0.6 }, timings.mod('destruction'))\r\n            .to(container, timings.destruction, { alpha: 0, ease: gsap.Power3.easeIn }, timings.mod('destruction'))\r\n        ;\r\n\r\n        const masterTl = new gsap.TimelineLite({ paused: true })\r\n            .add(positionTl)\r\n            .add(disTl)\r\n        ;\r\n\r\n        container.addChild(sprite);\r\n        container.addChild(effectSprite);\r\n\r\n        masterTl.play();\r\n        return container;\r\n    }\r\n});\r\n","import React, { Component } from 'react';\r\nimport { Character } from '../../../../data/characters';\r\nimport { PageSizes } from '../../../theme/createTheme';\r\nimport { ModalSizes } from '../mixedMediaModal';\r\nimport { DisappearingCard } from './disapperingCard';\r\nimport CharacterOverlay from './characterOverlay';\r\nimport { Rectangle } from '../../../../model';\r\nimport { ModalMode } from './controller';\r\nimport { WithResources, withResources } from '../../../mapView/loadResources';\r\nimport * as PIXI from 'pixi.js';\r\nimport { alignFactors } from './factorCalculator';\r\nimport { QuarantineCard } from './quarantineCard';\r\n\r\ninterface Props extends WithResources {\r\n    mode: ModalMode;\r\n    selectedCharacter: Character | null;\r\n    allSelectedCharacters: Character[];\r\n    pageSizes: PageSizes;\r\n    sizes: ModalSizes;\r\n    position?: Rectangle;\r\n}\r\n\r\nclass CharacterCard extends Component<Props> {\r\n\r\n    private position: Rectangle | null = null;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.position = props.position || null;\r\n    }\r\n\r\n\r\n    render() {\r\n        if (this.props.mode === 'visible') {\r\n            return <CharacterOverlay\r\n                positionCalculated={ this.onPositionCalculated }\r\n                pageSizes={ this.props.pageSizes }\r\n                sizes={ this.props.sizes }\r\n                selectedCharacter={ this.props.selectedCharacter }\r\n            />\r\n        }\r\n\r\n        if (this.props.mode === 'killed-and-hidden' && this.position && this.props.allSelectedCharacters.length) {\r\n            return this.renderCards();\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    renderCards = () => {\r\n        const { allSelectedCharacters, resources, pageSizes } = this.props;\r\n        const calculatedFactors = alignFactors(allSelectedCharacters.length, {\r\n            width: this.props.pageSizes.viewport.width,\r\n            height: this.props.pageSizes.middle\r\n        }, 0.61);\r\n\r\n        const vw = pageSizes.viewport.width;\r\n        const vh = pageSizes.middle;\r\n\r\n        const arr: React.ReactNode[] = [];\r\n\r\n        for (let i = 0; i < allSelectedCharacters.length; i++) {\r\n            const character = allSelectedCharacters[i];\r\n            const factors = calculatedFactors[i];\r\n            const tex = new PIXI.Texture(resources.characterCards[character.id]);\r\n            const currentScale = this.position!.width / tex.width;\r\n            const target = {\r\n                x: factors.x * vw,\r\n                y: factors.y * vh,\r\n                scale: (factors.height * vh / tex.height)\r\n            };\r\n            if (character.isHealer) {\r\n                arr.push(<QuarantineCard scale={ currentScale }\r\n                                         tex={ tex }\r\n                                         target={ target }\r\n                                         position={ this.position! }\r\n                                         key={ character.id }\r\n                />)\r\n            } else {\r\n                arr.push(<DisappearingCard scale={ currentScale }\r\n                                           tex={ tex }\r\n                                           target={ target }\r\n                                           position={ this.position! }\r\n                                           key={ character.id }\r\n                />)\r\n            }\r\n        }\r\n\r\n        return arr;\r\n    };\r\n\r\n    onPositionCalculated = (p: Rectangle) => this.position = p;\r\n}\r\n\r\nexport default withResources(CharacterCard);\r\n","import { Character } from '../../../../data/characters';\r\nimport SelectCharacterModalContent from './selectCharacterModalContent';\r\nimport BackgroundAnimation from '../crowsAnimation';\r\nimport CharacterCard from './characterCard';\r\nimport React from 'react';\r\nimport { ModalController, ModalProps } from '../modalController';\r\n\r\nexport type ModalMode = 'visible' | 'hidden' | 'killed-and-hidden';\r\n\r\nexport class SelectCharacterModalController implements ModalController {\r\n\r\n    relativeSizes = {\r\n        w: 85,\r\n        h: 32\r\n    };\r\n\r\n    modalMode: ModalMode = 'visible';\r\n\r\n    selectedCharacters: Character[] = [];\r\n    lastChar: Character | null = null;\r\n\r\n    props: ModalProps | null = null;\r\n\r\n    constructor(\r\n        private charChanged: (characters: Character[]) => void\r\n    ) { }\r\n\r\n    setProps = (props: ModalProps) => this.props = props;\r\n\r\n    renderModal = (props: ModalProps) => {\r\n        const { sizes, pageSizes } = props;\r\n\r\n        let modalSizes = {\r\n            bottom: sizes.bottom,\r\n            height: sizes.height,\r\n            left: sizes.left,\r\n            width: sizes.width\r\n        };\r\n        return <SelectCharacterModalContent modalSizes={ modalSizes }\r\n                                            pageSizes={ pageSizes }\r\n                                            mode={ this.modalMode }\r\n                                            onSelectedCharacterChanged={ this.onCharacterChanged }/>;\r\n    };\r\n\r\n    renderBackdrop = (props: ModalProps) => {\r\n        const { sizes, pageSizes } = props;\r\n\r\n        return <>\r\n            { this.renderCharacterOverlay(props) }\r\n            <BackgroundAnimation isVisible={ this.modalMode === 'visible' } rect={ {\r\n                x: sizes.left,\r\n                y: sizes.pixiTop,\r\n                width: sizes.width,\r\n                height: sizes.height\r\n            } } pageSizes={ pageSizes }/>\r\n        </>\r\n    };\r\n\r\n    renderCharacterOverlay = (props: ModalProps) => {\r\n        const { sizes, pageSizes } = props;\r\n        return <CharacterCard allSelectedCharacters={ this.selectedCharacters }\r\n                              selectedCharacter={ this.lastChar }\r\n                              sizes={ sizes }\r\n                              pageSizes={ pageSizes }\r\n                              mode={ this.modalMode }/>;\r\n    };\r\n\r\n    onCharacterChanged = (character: Character | null, allChars: Character[]) => {\r\n        this.selectedCharacters = allChars;\r\n        this.lastChar = character;\r\n        this.props?.update();\r\n        this.charChanged(allChars);\r\n    };\r\n\r\n    contaminate = (characters: Character[]) => {\r\n        if (characters.length) {\r\n            this.modalMode = 'killed-and-hidden';\r\n        } else {\r\n            this.modalMode = 'hidden';\r\n        }\r\n        this.props?.update();\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { Character } from '../../data/characters';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport { strings } from '../locale/strings';\r\nimport Button from '../hud/button/button';\r\nimport { RouteProps, BaseAppState, SimpleTransition } from './appState';\r\nimport { SelectCharacterModalController } from '../hud/modal/selectCharacter/controller';\r\nimport { delay } from '../../utils';\r\nimport { timings } from '../hud/modal/selectCharacter/timings';\r\n\r\ninterface State {\r\n    characters: Character[];\r\n}\r\n\r\ninterface Props {\r\n    onCharactersSelected: (character: Character[]) => void;\r\n    turnNo: number;\r\n    emptyOk: boolean;\r\n    stateText: string;\r\n}\r\n\r\nexport class SelectCharacterState extends BaseAppState<State> {\r\n\r\n    private modalController: SelectCharacterModalController;\r\n\r\n    constructor(routeProps: RouteProps, private props: Props) {\r\n        super(routeProps, {\r\n            characters: []\r\n        });\r\n        this.modalController = new SelectCharacterModalController(this.charChanged);\r\n    }\r\n\r\n    charChanged = (characters: Character[]) => this.setState({ characters });\r\n\r\n    renderProps = (): UiProps => {\r\n        const { characters } = this.state;\r\n        return {\r\n            mainMsg: strings.turnNo({ turn: this.props.turnNo }) + ' - ' + strings.phase({ phase: 2 }),\r\n            msg: `${this.props.stateText}: ${strings.selectCharacter()}`,\r\n            modalController: this.modalController,\r\n            bottomButtons: () => {\r\n                return <Button iconHref={ 'icons/checkmark.png' }\r\n                               isVisible={ this.props.emptyOk || !!characters.length }\r\n                               onClick={ () => this.closeModal(characters) } tooltip={ {\r\n                    id: 't-contaminate',\r\n                    direction: 'top',\r\n                    tooltipHint: strings.contaminate()\r\n                } }/>;\r\n            },\r\n            onMapBottomButtons: () => <Button iconHref={ 'icons/cross.png' } onClick={ this.onClose } tooltip={{\r\n                id: 't-close',\r\n                direction: 'left',\r\n                tooltipHint: strings.close()\r\n            }}/>\r\n        }\r\n    };\r\n\r\n    private onClose = () => {\r\n        this.modalController.contaminate([]);\r\n        this.routeProps.popState(\r\n            new SimpleTransition({ modalController: this.modalController }, delay(timings.birdsFlyOff * 1000))\r\n        )\r\n    };\r\n\r\n    private closeModal = (characters: Character[]) => {\r\n        this.modalController.contaminate(characters);\r\n        this.routeProps.popState(new SimpleTransition(\r\n            {\r\n                modalController: this.modalController\r\n            },\r\n            delay((timings.birdsFlyOff + (characters.length ? timings.destructionTotal : 0)) * 1000))\r\n        );\r\n        if (characters.length || this.props.emptyOk) {\r\n            this.props.onCharactersSelected(characters);\r\n        }\r\n        this.routeProps.update();\r\n    }\r\n}\r\n","import { BaseAppState, RouteProps } from './appState';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport { strings } from '../locale/strings';\r\nimport Button from '../hud/button/button';\r\nimport React from 'react';\r\nimport { MapSnapshot } from '../../model';\r\n\r\ninterface Props {\r\n    onTurnEnd: () => void,\r\n    mapSnapshot: MapSnapshot,\r\n    uiPropsOverride?: UiProps\r\n}\r\n\r\nexport class ConfirmEndOfTurnState extends BaseAppState<{}> {\r\n\r\n    constructor(routeProps: RouteProps, private props: Props) {\r\n        super(routeProps, {});\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n\r\n        return {\r\n            msg: strings.confirmTurnEnd(),\r\n            msgAccented: true,\r\n            bottomButtons: () => (<>\r\n                <Button iconHref={'icons/checkmark.png'} onClick={() => {\r\n                    this.routeProps.popState();\r\n                    this.props.onTurnEnd();\r\n                } } />\r\n                <Button iconHref={'icons/cross.png'} onClick={() => this.routeProps.popState() } />\r\n            </>),\r\n            onMapBottomButtons: () => null,\r\n            mapSnapshot: {\r\n                ...this.props.mapSnapshot,\r\n                grayscale: true\r\n            },\r\n            ...this.props.uiPropsOverride\r\n        };\r\n    }\r\n}\r\n","import React, { Component } from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/styles';\r\nimport classNames from 'classnames';\r\nimport { COLORS } from '../../../mapView/constants';\r\nimport { Character } from '../../../../data/characters';\r\nimport { PageSizes } from '../../../theme/createTheme';\r\nimport ReactHammer from 'react-hammerjs';\r\nimport ModalTitleRow from '../modalTitleRow';\r\nimport SliderIndicator from '../selectCharacter/sliderIndicator';\r\nimport { m12, PlayerEffectItem, sPlusMovement } from '../../../../data/healersEffects';\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    modalSizes: {\r\n        width: number;\r\n        height: number;\r\n        bottom: number;\r\n        left: number\r\n    },\r\n    pageSizes: PageSizes,\r\n    isVisible: boolean,\r\n    selectedEffects: string[],\r\n    itemSelected: (item: PlayerEffectItem) => void\r\n}\r\n\r\ninterface State {\r\n    pageSelected: number;\r\n    itemSelected: number;\r\n    selectedCharacters: Character[];\r\n}\r\n\r\ninterface HealersPage {\r\n    name: string;\r\n    indicatorImage: string;\r\n    items: PlayerEffectItem[];\r\n}\r\n\r\nconst pages: HealersPage[] = [\r\n    {\r\n        name: 'Місії',\r\n        indicatorImage: 'icons/missions.png',\r\n        items: [{\r\n            id: 'm-12',\r\n            name: 'Верхом на крысах',\r\n            image: 'cards/missions/12.jpg',\r\n            type: 'mission'\r\n        }]\r\n    },\r\n    {\r\n        name: 'Штами',\r\n        indicatorImage: 'icons/stamm.png',\r\n        items: [{\r\n            id: 's-plus-movement',\r\n            name: 'Перемещение',\r\n            image: 'cards/stams/bonus_movement.jpg',\r\n            type: 'stam'\r\n        }]\r\n    }\r\n];\r\n\r\n\r\nclass PlayerEffectModalContent extends Component<Props, State> {\r\n\r\n    state: State = {\r\n        pageSelected: 0,\r\n        itemSelected: 0,\r\n        selectedCharacters: []\r\n    };\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        props.itemSelected(pages[0].items[0]);\r\n    }\r\n\r\n    render() {\r\n        const { classes, modalSizes } = this.props;\r\n\r\n        return <div>\r\n            { this.renderOverlay() }\r\n            <ReactHammer onSwipe={ this.onSwipe } options={ {\r\n                recognizers: {\r\n                    swipe: {\r\n                        velocity: 0.6,\r\n                        direction: Hammer.DIRECTION_HORIZONTAL\r\n                    }\r\n                }\r\n            } }>\r\n                <div\r\n                    className={ classNames(classes.wrapper, {\r\n                        [classes.visible]: true\r\n                    }) }\r\n                    style={ {\r\n                        left: modalSizes.left,\r\n                        bottom: modalSizes.bottom,\r\n                        width: modalSizes.width,\r\n                        height: modalSizes.height\r\n                    } }>\r\n\r\n                    <ModalTitleRow text={ pages[this.state.pageSelected].name }/>\r\n\r\n                    { this.renderContainer() }\r\n                    { this.renderSliderIndicatorsRowsContainer() }\r\n                </div>\r\n            </ReactHammer>\r\n        </div>\r\n    }\r\n\r\n    renderContainer = () => {\r\n        const { modalSizes } = this.props;\r\n        const { pageSelected, itemSelected } = this.state;\r\n\r\n        const page = pages[pageSelected];\r\n        const selectedItem = page.items[itemSelected];\r\n        const isOngoing = this.props.selectedEffects.includes(selectedItem.id);\r\n\r\n        return <div style={ {\r\n            width: '95%',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            color: 'white',\r\n            height: modalSizes.height * 0.7,\r\n            textAlign: 'left',\r\n            paddingLeft: '2.5%',\r\n            paddingRight: '2.5%',\r\n            fontSize: '5vw'\r\n        } }>\r\n            { this.renderCardPreview(selectedItem.image, isOngoing) }\r\n            { this.renderItemButtons() }\r\n        </div>\r\n    };\r\n\r\n    renderCardPreview = (href: string, isOngoing: boolean) => <div\r\n        style={ { maxWidth: 'calc(50% - 10px)', paddingRight: 9, height: '100%', display: 'inline-block' } }>\r\n        <img draggable={ false } src={ href } style={ {\r\n            maxWidth: '100%',\r\n            maxHeight: '100%',\r\n            border: isOngoing ? `0.4vh ${ COLORS.charTints[2] } solid` : `0.4vh transparent solid`,\r\n            // boxShadow: isOngoing ? `0px 0px 30px 10px ${ COLORS.charTints[2] }` : 'unset'\r\n        } }/>\r\n    </div>;\r\n\r\n    renderItemButtons = () => {\r\n        const { pageSelected, itemSelected } = this.state;\r\n        const page = pages[pageSelected];\r\n\r\n        return <div onSelect={ () => false }\r\n                    style={ { minWidth: '50%', display: 'inline-block', verticalAlign: 'top' } }>\r\n            { page.items.map((item, i) => this.renderItemButton(item.name, this.props.selectedEffects.includes(item.id), i === itemSelected, i)) }\r\n        </div>\r\n    };\r\n\r\n    renderItemButton = (text: string, isOngoing: boolean, isActive: boolean, index: number) => {\r\n        return <div style={ {\r\n            minHeight: '10vh',\r\n            padding: '1vw',\r\n            lineHeight: '10vh',\r\n            transition: '0.2s linear all',\r\n            background: isActive ? '#ffffff40' : '#ffffff19',\r\n            border: isOngoing ? `0.4vh ${ COLORS.charTints[2] } solid` : `0.4vh transparent solid`,\r\n            // boxShadow: isOngoing ? `0px 0px 3vh 1.7vh ${ COLORS.charTints[2] }` : 'unset',\r\n            textAlign: 'center',\r\n            userSelect: 'none',\r\n            verticalAlign: 'bottom',\r\n            marginBottom: '1vh'\r\n        } } onClick={ () => this.onItemClick(index) }>\r\n            { text }\r\n        </div>;\r\n    };\r\n\r\n    renderSliderIndicatorsRowsContainer = () => {\r\n        const { classes, modalSizes } = this.props;\r\n        const { pageSelected } = this.state;\r\n        const padding = modalSizes.width / 3;\r\n\r\n        return <div className={ classes.sliderIndicatorRow }\r\n                    style={ { width: modalSizes.width - padding * 2, paddingLeft: padding, paddingRight: padding } }>\r\n            { pages.map((p, i) => <SliderIndicator isHealer={ false } isActive={ pageSelected === i }\r\n                                                   onClick={ () => this.onIndicatorClick(i) }>\r\n                <img draggable={ false } src={ p.indicatorImage } style={ { maxWidth: '100%', maxHeight: '100%' } }/>\r\n            </SliderIndicator>) }\r\n        </div>\r\n    };\r\n\r\n    private onItemClick = (index: number) => {\r\n        this.props.itemSelected(pages[this.state.pageSelected].items[index]);\r\n        this.setState({ itemSelected: index })\r\n    };\r\n\r\n    private onIndicatorClick = (index: number) => {\r\n        this.changePage(index);\r\n    };\r\n\r\n    private onSwipe = (ev: HammerInput) => {\r\n        let page = this.state.pageSelected;\r\n        if (ev.velocityX > 0) {\r\n            page--;\r\n            if (page < 0) page = pages.length - 1;\r\n        } else if (ev.velocityX < 0) {\r\n            page++;\r\n            if (page > pages.length - 1) page = 0;\r\n        }\r\n        this.changePage(page);\r\n    };\r\n\r\n    private changePage = (pageSelected: number) => {\r\n        this.props.itemSelected(pages[pageSelected].items[0]);\r\n        this.setState({ pageSelected, itemSelected: 0 });\r\n    }\r\n\r\n    renderOverlay = () => {\r\n        const { classes, pageSizes } = this.props;\r\n\r\n        return <div className={ classNames(classes.overlay) } style={ {\r\n            top: pageSizes.top,\r\n        } }/>;\r\n    };\r\n}\r\n\r\nconst styles = createStyles({\r\n    '@keyframes appear': {\r\n        from: { opacity: 0 },\r\n        to: { opacity: 1 }\r\n    },\r\n    '@keyframes disappear': {\r\n        from: { opacity: 1 },\r\n        to: { opacity: 0 }\r\n    },\r\n    '@keyframes disappearP': {\r\n        from: { opacity: 0.3 },\r\n        to: { opacity: 0 }\r\n    },\r\n    wrapper: {\r\n        position: 'absolute',\r\n        background: 'black',\r\n        zIndex: 101,\r\n        userSelect: 'none',\r\n        opacity: 0,\r\n        transition: '0.3s linear all',\r\n        pointerEvents: 'none'\r\n    },\r\n    visible: {\r\n        animationName: '$appear',\r\n        animationDuration: '0.3s',\r\n        animationDelay: '0.7s',\r\n        animationFillMode: 'forwards',\r\n        opacity: 0,\r\n        pointerEvents: 'all'\r\n    },\r\n\r\n\r\n    sliderIndicatorRow: {\r\n        position: 'absolute',\r\n        bottom: '1vh',\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        height: '3.5vh',\r\n        // paddingLeft: '24vh',\r\n        // paddingRight: '24vh',\r\n    },\r\n\r\n    overlay: {\r\n        position: 'absolute',\r\n        width: '100%',\r\n        height: '100%',\r\n        opacity: 0,\r\n        animationFillMode: 'forwards',\r\n        transition: '0.2s linear all',\r\n        background: 'linear-gradient(90deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 50%, rgba(0,0,0,1) 100%)',\r\n        '&.visible': {\r\n            animationName: '$appear',\r\n            animationDelay: '0.7s',\r\n            animationDuration: '0.3s',\r\n        }\r\n    }\r\n});\r\n\r\nexport default withStyles(styles)(PlayerEffectModalContent);\r\n","import BackgroundAnimation from '../crowsAnimation';\r\nimport React from 'react';\r\nimport { ModalController, ModalProps } from '../modalController';\r\nimport PlayerEffectModalContent from './playerEffectModalContent';\r\nimport { PlayerEffectItem } from '../../../../data/healersEffects';\r\n\r\nexport class PlayerEffectModalController implements ModalController {\r\n\r\n    relativeSizes = {\r\n        w: 85,\r\n        h: 55\r\n    };\r\n\r\n    props: ModalProps | null = null;\r\n    activeEffects: string[] = [];\r\n\r\n    constructor(private onItemChanged: (item: PlayerEffectItem) => void) {\r\n    }\r\n\r\n\r\n    setProps = (props: ModalProps) => this.props = props;\r\n\r\n    renderModal = (props: ModalProps) => {\r\n        const { sizes, pageSizes } = props;\r\n\r\n        let modalSizes = {\r\n            bottom: sizes.bottom,\r\n            height: sizes.height,\r\n            left: sizes.left,\r\n            width: sizes.width\r\n        };\r\n        return <PlayerEffectModalContent isVisible={ true }\r\n                                         pageSizes={ pageSizes }\r\n                                         modalSizes={ modalSizes }\r\n                                         itemSelected={ this.onItemChanged }\r\n                                         selectedEffects={ this.activeEffects }/>;\r\n    };\r\n\r\n    renderBackdrop = (props: ModalProps) => {\r\n        const { sizes, pageSizes } = props;\r\n\r\n        return <>\r\n            <BackgroundAnimation isVisible={ true } rect={ {\r\n                x: sizes.left,\r\n                y: sizes.pixiTop,\r\n                width: sizes.width,\r\n                height: sizes.height\r\n            } } pageSizes={ pageSizes }/>\r\n        </>\r\n    };\r\n}\r\n","import { PageSizes } from '../../theme/createTheme';\r\nimport React from 'react';\r\nimport { ModalSizes } from './mixedMediaModal';\r\n\r\nexport type RelativeSizes = { w: number, h: number };\r\n\r\nexport interface ModalProps {\r\n    sizes: ModalSizes;\r\n    pageSizes: PageSizes;\r\n    update: () => void;\r\n}\r\n\r\nexport interface ModalController {\r\n    relativeSizes: RelativeSizes;\r\n\r\n    setProps(props: ModalProps): void;\r\n\r\n    renderModal(props: ModalProps): React.ReactNode;\r\n\r\n    renderBackdrop(props: ModalProps): React.ReactNode;\r\n}\r\n\r\nexport const NullModalController: ModalController = {\r\n    relativeSizes: {\r\n        w: 0,\r\n        h: 0\r\n    },\r\n    renderBackdrop: () => null,\r\n    renderModal: () => null,\r\n    setProps: () => {}\r\n};\r\n\r\n","import { BaseAppState, RouteProps } from './appState';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport { AreaKey, areaKeys, steppe } from '../../data/areas';\r\nimport { AreaFills, MapSnapshot } from '../../model';\r\nimport { NullModalController } from '../hud/modal/modalController';\r\nimport React from 'react';\r\nimport Button from '../hud/button/button';\r\nimport { areaToLocation, locationToAreaKey, locationToAreaKeys } from '../../utils';\r\nimport connections from '../../data/connections.json';\r\nimport { strings } from '../locale/strings';\r\nimport { GameEngine, WorldState } from '../../core/gameEngine';\r\n\r\ninterface State {\r\n    selectedArea: AreaKey | null;\r\n}\r\n\r\nexport class SelectBonusMovementLocationState extends BaseAppState<State> {\r\n\r\n    private readonly world: WorldState;\r\n\r\n    constructor(routeProps: RouteProps, private game: GameEngine) {\r\n        super(routeProps, {\r\n            selectedArea: null\r\n        });\r\n        this.world = { ...game.state() };\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n        return {\r\n            mapSnapshot: this.getMapSnapshot(),\r\n            mainMsg: strings.additionalMove(),\r\n            msg: this.getMsg(),\r\n            onMapBottomButtons: () =>\r\n                <Button iconHref={ 'icons/cross.png' } onClick={ this.onUndo } tooltip={{\r\n                    id: 't-close',\r\n                    direction: 'left',\r\n                    tooltipHint: strings.cancelAction()\r\n                }}/>,\r\n            modalController: NullModalController,\r\n            bottomButtons: () => <>\r\n                <Button iconHref={ 'icons/checkmark.png' }\r\n                        isActive={ !!this.state.selectedArea }\r\n                        onClick={ this.onAreaConfirmed }/>\r\n            </>,\r\n            onAreaClick: this.areaSelected\r\n        }\r\n    }\r\n\r\n    getMsg = () => {\r\n        if (this.state.selectedArea) {\r\n            const locationNo = areaToLocation(this.state.selectedArea);\r\n            return strings.movementToLocation({ locationNo, location: connections[locationNo].name });\r\n        } else {\r\n            return strings.selectLocation();\r\n        }\r\n    };\r\n\r\n    onUndo = () => {\r\n        this.routeProps.popState();\r\n    };\r\n\r\n    private getAvailableAreas = () => {\r\n        return [...connections[this.world.plagueLocation].connections.flatMap(locationToAreaKeys), ...locationToAreaKeys(this.world.plagueLocation)];\r\n    };\r\n\r\n    private getMapSnapshot = (): MapSnapshot => {\r\n\r\n        const { selectedArea } = this.state;\r\n\r\n        const startingAreas = locationToAreaKeys(this.world.plagueLocation);\r\n        const fills = Object.fromEntries(areaKeys.map(k => ([k, 'disabled']))) as AreaFills;\r\n\r\n        connections[this.world.plagueLocation].connections.forEach(l => {\r\n            locationToAreaKeys(l).forEach(a => fills[a] = 'available')\r\n        });\r\n\r\n        if (selectedArea) {\r\n            startingAreas.forEach(a => fills[a] = 'passed');\r\n            if (steppe.includes(selectedArea)) {\r\n                steppe.forEach(a => fills[a] = 'active');\r\n            } else {\r\n                fills[selectedArea] = 'active';\r\n            }\r\n        } else {\r\n            startingAreas.forEach(a => fills[a] = 'active');\r\n        }\r\n\r\n        return {\r\n            tokens: this.world.inSiege && !this.state.selectedArea\r\n                ? [{ token: 'siege', areaKey: locationToAreaKey(this.world.plagueLocation) }]\r\n                : [],\r\n            fills\r\n        }\r\n    };\r\n\r\n    private areaSelected = (area: AreaKey) => {\r\n        if (!this.getAvailableAreas().includes(area)) {\r\n            return;\r\n        }\r\n        if (this.world.inSiege) {\r\n            this.routeProps.pushMessage(strings.cancelSiegeWarning());\r\n        }\r\n        this.setState({\r\n            selectedArea: area\r\n        })\r\n    };\r\n\r\n    private onAreaConfirmed = () => {\r\n        this.routeProps.popState();\r\n        const location = this.state.selectedArea ? areaToLocation(this.state.selectedArea) : this.world.plagueLocation;\r\n        this.routeProps.pushMessage(strings.movementToLocation({\r\n            locationNo: location,\r\n            location: connections[location].name\r\n        }));\r\n        this.game.pushAction({\r\n            type: 'healers-s-plus-movement',\r\n            to: location\r\n        });\r\n    }\r\n}\r\n","import { PlagueAction } from '../components/appStates/plagueTurnState';\r\n\r\nexport type StartAction = {\r\n    type: 'start',\r\n    location: number\r\n}\r\n\r\nexport type MovementsAction = {\r\n    type: 'movement',\r\n    to: number\r\n};\r\n\r\nexport type ContaminationAction = {\r\n    type: 'contaminate',\r\n    affected: string[]\r\n}\r\n\r\nexport type SiegeStartAction = {\r\n    type: 'siege-start',\r\n    affected: string[]\r\n}\r\n\r\nexport type SiegeEndAction = {\r\n    type: 'siege-end',\r\n    affected: string[]\r\n}\r\n\r\nexport type PlagueTurnEndAction = {\r\n    type: 'end-plague-turn'\r\n}\r\n\r\nexport type HealersMission12 = {\r\n    type: 'healers-m12',\r\n    active: boolean\r\n}\r\n\r\nexport type HealersBonusMovementStam = {\r\n    type: 'healers-s-plus-movement',\r\n    to: number\r\n}\r\n\r\nexport type HealersTurnEndAction = {\r\n    type: 'end-healers-turn'\r\n}\r\n\r\nexport type ControlActions = StartAction\r\n    | PlagueTurnEndAction\r\n    | HealersTurnEndAction;\r\n\r\nexport type PlagueActions = MovementsAction |\r\n    ContaminationAction |\r\n    SiegeStartAction |\r\n    SiegeEndAction;\r\n\r\nexport type HealersActions = HealersMission12 | HealersBonusMovementStam;\r\n\r\nexport type GameAction = ControlActions | PlagueActions | HealersActions;\r\n\r\nexport type GameActionType = GameAction['type'];\r\n\r\nexport type GameActionData<Type extends GameAction> = Omit<Type, 'type'>;\r\n\r\nexport interface TurnState {\r\n    turnNo: number;\r\n    doubleMovement: boolean;\r\n    initialLocation: number;\r\n    inSiege: number;\r\n    turnActions: PlagueAction[];\r\n}\r\n\r\nexport const controlActionTypes: GameActionType[] = ['start', 'end-plague-turn', 'end-healers-turn'];\r\n","import { GameAction } from '../model/actions';\r\nimport { ActionSnapshot, formatter, WorldState } from './gameEngine';\r\nimport _ from 'lodash';\r\n\r\nexport const gameActionReducer = (actions: ActionSnapshot[], action: GameAction, last: ActionSnapshot): ActionSnapshot[] => {\r\n    switch (action.type) {\r\n        case 'start': {\r\n            const world: WorldState = {\r\n                doubleMovement: false,\r\n                initialLocation: action.location,\r\n                plagueLocation: action.location,\r\n                inSiege: null,\r\n                statusMsg: formatter.getStatusMsg(action),\r\n                turnNo: 1\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'contaminate': {\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                inSiege: null,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'movement': {\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                inSiege: null,\r\n                plagueLocation: action.to,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'siege-start': {\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                inSiege: last.world.plagueLocation,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'siege-end': {\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                inSiege: null,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'end-plague-turn':\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n\r\n        case 'healers-m12': {\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                doubleMovement: action.active,\r\n                statusMsg: formatter.getActionName(action)\r\n            };\r\n            const lastSnap = _.last(actions);\r\n            if (lastSnap && lastSnap.action.type === action.type) {\r\n                const penultimateSnap = _.nth(actions, -2);\r\n                if (penultimateSnap && penultimateSnap.world.doubleMovement === action.active) {\r\n                    return actions.slice(0, -1);\r\n                }\r\n                return [...actions.slice(0, -1), { action, world }];\r\n            }\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'healers-s-plus-movement': {\r\n            const moved = action.to != last.world.plagueLocation;\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                plagueLocation: action.to,\r\n                inSiege: moved ? null : last.world.inSiege,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        case 'end-healers-turn': {\r\n            const world: WorldState = {\r\n                ...last.world,\r\n                initialLocation: last.world.plagueLocation,\r\n                turnNo: last.world.turnNo + 1,\r\n                statusMsg: formatter.getStatusMsg(action)\r\n            };\r\n            return [...actions, { action, world }];\r\n        }\r\n\r\n        default:\r\n            console.error('unknown action', action);\r\n            return actions;\r\n    }\r\n}\r\n","import { controlActionTypes, GameAction } from '../model/actions';\r\nimport { strings } from '../components/locale/strings';\r\nimport { allCharacters, Character } from '../data/characters';\r\nimport connections from '../data/connections.json';\r\nimport _ from 'lodash';\r\nimport { PersistenceService } from './persistenceService';\r\nimport { gameActionReducer } from './gameActionReducer';\r\n\r\nexport interface WorldState {\r\n    inSiege: number | null,\r\n    initialLocation: number,\r\n    plagueLocation: number,\r\n    turnNo: number,\r\n    doubleMovement: boolean,\r\n    statusMsg?: string\r\n}\r\n\r\nexport interface ActionSnapshot {\r\n    action: GameAction;\r\n    world: WorldState;\r\n}\r\n\r\nexport const formatter = new class Formatter {\r\n    affectedString(affected: Character[]) {\r\n        if (affected.length > 1) {\r\n            return strings.multipleCharacterKilled({ characters: affected.map(c => c.name).join(', ') });\r\n        }\r\n        const char = affected[0];\r\n        if (char.gender === 0) {\r\n            return strings.characterWoKilled({ char: char.name });\r\n        }\r\n        return strings.characterMaKilled({ char: char.name });\r\n    }\r\n\r\n    getActionName(action: GameAction) {\r\n        switch (action.type) {\r\n            case 'start':\r\n                return strings.startOfGame();\r\n            case 'end-plague-turn':\r\n                return strings.turnEnd();\r\n            case 'end-healers-turn':\r\n                return strings.turnEnd();\r\n            case 'movement':\r\n                return this.getStatusMsg(action);\r\n            case 'contaminate':\r\n                return strings.contaminate();\r\n            case 'siege-start':\r\n                return strings.siegeStarted();\r\n            case 'siege-end':\r\n                return strings.siegeEndSuccessfully();\r\n            case 'healers-m12':\r\n                if (action.active) {\r\n                    return strings.activatedEffect({ effect: strings.effectm12() });\r\n                } else {\r\n                    return strings.canceledEffect({ effect: strings.effectm12() });\r\n                }\r\n            case 'healers-s-plus-movement':\r\n                return strings.effectsPlusMovement();\r\n        }\r\n        return '';\r\n    }\r\n\r\n    getStatusMsg(action: GameAction) {\r\n        switch (action.type) {\r\n            case 'start':\r\n                return strings.startOfGame();\r\n            case 'contaminate': {\r\n                const affected = allCharacters.filter(c => action.affected.includes(c.id));\r\n                return this.affectedString(affected);\r\n            }\r\n            case 'siege-start': {\r\n                const affected = allCharacters.filter(c => action.affected.includes(c.id));\r\n                return affected.length\r\n                    ? strings.siegeStartedKilled({ killed: this.affectedString(affected) })\r\n                    : strings.siegeStarted();\r\n            }\r\n            case 'siege-end': {\r\n                const affected = allCharacters.filter(c => action.affected.includes(c.id));\r\n                return affected.length > 0\r\n                    ? strings.siegeEndedKilled({ killed: this.affectedString(affected) })\r\n                    : strings.siegeEndSuccessfully()\r\n            }\r\n            case 'movement':\r\n            case 'healers-s-plus-movement': {\r\n                return strings.movementToLocation({ locationNo: action.to, location: connections[action.to].name })\r\n            }\r\n            case 'end-plague-turn': {\r\n                return strings.turnEnd();\r\n            }\r\n            case 'end-healers-turn':\r\n                return strings.startOfTurn();\r\n        }\r\n    }\r\n}();\r\n\r\ninterface Props {\r\n    persistenceService?: PersistenceService,\r\n    actions?: ActionSnapshot[]\r\n}\r\n\r\nexport class GameEngine {\r\n\r\n    private actions: ActionSnapshot[];\r\n    private readonly persistenceService: PersistenceService;\r\n\r\n    constructor(props?: Props) {\r\n        (window as any).game = this;\r\n        this.persistenceService = props?.persistenceService ?? new PersistenceService();\r\n        this.actions = props?.actions ?? [];\r\n    }\r\n\r\n    lastActionSnapshot = () => _.last(this.actions)!;\r\n\r\n    state = () => this.lastActionSnapshot().world;\r\n\r\n    lastAction = () => this.lastActionSnapshot().action;\r\n\r\n    pushAction(action: GameAction): WorldState {\r\n        this.actions = gameActionReducer(this.actions, action, this.lastActionSnapshot());\r\n        this.persistenceService.writeAll(this.actions);\r\n        return this.lastActionSnapshot().world;\r\n    }\r\n\r\n    popAction() {\r\n        const popped = this.actions.pop();\r\n        this.persistenceService.writeAll(this.actions);\r\n        return popped;\r\n    }\r\n\r\n    getTurnActions = () => {\r\n        let acc: GameAction[] = [];\r\n        for (let i = this.actions.length - 1; i >= 0; i--) {\r\n            const snapshot = this.actions[i];\r\n            if (!controlActionTypes.includes(snapshot.action.type)) {\r\n                acc.unshift(snapshot.action);\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        return acc;\r\n    }\r\n\r\n    isPlagueTurn = () => {\r\n        const act = _.findLast(this.actions, a => controlActionTypes.includes(a.action.type));\r\n        if (!act) return true;\r\n        const type = act.action.type;\r\n        if (type === 'start' || type === 'end-healers-turn') {\r\n            return true;\r\n        }\r\n        if (type === 'end-plague-turn') {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { BaseAppState, RouteProps } from './appState';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport { MapSnapshot } from '../../model';\r\nimport { strings } from '../locale/strings';\r\nimport { PlayerEffectModalController } from '../hud/modal/selectPlayerEffect/playerEffectModalController';\r\nimport Button from '../hud/button/button';\r\nimport React from 'react';\r\nimport { SelectBonusMovementLocationState } from './selectBonusMovementLocationState';\r\nimport { HealersActions } from '../../model/actions';\r\nimport { formatter, GameEngine } from '../../core/gameEngine';\r\nimport { PlayerEffectItem } from '../../data/healersEffects';\r\nimport { ConfirmEndOfTurnState } from './confirmEndOfTurnState';\r\n\r\ninterface Props {\r\n    mapSnapshot: MapSnapshot;\r\n    game: GameEngine;\r\n}\r\n\r\ninterface State {\r\n    mapSnapshot: MapSnapshot;\r\n    selectedItem: PlayerEffectItem | null;\r\n}\r\n\r\nexport class HealersTurnState extends BaseAppState<State> {\r\n\r\n    private modal: PlayerEffectModalController;\r\n\r\n    constructor(routeProps: RouteProps, private props: Props) {\r\n        super(routeProps, {\r\n            selectedItem: null,\r\n            mapSnapshot: props.mapSnapshot\r\n        });\r\n        this.modal = new PlayerEffectModalController(this.itemSelected);\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n        this.modal.activeEffects = this.props.game.state().doubleMovement ? ['m-12'] : [];\r\n\r\n        return {\r\n            mainMsg: strings.healersTurn(),\r\n            msg: strings.selectHealersEffects(),\r\n            mapSnapshot: this.state.mapSnapshot,\r\n            modalController: this.modal,\r\n            bottomButtons: this.renderBottomButtons,\r\n            onMapBottomButtons: () => <Button isVisible={ !!this.props.game.getTurnActions().length }\r\n                                              tooltip={ {\r\n                                                  direction: 'top',\r\n                                                  tooltipHint: strings.cancelSpecificAction({ action: formatter.getActionName(this.props.game.lastAction()) }),\r\n                                                  id: 'undo-tooltip'\r\n                                              }}\r\n                                              iconHref={ 'icons/undo_button.png' } onClick={ this.onUndo }/>\r\n        }\r\n    }\r\n\r\n    itemSelected = (item: PlayerEffectItem) => this.setState({ selectedItem: item });\r\n\r\n    renderBottomButtons = () => {\r\n        const { selectedItem } = this.state;\r\n        const isDoubleMovementButton = selectedItem?.id === 'm-12';\r\n        const isApply = !isDoubleMovementButton || !this.props.game.state().doubleMovement;\r\n        return <>\r\n            <Button iconHref={ isApply ? 'icons/checkmark.png' : 'icons/cross.png' }\r\n                    isActive={ !!selectedItem }\r\n                    tooltip={ {\r\n                        id: 't-apply',\r\n                        tooltipHint: isApply ? strings.apply() : strings.disable(),\r\n                        direction: 'top'\r\n                    } }\r\n                    onClick={ this.activateItem }/>\r\n            <Button iconHref={ 'icons/done_button.png' }\r\n                    tooltip={ {\r\n                        id: 't-end',\r\n                        tooltipHint: strings.finishTurn(),\r\n                        direction: 'top'\r\n                    } }\r\n                    onClick={ this.onDone }/>\r\n        </>\r\n    };\r\n\r\n    activateItem = () => {\r\n        const item = this.state.selectedItem!;\r\n        const game = this.props.game;\r\n        const gameState = game.state();\r\n\r\n        switch (item.id) {\r\n            case 'm-12':\r\n                const active = !gameState.doubleMovement;\r\n                game.pushAction({\r\n                    type: 'healers-m12',\r\n                    active\r\n                });\r\n                if (active) {\r\n                    this.routeProps.pushMessage(strings.activatedEffect({ effect: item.name }));\r\n                } else {\r\n                    this.routeProps.pushMessage(strings.canceledEffect({ effect: item.name }));\r\n                }\r\n                this.update();\r\n                return;\r\n\r\n            case 's-plus-movement':\r\n                this.routeProps.pushState(new SelectBonusMovementLocationState(this.routeProps, game));\r\n                return;\r\n        }\r\n    };\r\n\r\n    onUndo = () => {\r\n        const { game } = this.props;\r\n        const actions = game.getTurnActions();\r\n        if (!actions.length) return;\r\n        const action = game.popAction()!.action as HealersActions;\r\n        this.routeProps.pushMessage(this.getCanceledActionStr(action));\r\n    };\r\n\r\n    getCanceledActionStr = (action: HealersActions) => {\r\n        switch (action.type) {\r\n            case 'healers-m12':\r\n                if (action.active) {\r\n                    return strings.canceledEffect({ effect: strings.effectm12() });\r\n                } else {\r\n                    return strings.effectm12();\r\n                }\r\n            case 'healers-s-plus-movement':\r\n                return strings.canceledEffect({ effect: strings.effectsPlusMovement() });\r\n        }\r\n    };\r\n\r\n    onDone = () => {\r\n        this.routeProps.pushState(new ConfirmEndOfTurnState(this.routeProps, {\r\n            mapSnapshot: this.state.mapSnapshot,\r\n            onTurnEnd: this.onTurnEndConfirmed,\r\n            uiPropsOverride: {\r\n                modalController: null\r\n            }\r\n        }));\r\n    }\r\n\r\n    onTurnEndConfirmed = () => {\r\n        this.props.game.pushAction({\r\n            type: 'end-healers-turn'\r\n        });\r\n        this.routeProps.popState();\r\n    }\r\n}\r\n","import { UiProps } from '../hud/uiScreen';\r\nimport { strings } from '../locale/strings';\r\nimport { AreaKey, steppe } from '../../data/areas';\r\nimport { areaToLocation, locationToAreaKey, locationToAreaKeys } from '../../utils';\r\nimport connections from '../../data/connections.json';\r\nimport { AreaFill, AreaFills, AreaToken, MapSnapshot } from '../../model';\r\nimport Button from '../hud/button/button';\r\nimport { Character } from '../../data/characters';\r\nimport { BaseAppState, RouteProps } from './appState';\r\nimport React from 'react';\r\nimport { SelectCharacterState } from './selectCharacterState';\r\nimport { ConfirmEndOfTurnState } from './confirmEndOfTurnState';\r\nimport { HealersTurnState } from './healersTurnState';\r\nimport { GameAction, MovementsAction, TurnState } from '../../model/actions';\r\nimport { GameEngine } from '../../core/gameEngine';\r\n\r\nexport interface PlagueAction<Descriptor extends GameAction = GameAction> {\r\n    descriptor: Descriptor;\r\n    snapshot: TurnState;\r\n    msg: string;\r\n}\r\n\r\nexport interface GameState {\r\n    startingLocation: number;\r\n    turns: TurnState[];\r\n}\r\n\r\ninterface State {\r\n    msg: string;\r\n}\r\n\r\nexport class PlagueTurnState extends BaseAppState<State> {\r\n\r\n    constructor(routeProps: RouteProps, private game: GameEngine) {\r\n        super(routeProps, {\r\n            msg: strings.startOfTurn()\r\n        });\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n        const gameState = this.game.state();\r\n        return {\r\n            mainMsg: strings.turnNo({ turn: gameState.turnNo }) + ' - ' + this.getPhaseDescription(),\r\n            mapSnapshot: this.getMapSnapshot(),\r\n            bottomButtons: this.renderButtons,\r\n            msg: gameState.statusMsg,\r\n            onAreaClick: this.onAreaClick,\r\n            onMapBottomButtons: this.renderUndo,\r\n            onMapTopButtons: () => <Button iconHref={ 'icons/double_movement.png' }\r\n                                           isVisible={ gameState.doubleMovement }\r\n                                           tooltip={ {\r\n                                               id: 'd-dmov',\r\n                                               tooltipHint: strings.doubleMovement(),\r\n                                               direction: 'left'\r\n                                           } }/>\r\n        }\r\n    }\r\n\r\n    private getPhaseDescription = () => {\r\n        const turnActions = this.game.getTurnActions();\r\n\r\n        if (!turnActions.length) {\r\n            return strings.phase({ phase: 1 });\r\n        }\r\n        if (this.isInAdditionalMovePhase()) {\r\n            return strings.additionalMove();\r\n        }\r\n        if (turnActions.some(a => a.type === 'siege-end'\r\n            || a.type === 'contaminate'\r\n            || a.type === 'siege-start')) {\r\n            return strings.phase({ phase: 3 });\r\n        }\r\n\r\n        if (this.game.state().doubleMovement) {\r\n            const movements = this.getMovements().length;\r\n            if (movements === 1) {\r\n                return strings.phase({ phase: '1-2' });\r\n            }\r\n        }\r\n        return strings.phase({ phase: 2 });\r\n    };\r\n\r\n    private renderUndo = () => !!this.game.getTurnActions().length\r\n        ? <Button iconHref={ 'icons/undo_button.png' } onClick={ this.onUndo } tooltip={{\r\n            direction: 'left',\r\n            tooltipHint: strings.cancelAction(),\r\n            id: 't-cancel'\r\n        }}/>\r\n        : null;\r\n\r\n    private renderButtons = () => {\r\n        return <>\r\n            <Button iconHref={ 'icons/contaminate_button.png' }\r\n                    isActive={ !this.checkContaminate() }\r\n                    onClick={ this.onContaminate }\r\n                    tooltip={ {\r\n                        id: 't-contaminate',\r\n                        tooltipHint: strings.contaminate(),\r\n                        direction: 'top'\r\n                    } }/>\r\n            <Button iconHref={ 'icons/done_button.png' }\r\n                    onClick={ this.onTurnEnd }\r\n                    tooltip={ {\r\n                        id: 't-end',\r\n                        tooltipHint: strings.finishTurn(),\r\n                        direction: 'top'\r\n                    } }/>\r\n            <Button iconHref={ 'icons/siege_button.png' }\r\n                    isActive={ !this.checkSiege() }\r\n                    onClick={ this.onSiege }\r\n                    tooltip={ {\r\n                        id: 't-siege',\r\n                        tooltipHint: this.game.state().inSiege ? strings.finishSiege() : strings.startSiege(),\r\n                        direction: 'top'\r\n                    } }\r\n            />\r\n        </>\r\n    };\r\n\r\n    private onAreaClick = (areaKey: AreaKey) => {\r\n        const turn = this.game.state();\r\n        const location = areaToLocation(areaKey);\r\n        const canMove = this.checkCanMove(location);\r\n        if (!canMove) return;\r\n\r\n        const wasInSiege = !!turn.inSiege;\r\n        this.game.pushAction({\r\n            type: 'movement',\r\n            to: location\r\n        });\r\n        this.update();\r\n        if (wasInSiege) {\r\n            this.pushMessage(strings.siegeCancelledCauseMovement());\r\n        }\r\n    };\r\n\r\n    private checkContaminate = () => {\r\n        const turnActions = this.game.getTurnActions();\r\n        if (turnActions.some(a => a.type === 'contaminate')) {\r\n            return strings.cannotContaminateTwice();\r\n        } else if (turnActions.some(a => a.type === 'siege-start' || a.type === 'siege-end')) {\r\n            return strings.cannotContaminateCauseSiege();\r\n        }\r\n        return '';\r\n    };\r\n\r\n    private onContaminate = () => {\r\n        const errorMsg = this.checkContaminate();\r\n        if (errorMsg) {\r\n            this.pushMessage(errorMsg);\r\n            return;\r\n        }\r\n\r\n        this.routeProps.pushState(new SelectCharacterState(this.routeProps, {\r\n            onCharactersSelected: this.onContaminatedCharacterSelected,\r\n            emptyOk: false,\r\n            turnNo: this.game.state().turnNo,\r\n            stateText: strings.contaminate()\r\n        }));\r\n    };\r\n\r\n    private onContaminatedCharacterSelected = (characters: Character[]) => {\r\n        this.game.pushAction({\r\n            type: 'contaminate',\r\n            affected: characters.map(c => c.id)\r\n        });\r\n        this.update();\r\n    };\r\n\r\n    private onTurnEnd = () => {\r\n        this.routeProps.pushState(new ConfirmEndOfTurnState(this.routeProps, {\r\n            mapSnapshot: this.getMapSnapshot(),\r\n            onTurnEnd: this.onTurnEndConfirm\r\n        }));\r\n    };\r\n\r\n    private onTurnEndConfirm = () => {\r\n        this.game.pushAction({\r\n            type: 'end-plague-turn'\r\n        });\r\n        this.routeProps.pushState(new HealersTurnState(this.routeProps, {\r\n            mapSnapshot: this.getMapSnapshot(),\r\n            game: this.game\r\n        }));\r\n    };\r\n\r\n    private checkSiege = () => {\r\n        const turnState = this.game.state();\r\n        const turnActions = this.game.getTurnActions();\r\n        const { inSiege } = turnState;\r\n        const currentLocation = this.getCurrentLocation();\r\n\r\n        if (inSiege) {\r\n            const startedThisTurn = turnActions.some(a => a.type === 'siege-start');\r\n            if (startedThisTurn) {\r\n                return strings.cannotEndSiegeOnSameTurn();\r\n            }\r\n\r\n            const actionsWereDone = !!turnActions.length;\r\n            // shouldn't occur\r\n            const inDifferentLocation = inSiege !== currentLocation;\r\n            if (actionsWereDone || inDifferentLocation) {\r\n                return strings.cannotEndSiege()\r\n            }\r\n        } else {\r\n            const endedThisTurn = turnActions.some(a => a.type === 'siege-end');\r\n            if (endedThisTurn) {\r\n                return strings.cannotStartSiegeCauseSiege();\r\n            }\r\n\r\n            const isMoved = !!this.getMovements().length;\r\n            if (isMoved) {\r\n                return strings.cannotStartSiegeCauseMovements();\r\n            }\r\n\r\n            const didContamination = turnActions.some(a => a.type === 'contaminate');\r\n            if (didContamination) {\r\n                return strings.cannotStartSiegeCauseContamination();\r\n            }\r\n        }\r\n\r\n        return '';\r\n    };\r\n\r\n    private onSiege = () => {\r\n        const turn = this.game.state();\r\n        const { inSiege } = turn;\r\n        const errorMsg = this.checkSiege();\r\n        if (errorMsg) {\r\n            this.pushMessage(errorMsg);\r\n            return;\r\n        }\r\n\r\n        if (inSiege) {\r\n            // End siege\r\n            this.routeProps.pushState(new SelectCharacterState(this.routeProps, {\r\n                onCharactersSelected: this.onCharactersSieged,\r\n                emptyOk: true,\r\n                turnNo: turn.turnNo,\r\n                stateText: strings.finishSiege()\r\n            }));\r\n        } else {\r\n            // Start siege\r\n            this.routeProps.pushState(new SelectCharacterState(this.routeProps, {\r\n                onCharactersSelected: this.onSiegeStarted,\r\n                emptyOk: true,\r\n                turnNo: turn.turnNo,\r\n                stateText: strings.startSiege()\r\n            }));\r\n        }\r\n    };\r\n\r\n    private onSiegeStarted = (characters: Character[]) => {\r\n        this.game.pushAction({\r\n            type: 'siege-start',\r\n            affected: characters.map(c => c.id)\r\n        });\r\n        this.update();\r\n    };\r\n\r\n    private onCharactersSieged = (characters: Character[]) => {\r\n        this.game.pushAction({\r\n            type: 'siege-end',\r\n            affected: characters.map(c => c.id)\r\n        });\r\n        this.update();\r\n    };\r\n\r\n    private onUndo = () => {\r\n        if (!this.game.getTurnActions().length) {\r\n            return;\r\n        }\r\n        this.game.popAction();\r\n        this.update();\r\n    };\r\n\r\n    getMapSnapshot = (): MapSnapshot => {\r\n        const snap = {\r\n            fills: this.getAreaFills(),\r\n            tokens: this.getTokens()\r\n        };\r\n        return snap;\r\n    };\r\n\r\n    private getAreaFills = (): AreaFills => {\r\n        const currentLocation = this.getCurrentLocation();\r\n        const ar: Partial<AreaFills> = {};\r\n\r\n        const setLocation = (loc: number, fill: AreaFill) => {\r\n            if (loc === 0) {\r\n                for (let st of steppe) {\r\n                    ar[st] = fill;\r\n                }\r\n            } else {\r\n                ar[locationToAreaKey(loc)] = fill;\r\n            }\r\n        };\r\n\r\n        for (let i = 0; i <= 15; i++) {\r\n            const isAvailable = this.checkCanMove(i);\r\n            const isPassed = this.isLocationPassed(i);\r\n            const isActive = i === currentLocation;\r\n\r\n            const fill = this.getFill(isAvailable, isPassed, isActive);\r\n\r\n            setLocation(i, fill);\r\n        }\r\n\r\n        return ar as AreaFills;\r\n    };\r\n\r\n    private getTokens = (): AreaToken[] => {\r\n        const turn = this.game.state();\r\n        if (turn.inSiege) {\r\n            return locationToAreaKeys(turn.inSiege).map(areaKey => ({\r\n                areaKey,\r\n                token: 'siege'\r\n            }));\r\n        }\r\n        return [];\r\n    };\r\n\r\n    private checkCanMove = (location: number) => {\r\n        const turn = this.game.state();\r\n        const turnActions = this.game.getTurnActions();\r\n        const { doubleMovement } = turn;\r\n\r\n        // is connected\r\n        const currentLocation = this.getCurrentLocation();\r\n        const isConnected = connections.find(con => con.number === currentLocation)!\r\n            .connections.indexOf(location) >= 0;\r\n\r\n        if (!isConnected) return false;\r\n\r\n        // no actions performed this turn\r\n        if (!turnActions.length) {\r\n            return true;\r\n        }\r\n\r\n        // is additional turn\r\n        if (this.isInAdditionalMovePhase()) return true;\r\n\r\n        // additional turn used\r\n        const phase2ActionIndex = turnActions.findIndex(a => a.type === 'siege-end'\r\n            || a.type === 'contaminate'\r\n            || a.type === 'siege-start');\r\n        if (phase2ActionIndex > -1 && phase2ActionIndex < turnActions.length - 1) {\r\n            return false;\r\n        }\r\n\r\n        // can move\r\n        const movements = this.getMovements();\r\n        if (movements.length > 0) {\r\n            if (!doubleMovement) return false;\r\n            return movements.length < 2;\r\n        }\r\n\r\n        if (turn.inSiege) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    private isInAdditionalMovePhase = () => {\r\n        const lastAction = this.game.lastAction();\r\n\r\n        // is additional turn\r\n        if (lastAction.type === 'siege-end'\r\n            || lastAction.type === 'contaminate'\r\n            || lastAction.type === 'siege-start'\r\n        ) {\r\n            return !!lastAction.affected.length;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    private pushMessage = (msg: string) => {\r\n        this.routeProps.pushMessage(msg);\r\n        // this.setState({ msg });\r\n    };\r\n\r\n    // TODO: optimize\r\n    private getMovements = () => this.game.getTurnActions().filter(a => a.type === 'movement') as MovementsAction[];\r\n\r\n    private isLocationPassed = (location: number) => {\r\n        const movements = this.getMovements();\r\n        const { initialLocation } = this.game.state();\r\n        if (movements.length > 0) {\r\n            return initialLocation === location || movements.some(m => m.to === location);\r\n        }\r\n        return false;\r\n    };\r\n\r\n    private getCurrentLocation = () => {\r\n        const { initialLocation } = this.game.state();\r\n        const movements = this.getMovements();\r\n        return movements.length ? movements[movements.length - 1].to : initialLocation;\r\n    };\r\n\r\n    private getFill = (isAvailable: boolean, isPassed: boolean, isActive: boolean): AreaFill => {\r\n        if (isActive) return 'active';\r\n        if (isPassed) {\r\n            if (isAvailable) return 'passed-available';\r\n            return 'passed';\r\n        }\r\n        if (isAvailable) {\r\n            return 'available';\r\n        }\r\n        return 'disabled';\r\n    };\r\n}\r\n","import { BaseAppState, RouteProps } from './appState';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport { AreaKey, areaKeys, steppe } from '../../data/areas';\r\nimport { AreaFills } from '../../model';\r\nimport { areaToLocation } from '../../utils';\r\nimport connections from '../../data/connections.json';\r\nimport { strings } from '../locale/strings';\r\nimport Button from '../hud/button/button';\r\nimport React from 'react';\r\nimport { PlagueTurnState } from './plagueTurnState';\r\nimport { GameEngine } from '../../core/gameEngine';\r\n\r\ninterface State {\r\n    selectedArea: AreaKey | null;\r\n}\r\n\r\nexport class SelectStartingAreaState extends BaseAppState<State> {\r\n\r\n    constructor(routeProps: RouteProps, private game: GameEngine = new GameEngine()) {\r\n        super(routeProps, {\r\n            selectedArea: null\r\n        });\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n        return {\r\n            msg: this.getMsg(),\r\n            mainMsg: strings.startOfGame(),\r\n            mapSnapshot: {\r\n                fills: this.getFills(),\r\n                tokens: []\r\n            },\r\n            onAreaClick: (area) => {\r\n                this.setState({ selectedArea: area });\r\n            },\r\n            bottomButtons: () => <>\r\n                <Button iconHref={ 'icons/checkmark.png' } onClick={ this.onSelected }\r\n                        isVisible={ !!this.state.selectedArea } tooltip={ {\r\n                    id: 't-start',\r\n                    tooltipHint: strings.startOfGame(),\r\n                    direction: 'top'\r\n                } }/>\r\n            </>\r\n        }\r\n    }\r\n\r\n    onSelected = () => {\r\n        this.routeProps.popState();\r\n        this.game.pushAction({ type: 'start', location: areaToLocation(this.state.selectedArea!) });\r\n        this.routeProps.pushState(new PlagueTurnState(this.routeProps, this.game));\r\n    };\r\n\r\n    getMsg = () => {\r\n        if (!this.state.selectedArea) {\r\n            return strings.selectAreaToStartFrom();\r\n        }\r\n        const location = areaToLocation(this.state.selectedArea);\r\n        const name = connections[location].name;\r\n        return strings.startingLocation({ locationNo: location, location: name });\r\n    };\r\n\r\n    getFills = (): AreaFills => {\r\n        const fills = Object.fromEntries(areaKeys.map(key => ([key, 'available']))) as AreaFills;\r\n        if (!this.state.selectedArea) {\r\n            return fills;\r\n        }\r\n        if (steppe.includes(this.state.selectedArea)) {\r\n            steppe.forEach(k => fills[k] = 'active');\r\n        } else {\r\n            fills[this.state.selectedArea] = 'active';\r\n        }\r\n        return fills;\r\n    }\r\n\r\n}\r\n","import { allCharacters } from '../data/characters';\r\nimport { GameAction, GameActionType } from '../model/actions';\r\nimport { inDebug } from '../debug';\r\n\r\nexport type ActionType = GameAction['type'];\r\n\r\ntype Position = { pointer: number };\r\n\r\nconst actionIds: { [key in ActionType]: number } = {\r\n    start: 1,\r\n    movement: 2,\r\n    contaminate: 3,\r\n    'siege-start': 4,\r\n    'siege-end': 5,\r\n    'end-plague-turn': 6,\r\n    'healers-m12': 7,\r\n    'healers-s-plus-movement': 8,\r\n    'end-healers-turn': 9,\r\n    // 14 max\r\n};\r\n\r\nconst actionTypes: { [key: number]: ActionType } = Object.fromEntries(Object.entries(actionIds)\r\n    .map(([key, idx]) => [idx, key])) as any;\r\n\r\nconst bits = (val: number | boolean, pad: number) => {\r\n    val = typeof val == 'boolean'\r\n        ? val ? 1 : 0\r\n        : val;\r\n    return (val >>> 0).toString(2).padStart(pad, '0');\r\n}\r\n\r\nconst parseBits = (bits: string, position: { pointer: number }, len: number) => {\r\n    var value = bits.substr(position.pointer, len);\r\n    const v = parseInt(value, 2);\r\n    position.pointer += len;\r\n    return v;\r\n}\r\n\r\nconst alph = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+-';\r\nexport const toB64 = (bitString: string) => {\r\n    let acc = '';\r\n    if (bitString.length % 6 > 0) {\r\n        bitString = bitString + '0'.repeat(bitString.length % 6)\r\n    }\r\n    for (let idx = 0; idx < bitString.length; idx += 6) {\r\n        const strPart = bitString.substr(idx, 6);\r\n        const paddedPart = strPart.padStart(6, '0');\r\n        const part = parseInt(paddedPart, 2);\r\n        acc += alph[part];\r\n    }\r\n    return acc;\r\n};\r\nexport const fromB64 = (b64: string) => {\r\n    let acc = '';\r\n    for (let c of b64) {\r\n        const part = alph.indexOf(c).toString(2);\r\n        const padded = part.padStart(6, '0');\r\n        acc += padded;\r\n    }\r\n    return acc;\r\n};\r\n\r\n\r\nclass GameActionsUrlSerializer {\r\n    private version = 1;\r\n\r\n    serialize(actions: GameAction[]) {\r\n        let acc = bits(this.version, 2);\r\n        const actionStrs = actions.map(this.serializeAction);\r\n        acc += actionStrs.join('') + '0000';\r\n        const b64 = toB64(acc);\r\n\r\n        return b64;\r\n    }\r\n\r\n    deserialize(data: string): GameAction[] {\r\n        let bits = fromB64(data);\r\n        let position = { pointer: 0 };\r\n        const version = parseBits(bits, position, 2);\r\n        let actions: GameAction[] = [];\r\n        while (position.pointer < bits.length) {\r\n            const actionType = this.deserializeActionType(bits, position);\r\n            if (!actionType) {\r\n                break;\r\n            }\r\n            const action = this.deserializeAction(actionType, bits, position);\r\n            actions.push(action);\r\n        }\r\n        return actions;\r\n    }\r\n\r\n    deserializeActionType = (bits: string, position: Position): GameActionType | null => {\r\n        const typeNo  = parseBits(bits, position, 4);\r\n        if (!typeNo) {\r\n            return null;\r\n        }\r\n        return actionTypes[typeNo];\r\n    };\r\n\r\n    deserializeAction = (type: GameActionType, bits: string, position: Position): GameAction => {\r\n        switch (type) {\r\n            case 'siege-end':\r\n            case 'siege-start':\r\n            case 'contaminate':\r\n                const affectedCount = parseBits(bits, position, 4);\r\n                let affected: string[] = [];\r\n                for (let affectedIdx = 0; affectedIdx < affectedCount; affectedIdx++) {\r\n                    affected.push(this.deserializeChar(parseBits(bits, position, 4)).id);\r\n                }\r\n                return {\r\n                    type,\r\n                    affected\r\n                };\r\n            case 'healers-m12':\r\n                return {\r\n                    type,\r\n                    active: !!parseBits(bits, position, 1)\r\n                };\r\n            case 'movement':\r\n                return {\r\n                    type,\r\n                    to: parseBits(bits, position, 4)\r\n                };\r\n            case 'start':\r\n                return {\r\n                    type,\r\n                    location: parseBits(bits, position, 4)\r\n                };\r\n            case 'healers-s-plus-movement':\r\n                return {\r\n                    type,\r\n                    to: parseBits(bits, position, 4)\r\n                };\r\n            case 'end-healers-turn':\r\n            case 'end-plague-turn':\r\n                return { type };\r\n        }\r\n        console.error('Unknown type', type);\r\n        return { type };\r\n    };\r\n\r\n    serializeAction = (action: GameAction) => {\r\n        let acc = bits(actionIds[action.type], 4);\r\n        switch (action.type) {\r\n            case 'start':\r\n                acc += bits(action.location, 4);\r\n                break;\r\n\r\n            case 'contaminate':\r\n            case 'siege-end':\r\n            case 'siege-start':\r\n                const affected = action.affected;\r\n                acc += bits(affected.length, 4)\r\n                    + affected.map(this.serializeChar).join('');\r\n                break;\r\n\r\n            case 'movement':\r\n            case 'healers-s-plus-movement':\r\n                acc += bits(action.to, 4);\r\n                break;\r\n\r\n            case 'healers-m12':\r\n                acc += bits(action.active, 1);\r\n                break;\r\n        }\r\n        return acc;\r\n    };\r\n\r\n    serializeChar(id: string) {\r\n        const charIndex = allCharacters.findIndex(c => c.id === id);\r\n        if (charIndex < 0) {\r\n            throw Error(id);\r\n        }\r\n        return bits(charIndex, 4);\r\n    }\r\n\r\n    deserializeChar(idx: number) {\r\n        return allCharacters[idx];\r\n    }\r\n}\r\n\r\nexport const urlSerializer = new GameActionsUrlSerializer();\r\n// @ts-ignore\r\ninDebug( () => window['urlSerialier'] = urlSerializer );\r\n","import { createStyles, withStyles, WithStyles } from '@material-ui/styles';\r\nimport { timings } from './selectCharacter/timings';\r\nimport { PageSizes } from '../../theme/createTheme';\r\nimport classNames from 'classnames';\r\nimport React from 'react';\r\nimport { ModalMode } from './selectCharacter/controller';\r\n\r\ninterface Props extends WithStyles<typeof styles> {\r\n    pageSizes: PageSizes;\r\n    mode: ModalMode;\r\n}\r\n\r\nconst ModalOverlay = (props: Props) => {\r\n    const { classes, pageSizes, mode } = props;\r\n\r\n    return <div className={ classNames(classes.overlay, {\r\n        visible: mode === 'visible',\r\n        kill: mode === 'killed-and-hidden',\r\n        hidden: mode === 'hidden'\r\n    }) } style={ {\r\n        top: pageSizes.top,\r\n    } }/>;\r\n};\r\n\r\nconst styles = createStyles({\r\n    '@keyframes appear': {\r\n        from: { opacity: 0 },\r\n        to: { opacity: 1 }\r\n    },\r\n    '@keyframes disappear': {\r\n        from: { opacity: 1 },\r\n        to: { opacity: 0 }\r\n    },\r\n    '@keyframes disappearP': {\r\n        from: { opacity: 0.3 },\r\n        to: { opacity: 0 }\r\n    },\r\n    overlay: {\r\n        position: 'absolute',\r\n        width: '100%',\r\n        height: '100%',\r\n        opacity: 0,\r\n        animationFillMode: 'forwards',\r\n        transition: '0.2s linear all',\r\n        background: 'linear-gradient(90deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 50%, rgba(0,0,0,1) 100%)',\r\n        '&.visible': {\r\n            animationName: '$appear',\r\n            animationDelay: '0.7s',\r\n            animationDuration: '0.3s',\r\n        },\r\n        '&.kill': {\r\n            opacity: 0.3,\r\n            animationName: '$disappearP',\r\n            animationDelay: `${ timings.destructionTotal - 0.3 }s`,\r\n            animationDuration: '0.3s',\r\n        },\r\n        '&.hidden': {\r\n            opacity: 1,\r\n            animationName: '$disappear',\r\n            animationDuration: '0.3s',\r\n        }\r\n    }\r\n});\r\n\r\nexport default withStyles(styles)(ModalOverlay)\r\n","import { ModalController, ModalProps, RelativeSizes } from './modalController';\r\nimport CharacterCard from './selectCharacter/characterCard';\r\nimport React from 'react';\r\nimport { Character } from '../../../data/characters';\r\nimport ModalOverlay from './modalOverlay';\r\nimport { timings } from './selectCharacter/timings';\r\n\r\nexport class KilledCharactersModalController implements ModalController {\r\n    relativeSizes = {\r\n        w: 85,\r\n        h: 32\r\n    };\r\n\r\n    private disposed = false;\r\n    private props: ModalProps | null = null;\r\n\r\n    constructor(private characters: Character[]) {\r\n        // setTimeout(this.destructionEnd, timings.destructionTotal * 1000);\r\n        setTimeout(this.disposeEnd, (timings.destructionTotal + 1) * 1000);\r\n    }\r\n\r\n    disposeEnd = () => {\r\n        if (!this.props) {\r\n            return;\r\n        }\r\n        this.disposed = true;\r\n        this.props.update();\r\n    };\r\n\r\n    renderBackdrop(props: ModalProps) {\r\n        if (this.disposed) {\r\n            return null;\r\n        }\r\n\r\n        const { sizes, pageSizes } = props;\r\n        return <CharacterCard allSelectedCharacters={ this.characters }\r\n                              selectedCharacter={ this.characters[0] }\r\n                              sizes={ sizes }\r\n                              pageSizes={ pageSizes }\r\n                              position={ {\r\n                                  x: 0,\r\n                                  y: 0,\r\n                                  height: 10,\r\n                                  width: 10\r\n                              } }\r\n                              mode={ 'killed-and-hidden' }/>\r\n    }\r\n\r\n    renderModal(props: ModalProps) {\r\n        if (this.disposed) {\r\n            return null;\r\n        }\r\n        return <ModalOverlay pageSizes={ props.pageSizes } mode={ 'killed-and-hidden' }/>\r\n    }\r\n\r\n    setProps(props: ModalProps): void {\r\n        this.props = props;\r\n    }\r\n\r\n}\r\n","import { UiProps } from '../../hud/uiScreen';\r\nimport React from 'react';\r\nimport { BaseAppState, RouteProps } from '../appState';\r\nimport { strings } from '../../locale/strings';\r\nimport { PersistenceService } from '../../../core/persistenceService';\r\nimport { SelectStartingAreaState } from '../selectStartingAreaState';\r\nimport Button from '../../hud/button/button';\r\nimport { urlSerializer } from '../../../core/gameActionsUrlSerializer';\r\nimport { RestoreAppState } from '../restoreAppState';\r\n\r\nexport class MenuState extends BaseAppState<{}> {\r\n\r\n    constructor(routeProps: RouteProps, private persistenceService: PersistenceService) {\r\n        super(routeProps, {});\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n        return {\r\n            customComponent: pageSizes => {\r\n                return this.renderMenuModal();\r\n            }\r\n        }\r\n    }\r\n\r\n    renderMenuModal = () => {\r\n        return <div style={ {\r\n            position: 'absolute',\r\n            zIndex: 300,\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundColor: '#00000066'\r\n        } }>\r\n            <div style={ {\r\n                position: 'absolute',\r\n                width: '50vmax',\r\n                height: '70vh',\r\n                backgroundColor: '#000000',\r\n                border: '1px solid red',\r\n                left: 'calc(50% - 25vmax)',\r\n                top: '17.5vh',\r\n            } }>\r\n                <div style={{\r\n                    // marginBottom: '2vh',\r\n                    display: 'flex',\r\n                    justifyContent: 'flex-end'\r\n                }}>\r\n                    <Button iconHref={'icons/cross.png'}\r\n                            onClick={() => this.routeProps.popState()}\r\n                            styles={{ padding: '1vh' }}\r\n                    />\r\n                </div>\r\n\r\n                <div onClick={ this.onNewGame } style={ {\r\n                    color: 'white',\r\n                    fontSize: '6vh',\r\n                    paddingTop: '2vh'\r\n                } }>{ strings.startNew() }</div>\r\n                <div onClick={ this.onSaveGameReplay } style={ {\r\n                    color: 'white',\r\n                    fontSize: '6vh',\r\n                    paddingTop: '2vh'\r\n                } }>{ strings.saveGameReplay() }</div>\r\n                <div onClick={ this.onReturnToGame } style={ {\r\n                    color: 'white',\r\n                    fontSize: '6vh',\r\n                    paddingTop: '2vh'\r\n                } }>{ strings.returnToGame() }</div>\r\n\r\n                {/*<div onClick={ this.onNewGame } style={ {*/}\r\n                {/*    color: 'white',*/}\r\n                {/*    fontSize: '6vh',*/}\r\n                {/*    paddingTop: '1vh'*/}\r\n                {/*} }>{ strings.restoreLastGame() }</div>*/}\r\n            </div>\r\n        </div>\r\n    };\r\n\r\n    onNewGame = () => {\r\n        this.persistenceService.writeAll([]);\r\n        this.routeProps.clearAll();\r\n        const url = new URLSearchParams(document.location.search);\r\n        url.delete('r');\r\n        var newurl = window.location.protocol + \"//\" + window.location.host + window.location.pathname + '?' + url.toString();\r\n        window.history.replaceState(null, '', newurl);\r\n        setTimeout(() => this.routeProps.pushState(new SelectStartingAreaState(this.routeProps)), 0);\r\n    }\r\n\r\n    onSaveGameReplay = async () => {\r\n        const url = new URLSearchParams('');\r\n        const actions = await this.persistenceService.getAll();\r\n        if (!actions) {\r\n            return;\r\n        }\r\n        url.append('r', urlSerializer.serialize(actions.map(a => a.action)));\r\n\r\n        var newurl = window.location.protocol + \"//\" + window.location.host + window.location.pathname + '?' + url.toString();\r\n        prompt('', newurl);\r\n    }\r\n\r\n    onReturnToGame = () => {\r\n        this.routeProps.clearAll();\r\n        const url = new URLSearchParams(document.location.search);\r\n        url.delete('r');\r\n        var newurl = window.location.protocol + \"//\" + window.location.host + window.location.pathname + '?' + url.toString();\r\n        window.history.replaceState(null, '', newurl);\r\n        setTimeout(() => this.routeProps.pushState(new RestoreAppState(this.routeProps)), 0);\r\n    }\r\n}\r\n\r\n\r\n\r\n","import { BaseAppState, RouteProps } from './appState';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport Button from '../hud/button/button';\r\nimport React from 'react';\r\nimport { AreaKey, areaKeys } from '../../data/areas';\r\nimport { AreaFills, AreaToken } from '../../model';\r\nimport { locationToAreaKey, locationToAreaKeys } from '../../utils';\r\nimport { strings } from '../locale/strings';\r\nimport { allCharacters } from '../../data/characters';\r\nimport { ModalController, NullModalController } from '../hud/modal/modalController';\r\nimport { KilledCharactersModalController } from '../hud/modal/killedCharactersModalController';\r\nimport { controlActionTypes, GameAction, GameActionType } from '../../model/actions';\r\nimport { ActionSnapshot } from '../../core/gameEngine';\r\nimport { gameActionReducer } from '../../core/gameActionReducer';\r\nimport _ from 'lodash';\r\nimport { inDebug } from '../../debug';\r\nimport { PageSizes } from '../theme/createTheme';\r\nimport Slider from 'rc-slider';\r\nimport 'rc-slider/assets/index.css';\r\nimport 'rc-tooltip/assets/bootstrap.css';\r\nimport { calcCss } from '../../utils/sizeCss';\r\nimport { MenuState } from './menu/menuState';\r\nimport { PersistenceService } from '../../core/persistenceService';\r\n\r\ninterface State {\r\n    modal: ModalController | null;\r\n    isPlaying: boolean;\r\n}\r\n\r\nlet debug_obj = {\r\n    currentAction: ''\r\n};\r\ninDebug((gui) => {\r\n    const folder = gui.addFolder('replay');\r\n    folder.add(debug_obj, 'currentAction').listen();\r\n    folder.open();\r\n});\r\n\r\nclass ActionsIterator {\r\n    index = 0;\r\n    actions: ActionSnapshot[] = [];\r\n\r\n    constructor(gameActions: GameAction[]) {\r\n        for (let gAction of gameActions) {\r\n            this.actions = gameActionReducer(this.actions, gAction, _.last(this.actions)!)\r\n        }\r\n    }\r\n\r\n    precedingInSameTurn = () => {\r\n        const actions = this.actions.slice(0, this.index);\r\n        if (this.index === 0) {\r\n            return [];\r\n        }\r\n        const turnNo = this.actions[this.index].world.turnNo;\r\n        return _.takeRightWhile(actions, a =>\r\n            a.world.turnNo === turnNo\r\n        )\r\n    };\r\n\r\n    havePrev = () => {\r\n        return this.index > 0;\r\n    };\r\n\r\n    haveNext = () => {\r\n        return !!(this.actions.length && this.index < this.actions.length - 1);\r\n    };\r\n\r\n    current = () => {\r\n        return this.actions[this.index];\r\n    };\r\n\r\n    moveNext = () => {\r\n        if (!this.haveNext()) {\r\n            return this.current();\r\n        }\r\n        return this.actions[++this.index];\r\n    };\r\n\r\n    movePrev = () => {\r\n        if (!this.havePrev()) {\r\n            return this.current();\r\n        }\r\n        return this.actions[--this.index];\r\n    }\r\n}\r\n\r\nexport class ReplayState extends BaseAppState<State> {\r\n\r\n    iterator: ActionsIterator;\r\n    timer: any = null;\r\n\r\n    isPlaying = () => !!this.timer;\r\n\r\n    constructor(routeProps: RouteProps, private actions: GameAction[], private persistenceService: PersistenceService) {\r\n        super(routeProps, {\r\n            modal: NullModalController,\r\n            isPlaying: false\r\n        });\r\n        this.iterator = new ActionsIterator(actions);\r\n    }\r\n\r\n    renderProps(): UiProps {\r\n        const { world, action } = this.iterator.current();\r\n        inDebug(() => debug_obj.currentAction = action.type);\r\n\r\n        return {\r\n            mainMsg: strings.turnNo({ turn: world.turnNo }),\r\n            msg: world.statusMsg,\r\n            bottomButtons: () => <>\r\n                <Button iconHref={ 'icons/prev.png' } unpressableInnactive={ true }\r\n                        isActive={ this.iterator.havePrev() } onClick={ this.playPrev }/>\r\n                <Button iconHref={ this.isPlaying() ? 'icons/pause.png' : 'icons/play.png' } unpressableInnactive={ true }\r\n                        isActive={ this.iterator.haveNext() } onClick={ this.togglePlay }/>\r\n                <Button iconHref={ 'icons/next.png' } unpressableInnactive={ true }\r\n                        isActive={ this.iterator.haveNext() } onClick={ this.playNext }/>\r\n            </>,\r\n            modalController: this.state.modal,\r\n            mapSnapshot: {\r\n                fills: this.getFills(),\r\n                tokens: this.getTokens(),\r\n                focusOn: this.getFocusOnLocation()\r\n            },\r\n            onMapTopButtons: () => <Button iconHref={ 'icons/double_movement.png' }\r\n                                           isVisible={ world.doubleMovement }\r\n                                           tooltip={ {\r\n                                               id: 'd-dmov',\r\n                                               tooltipHint: strings.doubleMovement(),\r\n                                               direction: 'left'\r\n                                           } }/>,\r\n            customComponent: this.renderSlider,\r\n            onMenuClick: () => this.routeProps.pushState(new MenuState(this.routeProps, this.persistenceService))\r\n        };\r\n    }\r\n\r\n    getFocusOnLocation = (): AreaKey => {\r\n        const { world } = this.iterator.current();\r\n        if (world.plagueLocation !== 0)\r\n            return locationToAreaKey(world.plagueLocation);\r\n\r\n        if (!this.iterator.havePrev()) {\r\n            return 'steppe02';\r\n        }\r\n        const prevWorld = this.iterator.actions[this.iterator.index - 1].world;\r\n\r\n        switch (prevWorld.plagueLocation) {\r\n            case 1:\r\n            case 2:\r\n                return 'steppe01';\r\n\r\n            case 8:\r\n            case 14:\r\n            case 13:\r\n            case 6:\r\n            case 7:\r\n                return 'steppe03';\r\n\r\n            default:\r\n                return 'steppe02';\r\n        }\r\n    };\r\n\r\n    renderSlider = (pageSizes: PageSizes) => {\r\n        const margin = calcCss(pageSizes.viewport, 10, 'vw');\r\n        const width = pageSizes.viewport.width - margin * 2;\r\n        const scale = window.devicePixelRatio * 2;\r\n\r\n        let marks = {} as any;\r\n\r\n        this.iterator.actions.forEach((a, i) => {\r\n            if (a.action.type === 'end-healers-turn') {\r\n                marks[i] = a.world.turnNo;\r\n            }\r\n        });\r\n\r\n        return <div style={ {\r\n            position: 'absolute',\r\n            width: width / scale,\r\n            left: (pageSizes.viewport.width - width / scale) / 2,\r\n            height: 50,\r\n            bottom: pageSizes.bottom,\r\n            zIndex: 200,\r\n            transform: `scale(${scale})`\r\n        } }>\r\n            <Slider min={ 0 }\r\n                    max={ this.iterator.actions.length - 1 }\r\n                    value={ this.iterator.index }\r\n                    onChange={ v => {\r\n                        this.iterator.index = v;\r\n                        this.playAction(this.iterator.current());\r\n                        this.disableTimer();\r\n                        this.update();\r\n                    } }\r\n                    trackStyle={{\r\n                        backgroundColor: '#811000'\r\n                    }}\r\n                    handleStyle={{\r\n                        borderColor: '#811000'\r\n                    }}\r\n                    activeDotStyle={{\r\n                        borderColor: '#811000'\r\n                    }}\r\n                    marks={marks}\r\n            />\r\n        </div>\r\n    };\r\n\r\n    togglePlay = () => {\r\n        if (this.isPlaying()) {\r\n            this.disableTimer();\r\n        } else {\r\n            this.resetTimer();\r\n        }\r\n        this.update();\r\n    };\r\n\r\n    disableTimer = () => {\r\n        clearTimeout(this.timer);\r\n        this.timer = null;\r\n    };\r\n\r\n    resetTimer = () => {\r\n        this.disableTimer();\r\n        this.timerTick();\r\n    };\r\n\r\n    timerTick = () => {\r\n        if (this.iterator.haveNext()) {\r\n            this.playNext();\r\n            this.timer = setTimeout(this.timerTick, this.getDelay(this.iterator.current().action.type));\r\n        } else {\r\n            this.disableTimer();\r\n        }\r\n        this.update();\r\n    };\r\n\r\n    private getDelay = (actionType: GameActionType) => {\r\n        switch (actionType) {\r\n            case 'movement':\r\n            case 'healers-s-plus-movement':\r\n                return 1000;\r\n            case 'contaminate':\r\n            case 'siege-start':\r\n            case 'siege-end':\r\n                return 2000;\r\n\r\n            default:\r\n                return 1300;\r\n        }\r\n    };\r\n\r\n    playNext = () => {\r\n        do {\r\n            this.iterator.moveNext();\r\n        } while (this.iterator.haveNext() && controlActionTypes.includes(this.iterator.current().action.type));\r\n        this.playAction(this.iterator.current());\r\n    };\r\n\r\n    playPrev = () => {\r\n        do {\r\n            this.iterator.movePrev()\r\n        } while (this.iterator.havePrev() && controlActionTypes.includes(this.iterator.current().action.type));\r\n        this.playAction(this.iterator.current());\r\n    };\r\n\r\n    playAction = (snapshot: ActionSnapshot) => {\r\n        const { action } = snapshot;\r\n\r\n        switch (action.type) {\r\n            case 'contaminate':\r\n                const chars = action.affected.map(id => allCharacters.find(c => c.id === id)!);\r\n                this.setState({\r\n                    modal: chars.length > 0 ? new KilledCharactersModalController(chars) : NullModalController\r\n                });\r\n                break;\r\n\r\n            case 'siege-start':\r\n                const ssChars = action.affected.map(id => allCharacters.find(c => c.id === id)!);\r\n                this.setState({\r\n                    modal: ssChars.length > 0 ? new KilledCharactersModalController(ssChars) : NullModalController\r\n                });\r\n                break;\r\n\r\n            case 'siege-end':\r\n                const seChars = action.affected.map(id => allCharacters.find(c => c.id === id)!);\r\n                this.setState({\r\n                    modal: seChars.length > 0 ? new KilledCharactersModalController(seChars) : NullModalController\r\n                });\r\n                break;\r\n\r\n            case 'healers-m12':\r\n                this.setState({\r\n                    modal: NullModalController,\r\n                });\r\n                break;\r\n\r\n            default:\r\n                this.setState({\r\n                    modal: NullModalController,\r\n                });\r\n                break;\r\n        }\r\n        this.update();\r\n    };\r\n\r\n    getFills = () => {\r\n        const fills = Object.fromEntries(areaKeys.map(key => ([key, 'available']))) as AreaFills;\r\n\r\n        const { world } = this.iterator.current();\r\n        const preceding = this.iterator.precedingInSameTurn();\r\n\r\n        preceding.forEach(p => locationToAreaKeys(p.world.plagueLocation).forEach(a => fills[a] = 'passed-available'));\r\n        locationToAreaKeys(world.initialLocation).forEach(a => fills[a] = 'passed-available');\r\n        locationToAreaKeys(world.plagueLocation).forEach(a => fills[a] = 'active');\r\n\r\n        return fills;\r\n    };\r\n\r\n    getTokens = (): AreaToken[] => {\r\n        const { world } = this.iterator.current();\r\n\r\n        if (world.inSiege) {\r\n            const keys = locationToAreaKeys(world.inSiege);\r\n            return keys.map(k => ({\r\n                areaKey: k,\r\n                token: 'siege'\r\n            }));\r\n        }\r\n        return [];\r\n    };\r\n\r\n}\r\n","import { BaseAppState, RouteProps } from './appState';\r\nimport { UiProps } from '../hud/uiScreen';\r\nimport { PersistenceService, trackingService } from '../../core/persistenceService';\r\nimport { PlagueTurnState} from './plagueTurnState';\r\nimport { SelectStartingAreaState } from './selectStartingAreaState';\r\nimport { ActionSnapshot, GameEngine } from '../../core/gameEngine';\r\nimport { HealersTurnState } from './healersTurnState';\r\nimport { strings } from '../locale/strings';\r\nimport { urlSerializer } from '../../core/gameActionsUrlSerializer';\r\nimport { ReplayState } from './replayState';\r\n\r\nexport class RestoreAppState extends BaseAppState<{}> {\r\n\r\n    constructor(routeProps: RouteProps, private persistenceService: PersistenceService = new PersistenceService()) {\r\n        super(routeProps, {});\r\n        const url = new URLSearchParams(document.location.search).get('r');\r\n        if (url) {\r\n            setTimeout(() => this.restoreFromUrl(url), 0);\r\n        } else {\r\n            trackingService.getAll().then(this.onLoaded);\r\n        }\r\n    }\r\n\r\n    restoreFromUrl = (url: string) => {\r\n        try {\r\n            const actions = urlSerializer.deserialize(url);\r\n            this.routeProps.popState();\r\n            this.routeProps.pushState(new ReplayState(this.routeProps, actions, this.persistenceService));\r\n        } catch (e) {\r\n            // TODO: error parsing url handling\r\n            console.log('Error parsing url', e);\r\n            this.onLoaded(null);\r\n        }\r\n    };\r\n\r\n    onLoaded = (actions: ActionSnapshot[] | null) => {\r\n        this.routeProps.popState();\r\n        if (!actions) {\r\n            this.routeProps.pushState(new SelectStartingAreaState(this.routeProps));\r\n            return;\r\n        }\r\n        const game = new GameEngine({\r\n            persistenceService: this.persistenceService,\r\n            actions\r\n        });\r\n        if (game.isPlagueTurn()) {\r\n            this.routeProps.pushState(new PlagueTurnState(this.routeProps, game));\r\n        } else {\r\n            const pTurn = new PlagueTurnState(this.routeProps, game);\r\n            this.routeProps.pushState(pTurn);\r\n            this.routeProps.pushState(new HealersTurnState(this.routeProps, { game, mapSnapshot: pTurn.getMapSnapshot() }))\r\n        }\r\n    };\r\n\r\n    renderProps(): UiProps {\r\n        return {\r\n            mainMsg: strings.restoringGameState()\r\n        };\r\n    }\r\n\r\n}\r\n","import React, { Component } from 'react';\r\nimport UiScreen, { UiProps } from '../hud/uiScreen';\r\nimport { areaKeys } from '../../data/areas';\r\nimport { AreaFills } from '../../model';\r\nimport { AppState, RouteProps, Transition } from './appState';\r\nimport { RestoreAppState } from './restoreAppState';\r\nimport { inDebug } from '../../debug';\r\nimport _ from 'lodash';\r\nimport { MenuState } from './menu/menuState';\r\nimport { PersistenceService } from '../../core/persistenceService';\r\n\r\ninterface State {\r\n    appStates: AppState[];\r\n    transition: Transition | null;\r\n    transientMessage: { text: string } | null;\r\n}\r\n\r\nlet debugState = {\r\n    state: '',\r\n    inStack: 0\r\n};\r\n\r\ninDebug((gui) => {\r\n    let folder = gui.addFolder('State Router');\r\n    folder.add(debugState, 'state').listen();\r\n    folder.add(debugState, 'inStack').listen();\r\n    folder.open();\r\n});\r\n\r\nclass StateRouter extends Component<{}, State> {\r\n\r\n    state: State = {\r\n        appStates: [],\r\n        transition: null,\r\n        transientMessage: null\r\n    };\r\n\r\n    defaultUiProps: UiProps = {\r\n        mapSnapshot: {\r\n            tokens: [],\r\n            fills: Object.fromEntries(areaKeys.map(key => ([key, 'disabled']))) as AreaFills\r\n        },\r\n        msgAccented: false,\r\n        onMenuClick: () => {\r\n            this.pushState(new MenuState(this.getRouteProps(), new PersistenceService()))\r\n        }\r\n    };\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state.appStates = [new RestoreAppState(this.getRouteProps())];\r\n    }\r\n\r\n    getRouteProps = (): RouteProps => ({\r\n        pushState: this.pushState,\r\n        popState: this.popState,\r\n        update: this.update,\r\n        pushMessage: this.pushMsg,\r\n        removeMsg: this.removeMsg,\r\n        clearAll: this.clearAll\r\n    });\r\n\r\n    clearAll = (transition: Transition | null = null) => {\r\n        this.setState( {\r\n            transientMessage: null,\r\n            appStates: [],\r\n            transition: transition\r\n        });\r\n    };\r\n\r\n    removeMsg = () => {\r\n        this.setState( { transientMessage: null });\r\n    }\r\n\r\n    pushMsg = (msg: string, timeout: number = 3000) => {\r\n        const transientMessage = { text: msg };\r\n        this.setState({ transientMessage });\r\n        setTimeout(() => {\r\n            if (this.state.transientMessage === transientMessage) {\r\n                this.setState({ transientMessage: null })\r\n            }\r\n        }, timeout);\r\n    };\r\n\r\n    pushState = (appState: AppState, transition: Transition | null = null) => {\r\n        this.setState({ appStates: [...this.state.appStates, appState], transition });\r\n        if (transition) {\r\n            transition.promise\r\n                .then(t => {\r\n                    if (this.state.transition === t) {\r\n                        this.setState({ transition: null })\r\n                    }\r\n                })\r\n        }\r\n    };\r\n\r\n    popState = (transition?: Transition) => {\r\n        this.state.appStates.splice(-1, 1);\r\n\r\n        this.setState({\r\n            appStates: [...this.state.appStates],\r\n            transition: transition || this.state.transition\r\n        });\r\n        if (transition) {\r\n            transition.promise\r\n                .then(t => {\r\n                    if (this.state.transition === t) {\r\n                        this.setState({ transition: null })\r\n                    }\r\n                })\r\n        }\r\n    };\r\n\r\n    update = () => {\r\n        this.forceUpdate();\r\n    };\r\n\r\n    render() {\r\n        inDebug(() => {\r\n            debugState.state = _.last(this.state.appStates)?.constructor.name || '(no)';\r\n            debugState.inStack = this.state.appStates.length;\r\n        });\r\n\r\n        const uiProps = Object.assign({},\r\n            this.defaultUiProps,\r\n            ...this.state.appStates.map(s => s.renderProps()),\r\n            this.state.transition?.renderProps(),\r\n            this.state.transientMessage\r\n                ? { msg: this.state.transientMessage.text, msgAccented: true } as UiProps\r\n                : null\r\n        );\r\n        return <UiScreen { ...uiProps } />\r\n    }\r\n}\r\n\r\nexport default StateRouter;\r\n","import React from 'react';\r\nimport './App.css';\r\nimport { ThemeProvider } from '@material-ui/styles';\r\nimport { createThemeFromScreenSize } from './components/theme/createTheme';\r\nimport StateRouter from './components/appStates/stateRouter';\r\n\r\nwindow.oncontextmenu = function(event: any) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    return false;\r\n};\r\n\r\nclass App extends React.Component {\r\n\r\n    render() {\r\n        return <div className=\"App\">\r\n            <div style={ { width: '100vw', height: '100vh' } }>\r\n                <ThemeProvider theme={ createThemeFromScreenSize({\r\n                    width: document.body.clientWidth,\r\n                    height: document.body.clientHeight\r\n                }) }>\r\n                    <StateRouter />\r\n                </ThemeProvider>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}